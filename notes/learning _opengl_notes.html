
<!DOCTYPE html>
<html>
<head>
  <title>notes</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css" crossorigin="anonymous">
  
  <style>
    /* 原有样式保持不变 */
    code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
    
    /* 修改后的左侧目录样式 */
    .toc-sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: 250px;
      height: 100%;
      background: #f8f9fa;
      border-right: 1px solid #e0e0e0;
      padding: 20px 15px;
      overflow-y: auto;
      z-index: 100;
    }
    .toc-sidebar h3 {
      margin-top: 0;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
      color: #2c3e50;
    }
    .toc-list {
      list-style: none;
      padding-left: 0;
      margin: 0;
    }
    .toc-list li {
      margin-bottom: 5px;
    }
    .toc-list li a {
      color: #34495e;
      text-decoration: none;
      display: block;
      padding: 5px 10px;
      border-left: 3px solid transparent;
      transition: all 0.2s;
      border-radius: 0 4px 4px 0;
      font-size: 14px;
    }
    .toc-list li a:hover {
      background: #e9ecef;
      color: #2c3e50;
      border-left: 3px solid #3498db;
      padding-left: 12px;
    }
    .toc-list li a.active {
      background: #e3f2fd;
      color: #1976d2;
      font-weight: 500;
      border-left: 3px solid #1976d2;
      padding-left: 12px;
    }
    .toc-list ul {
      padding-left: 15px;
      margin-top: 3px;
    }
    .content-wrapper {
      margin-left: 270px;
      padding: 20px;
    }
    @media (max-width: 768px) {
      .toc-sidebar {
        width: 200px;
      }
      .content-wrapper {
        margin-left: 220px;
      }
    }
    @media (max-width: 480px) {
      .toc-sidebar {
        display: none;
      }
      .content-wrapper {
        margin-left: 0;
      }
    }
  </style>
  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function () {
      // ====== 以下是修改后的目录功能代码 ======
      // 1. 创建左侧目录
      const tocSidebar = document.createElement('div');
      tocSidebar.className = 'toc-sidebar';
      tocSidebar.innerHTML = `
        <h3>笔记目录</h3>
        <ul class="toc-list"></ul>
      `;
      
      document.body.appendChild(tocSidebar);
      
      // 2. 生成目录结构
      function generateToc() {
        const tocList = document.querySelector('.toc-list');
        tocList.innerHTML = '';
        
        const headings = document.querySelectorAll('.crossnote h1, .crossnote h2, .crossnote h3');
        const tocItems = [];
        
        headings.forEach(heading => {
          const level = parseInt(heading.tagName.charAt(1));
          const text = heading.textContent;
          let id = heading.id;
          
          // 如果标题没有id，生成一个唯一的id
          if (!id) {
            id = 'toc-' + text.replace(/\s+/g, '-').toLowerCase();
            heading.id = id;
          }
          
          tocItems.push({
            id: id,
            text: text,
            level: level
          });
        });
        
        // 构建嵌套结构
        let currentLevel = 1;
        let parentStack = [tocList];
        
        tocItems.forEach(item => {
          const li = document.createElement('li');
          const a = document.createElement('a');
          a.href = '#' + item.id;
          a.textContent = item.text;
          
          // 处理层级
          while (item.level < currentLevel) {
            parentStack.pop();
            currentLevel--;
          }
          
          if (item.level > currentLevel) {
            const ul = document.createElement('ul');
            parentStack[parentStack.length - 1].lastChild.appendChild(ul);
            parentStack.push(ul);
            currentLevel = item.level;
          }
          
          li.appendChild(a);
          parentStack[parentStack.length - 1].appendChild(li);
        });
        
        // 为所有目录链接绑定点击事件
        document.querySelectorAll('.toc-list a').forEach(a => {
          a.addEventListener('click', function(e) {
            e.preventDefault();
            const targetId = this.getAttribute('href');
            const targetElement = document.querySelector(targetId);
            
            if (targetElement) {
              window.scrollTo({
                top: targetElement.offsetTop - 20,
                behavior: 'smooth'
              });
            }
          });
        });
      }
      
      // 3. 滚动高亮功能
      function updateActiveToc() {
        const headings = document.querySelectorAll('.crossnote h1, .crossnote h2, .crossnote h3');
        let currentSection = null;
        
        // 找到当前可视区域内的第一个标题
        for (let i = headings.length - 1; i >= 0; i--) {
          const rect = headings[i].getBoundingClientRect();
          if (rect.top <= window.innerHeight * 0.2) {
            currentSection = headings[i];
            break;
          }
        }
        
        // 更新高亮
        document.querySelectorAll('.toc-list a').forEach(a => {
          a.classList.remove('active');
          if (currentSection && a.getAttribute('href') === '#' + currentSection.id) {
            a.classList.add('active');
            // 确保高亮项在可视区域
            if (a.offsetParent) {
              a.scrollIntoView({ block: 'nearest' });
            }
          }
        });
      }
      
      // 4. 初始化
      generateToc();
      updateActiveToc();
      
      // 5. 滚动监听
      window.addEventListener('scroll', updateActiveToc);
      window.addEventListener('resize', updateActiveToc);
    });
  </script>
</head>
<body for="html-export">
  <div class="content-wrapper">
    <div class="crossnote markdown-preview">
      
<h1 id="opengl基础">OpenGL基础 </h1>
<h2 id="opengl是什么">opengl是什么 </h2>
<p>OpenGL本身是一个巨大的状态机，由一系列变量描述它的运行状态；<br>
OpenGL的状态通常称为上下文context；<br>
更改OpenGL状态的方式：设置选项，操作缓冲；</p>
<p>状态设置函数：改变上下文；<br>
状态使用函数：根据当前状态进行一些操作；</p>
<p>简单的样例如下：</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// OpenGL的状态</span>
<span class="token keyword keyword-struct">struct</span> <span class="token class-name">OpenGL_Context</span><span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    object<span class="token operator">*</span> object_Window_Target<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 创建对象</span>
<span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> objectId <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token function">glGenObject</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token punctuation">,</span> <span class="token operator">&amp;</span>objectId<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 绑定对象到上下文目标位置</span>
<span class="token function">glBindObject</span><span class="token punctuation">(</span>GL_WINDOW_TARGET <span class="token punctuation">,</span> objectId<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 设置当前绑定对象GL_WINDOW_TARGET的信息</span>
<span class="token function">glSetObjectOption</span><span class="token punctuation">(</span>GL_WINDOW_TARGET<span class="token punctuation">,</span>  GL_OPTION_WINDOW_WIDTH<span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glSetObjectOption</span><span class="token punctuation">(</span>GL_WINDOW_TARGET<span class="token punctuation">,</span> GL_OPTION_WINDOW_HEIGHT<span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 将上下文对象设回默认</span>
<span class="token function">glBindObject</span><span class="token punctuation">(</span>GL_WINDOW_TARGET<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h2 id="hello-window">Hello Window </h2>
<p>以下工作建立在VSCode + CMake + MinGW基础上，已经完成了相关插件的安装与环境变量配置。</p>
<p>首先构建文件树如图所示：<br>
<img src="..\assets\images\learning opengl\image.png" alt="alt text"></p>
<p>需要glfw，在<a href="https://www.glfw.org/download.html">官网</a>上下载源码(source package)，解压后用MinGW编译，编译成功后找到glfw-3.4/build/src/libglfw3.a放到当前lib中；<br>
同时把glfw-3.4/include文件夹下的GLFW整个复制过来；</p>
<p>需要glad,点击<a href="https://glad.dav1d.de/">在线服务平台</a>，并按照如下方式选择：<br>
<img src="..\assets\images\learning opengl\image-1.png" alt="alt text"><br>
下载压缩文件glad.zip，解压后把glad.h和glad.c添加到相应为止；</p>
<p>下一步是编写CMakeLists.txt:</p>
<details>
<summary>CMakeLists.txt</summary>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code># 指定CMake最低版本，注意不要太低了
<span class="token function">cmake_minimum_required</span><span class="token punctuation">(</span>VERSION <span class="token number">3.15</span><span class="token punctuation">)</span>

# 项目名称和支持语言
<span class="token function">project</span><span class="token punctuation">(</span>hello_window C CXX<span class="token punctuation">)</span>

# 设置C<span class="token operator">/</span>C<span class="token operator">++</span>标准
<span class="token function">set</span><span class="token punctuation">(</span>CMAKE_C_STANDARD <span class="token number">99</span><span class="token punctuation">)</span>
<span class="token function">set</span><span class="token punctuation">(</span>CMAKE_CXX_STANDARD <span class="token number">11</span><span class="token punctuation">)</span>

# 指定构建类型
<span class="token function">set</span><span class="token punctuation">(</span>CMAKE_BUILD_TYPE Debug<span class="token punctuation">)</span>

# 告诉CMake去哪里找头文件
<span class="token function">include_directories</span><span class="token punctuation">(</span>include<span class="token punctuation">)</span>

# 指定要编译源文件
<span class="token function">add_executable</span><span class="token punctuation">(</span>hello_window
    src<span class="token operator">/</span>main<span class="token punctuation">.</span>cpp
    src<span class="token operator">/</span>glad<span class="token punctuation">.</span>c
<span class="token punctuation">)</span>

# 为指定目标添加库文件
<span class="token function">target_link_directories</span><span class="token punctuation">(</span>hello_window
    PRIVATE
    lib
<span class="token punctuation">)</span>

# 链接依赖库
<span class="token function">target_link_libraries</span><span class="token punctuation">(</span>hello_window
    glfw3 # 会自动找到之前编译的libglfw3<span class="token punctuation">.</span>a
    opengl32 # Windows系统的OpenGL库
    gdi32 # GLFW依赖的Windows GDI库
<span class="token punctuation">)</span>
</code></pre></details>
编写main.cpp文件如下，成功后即可看到一个深蓝绿色窗口，并且可以调整大小：
<details>
<summary>main.cpp</summary>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;glad/glad.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;GLFW/glfw3.h&gt;</span></span>

<span class="token comment">// glfw主要有如下作用：</span>
<span class="token comment">// 为图形API提供上下文，确保图形命令正确提交到GPU</span>
<span class="token comment">// 管理窗口事件</span>
<span class="token comment">// 统一管理键盘、鼠标等输入设备的状态和事件</span>

<span class="token comment">// glad主要作用如下：</span>
<span class="token comment">// 管理OpenGL函数指针</span>
<span class="token comment">// 也就是说根据我们之前设置好的OpenGL版本</span>
<span class="token comment">// 提供好系统能找得到的函数</span>

<span class="token comment">// 注册回调函数，相应窗口大小的调整</span>
<span class="token keyword keyword-void">void</span> <span class="token function">framebuffer_size_callback</span><span class="token punctuation">(</span>GLFWwindow <span class="token operator">*</span> window <span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> width <span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> height<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">glViewport</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">,</span> width <span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 检测是否按下返回键Esc</span>
<span class="token keyword keyword-void">void</span> <span class="token function">processInput</span><span class="token punctuation">(</span>GLFWwindow <span class="token operator">*</span>window<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token function">glfwGetKey</span><span class="token punctuation">(</span>window <span class="token punctuation">,</span> GLFW_KEY_ESCAPE<span class="token punctuation">)</span> <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span>
        <span class="token function">glfwSetWindowShouldClose</span><span class="token punctuation">(</span>window <span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">glfwInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 告诉glfw我们使用的是OpenGL的4.6核心版本</span>
    <span class="token function">glfwWindowHint</span><span class="token punctuation">(</span>GLFW_CONTEXT_VERSION_MAJOR <span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwWindowHint</span><span class="token punctuation">(</span>GLFW_CONTEXT_VERSION_MINOR <span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwWindowHint</span><span class="token punctuation">(</span>GLFW_OPENGL_PROFILE <span class="token punctuation">,</span> GLFW_OPENGL_CORE_PROFILE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwWindowHint</span><span class="token punctuation">(</span>GLFW_OPENGL_FORWARD_COMPAT <span class="token punctuation">,</span> GL_TRUE<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建窗口，并通知glfw设置为主上下文</span>
    GLFWwindow <span class="token operator">*</span> window <span class="token operator">=</span> <span class="token function">glfwCreateWindow</span><span class="token punctuation">(</span><span class="token number">800</span> <span class="token punctuation">,</span> <span class="token number">600</span> <span class="token punctuation">,</span> <span class="token string">"Hello Window"</span> <span class="token punctuation">,</span> <span class="token constant">NULL</span> <span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwMakeContextCurrent</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 初始化glad</span>
    <span class="token function">gladLoadGLLoader</span><span class="token punctuation">(</span><span class="token punctuation">(</span>GLADloadproc<span class="token punctuation">)</span>glfwGetProcAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 告诉OpenGL渲染窗口大小，即视口</span>
    <span class="token comment">// 可以看到这个函数实际上是由glad告诉我们的</span>
    <span class="token comment">// OpenGL本身的坐标范围是(-1 , 1) </span>
    <span class="token comment">// 事实上是将(-1 , 1)的坐标范围映射到视口大小</span>
    <span class="token function">glViewport</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">,</span> <span class="token number">800</span> <span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 注册回调函数，告诉GLFW窗口调整大小时使用的函数</span>
    <span class="token function">glfwSetFramebufferSizeCallback</span><span class="token punctuation">(</span>window <span class="token punctuation">,</span> framebuffer_size_callback<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 渲染循环，退出前保持运行</span>
    <span class="token keyword keyword-while">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">glfwWindowShouldClose</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">processInput</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 按下Esc后退出</span>

        <span class="token function">glClearColor</span><span class="token punctuation">(</span><span class="token number">0.2f</span> <span class="token punctuation">,</span> <span class="token number">0.3f</span> <span class="token punctuation">,</span> <span class="token number">0.3f</span> <span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 状态设置，设置一个清空屏幕需要的颜色</span>
        <span class="token function">glClear</span><span class="token punctuation">(</span>GL_COLOR_BUFFER_BIT<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 状态使用，获取当前状态的应清除为的颜色，并填入颜色缓冲</span>

        <span class="token function">glfwSwapBuffers</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 双缓冲机制，渲染在“后”帧完成，展示给用户“前”帧</span>
        <span class="token comment">// 每个循环交换前后帧</span>
        <span class="token comment">// 双缓冲机制的核心是避免渲染时闪烁</span>

        <span class="token function">glfwPollEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 检查是否触发事件（键盘鼠标），并调用对应的回调函数</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 释放资源</span>
    <span class="token function">glfwTerminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></details>
<h2 id="hello-triangle">Hello Triangle </h2>
<h3 id="渲染管线">渲染管线 </h3>
<p>图形渲染管线：输入3D坐标，输出屏幕上的2D像素；<br>
着色器(Shader)：图形渲染管线中的一小部分程序；<br>
图元(Primitive)：指示渲染的目标，是点还是线还是三角形；<br>
片段(Fragment)：可以理解为渲染一个像素需要的所有数据，包括这个像素在哪里，以及各种颜色，纹理信息等；</p>
<p>一个典型的图形渲染管线的各个阶段如下所示：<br>
<img src="..\assets\images\learning opengl\image-2.png" alt="alt text"></p>
<p>顶点着色器：处理顶点数据；<br>
几何着色器：不一定需要，目的是生成一些新的顶点；<br>
图元装配：把所有顶点装配成指定的图元；<br>
光栅化：把图元映射为屏幕上相应的像素，为这些图元对应的像素生成片段；<br>
片段着色器：计算一个像素的颜色，利用光照、阴影等信息；<br>
测试和混合：真实的像素和片段之间并不完全对应，可能一个像素上有多个片段，要考虑前后遮挡、透明以及混合等关系；</p>
<h3 id="vbo--vao">VBO &amp; VAO </h3>
<p>VBO指的是顶点缓冲对象；<br>
使用缓冲对象的目的是能够一次把缓冲对象的所有内容放到显卡上，大大提升效率；<br>
因此我们可以认为VBO是放在GPU内存上的一段有关顶点的数据；</p>
<p>使用<code>glGenBuffers</code>可以生成缓冲对象；<br>
使用<code>glBlindBuffer</code>可以绑定缓冲对象到指定缓冲类型上；<br>
对于VBO，它的缓冲类型是<code>GL_ARRAY_BUFFER</code>；<br>
使用<code>glBufferData</code>可以把用户定义数据复制到指定缓冲类型绑定的缓冲对象上；</p>
<p>加载数据时可以使用不同形式，不同形式意味着要放在显卡不同位置确保高速读写：<br>
<code>GL_STATIC_DRAW</code>：数据不会或几乎不会改变；<br>
<code>GL_DYNAMIC_DRAW</code>：数据会改变很多；<br>
<code>GL_STREAM_DRAW</code>：每次绘制数据都会改变；</p>
<p>每个顶点具有不同的属性，属性包括位置、颜色等；<br>
在VBO中存储3个节点的位置，颜色信息，通常结构如下：<br>
第一个顶点（24字节），前12字节是3个float，表示位置坐标；<br>
后12字节是3个float，表示颜色；<br>
第二个顶点（24字节），前12字节是3个float，表示位置坐标；<br>
后12字节是3个float，表示颜色；<br>
第三个顶点（24字节），前12字节是3个float，表示位置坐标；<br>
后12字节是3个float，表示颜色；</p>
<p>不同的属性需要进行不同的处理，因此需要进行编号；<br>
这里为了形象化表述，我们称之为窗口；<br>
在以上的例子中，位置就是窗口0，颜色就是窗口1；<br>
不同的窗口意味着不同的处理流程；</p>
<p>我们需要告诉OpenGL如何分配VBO中的数据到不同的窗口中：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token number">6</span> <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 第一个参数，表明当前声明的东西要交给窗口0处理</span>
<span class="token comment">// 第二个参数，表示每个顶点是vec_3，有3个值</span>
<span class="token comment">// 第三个参数，表示数据类型是GL_FLOAT</span>
<span class="token comment">// 第四个函数，表示我们不希望数据被标准化</span>
<span class="token comment">// 第五个参数，表示一个顶点占了多少字节</span>
<span class="token comment">// 也可以理解为步长，表示下一个顶点的对应属性应该在哪儿找</span>
<span class="token comment">// 第六个参数，表示起始位置偏移量，为0表示从VBO的起始开始，注意类型转换</span>

<span class="token comment">// 激活0号窗口</span>
<span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>以上的分配规则，被记录在VAO中；<br>
OpenGL核心模式要求必须使用VAO记录读取VBO的方式；<br>
因此我们需要在开始设置VBO中的数据以及解读方式之前，先绑定好VAO，它会自动记录下后续信息；<br>
完成这些设置后，把VAO和VBO解绑，避免后续干扰；<br>
等到需要渲染时，把VAO绑定唤醒即可；</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">// 创建VAO和VBO</span>
<span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> VAO<span class="token punctuation">,</span> VBO<span class="token punctuation">;</span>
<span class="token function">glGenVertexArrays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>VAO<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 生成1个VAO</span>
<span class="token function">glGenBuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>VBO<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// 生成1个VBO</span>

<span class="token comment">// 绑定VAO：接下来的所有配置操作都会被VAO记住</span>
<span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>VAO<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 绑定VBO并传入数据：给盒子装零件</span>
<span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> VBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBufferData</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>vertices<span class="token punctuation">)</span><span class="token punctuation">,</span> vertices<span class="token punctuation">,</span> GL_STATIC_DRAW<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 把CPU的vertices数据塞进VBO</span>

<span class="token comment">// 设置顶点属性规则：告诉OpenGL怎么解读VBO里的数据</span>
<span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token number">3</span><span class="token operator">*</span><span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 解绑VAO和VBO</span>
<span class="token function">glBindVertexArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ...</span>

<span class="token comment">// 绘制时，只需绑定VAO：OpenGL会自动“回忆”起所有规则</span>
<span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>VAO<span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token function">someOpenGLFunctionThatDrawsOurTriangle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 绘制</span>
</code></pre><h3 id="顶点着色器">顶点着色器 </h3>
<p>顶点着色器的输出需要是标准化设备坐标，也就是x,y,z三个方向都限定在(-1,1)中；<br>
不过我们这里假定用户输入已经是标准化设备坐标，只是熟悉一下编写着色器使用的着色器语言GLSL；</p>
<p>这里基本没做任何事情，只是把用户输入的三维坐标转换成了后续需要使用的<code>gl_Position</code>：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">// 指定使用的版本，3.3，核心版</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">330</span> core</span></span>

<span class="token comment">// 0号窗口，用于处理位置坐标</span>
<span class="token comment">// 处理位置坐标需要变量vec3 aPos</span>
<span class="token comment">// “窗口”在官方说明中称作：属性位置索引</span>
<span class="token function">layout</span> <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> in vec3 aPos<span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// 输出到指定对象gl_Position中</span>
    <span class="token comment">// 第四个参数暂且不用管</span>
    gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>aPos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> aPos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> aPos<span class="token punctuation">.</span>z<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>需要注意的是着色器代码是写给GPU的，为了保证跨平台通用，采用运行时动态编译的方法：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-char">char</span> <span class="token operator">*</span>vertexShaderSource <span class="token operator">=</span> <span class="token string">"#version 330 core\n"</span>
    <span class="token string">"layout (location = 0) in vec3 aPos;\n"</span>
    <span class="token string">"void main()\n"</span>
    <span class="token string">"{\n"</span>
    <span class="token string">"   gl_Position = vec4(aPos.x, aPos.y, aPos.z, 1.0);\n"</span>
    <span class="token string">"}\0"</span><span class="token punctuation">;</span>

<span class="token comment">// 编译并完成着色器对象设置</span>
<span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> vertexShader<span class="token punctuation">;</span>
vertexShader <span class="token operator">=</span> <span class="token function">glCreateShader</span><span class="token punctuation">(</span>GL_VERTEX_SHADER<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 第二个参数是源码字符串数量，第四个参数暂时不管</span>
<span class="token function">glShaderSource</span><span class="token punctuation">(</span>vertexShader<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>vertexShaderSource<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glCompileShader</span><span class="token punctuation">(</span>vertexShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="片段着色器">片段着色器 </h3>
<p>片段着色器的目的是生成片段的颜色，这里我们选用最简单的方式，就是把颜色统一为橙色：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-char">char</span> <span class="token operator">*</span>fragmentShaderSource <span class="token operator">=</span> <span class="token string">"#version 330 core\n"</span>
    <span class="token string">"out vec4 FragColor;\n"</span>
    <span class="token string">"void main()\n"</span>
    <span class="token string">"{\n"</span>
    <span class="token string">"   FragColor = vec4(1.0f, 0.5f, 0.2f, 1.0f);\n"</span>
    <span class="token string">"}\n\0"</span><span class="token punctuation">;</span>

<span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> fragmentShader<span class="token punctuation">;</span>
fragmentShader <span class="token operator">=</span> <span class="token function">glCreateShader</span><span class="token punctuation">(</span>GL_FRAGMENT_SHADER<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glShaderSource</span><span class="token punctuation">(</span>fragmentShader<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>fragmentShaderSource<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glCompileShader</span><span class="token punctuation">(</span>fragmentShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="着色器程序">着色器程序 </h3>
<p>现在要把上面实现的着色器链接到一个着色器程序对象中；<br>
在渲染对象时激活这个着色器程序对象，就可以在渲染调用时使用我们写好的着色器；</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> shaderProgram<span class="token punctuation">;</span>
shaderProgram <span class="token operator">=</span> <span class="token function">glCreateProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">glAttachShader</span><span class="token punctuation">(</span>shaderProgram<span class="token punctuation">,</span> vertexShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glAttachShader</span><span class="token punctuation">(</span>shaderProgram<span class="token punctuation">,</span> fragmentShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glLinkProgram</span><span class="token punctuation">(</span>shaderProgram<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 链接完成后，删除着色器对象</span>
<span class="token function">glDeleteShader</span><span class="token punctuation">(</span>vertexShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glDeleteShader</span><span class="token punctuation">(</span>fragmentShader<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 使用时，直接激活着色器程序对象</span>
<span class="token function">glUseProgram</span><span class="token punctuation">(</span>shaderProgram<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="绘制三角形">绘制三角形 </h3>
<p>使用如下命令绘制三角形：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token function">glDrawArrays</span><span class="token punctuation">(</span>GL_TRIANGLES<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 从0号顶点开始，用3个顶点绘制三角形</span>
<span class="token comment">// 如果最后一个参数不是3的倍数，会忽略多余顶点</span>
<span class="token comment">// 每三个绘制一个三角形</span>
</code></pre><p>完整的main.cpp代码如下所示(其余部分与上一节完全相同)，我们应该可以看到窗口中有一个三角形：</p>
<details>
<summary>main.cpp</summary>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;glad/glad.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;GLFW/glfw3.h&gt;</span></span>

<span class="token comment">// 注册回调函数，相应窗口大小的调整</span>
<span class="token keyword keyword-void">void</span> <span class="token function">framebuffer_size_callback</span><span class="token punctuation">(</span>GLFWwindow <span class="token operator">*</span> window <span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> width <span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> height<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">glViewport</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">,</span> width <span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 检测是否按下返回键Esc</span>
<span class="token keyword keyword-void">void</span> <span class="token function">processInput</span><span class="token punctuation">(</span>GLFWwindow <span class="token operator">*</span>window<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token function">glfwGetKey</span><span class="token punctuation">(</span>window <span class="token punctuation">,</span> GLFW_KEY_ESCAPE<span class="token punctuation">)</span> <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span>
        <span class="token function">glfwSetWindowShouldClose</span><span class="token punctuation">(</span>window <span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 顶点着色器源码</span>
<span class="token keyword keyword-const">const</span> <span class="token keyword keyword-char">char</span> <span class="token operator">*</span>vertexShaderSource <span class="token operator">=</span> <span class="token string">"#version 330 core\n"</span>
    <span class="token string">"layout (location = 0) in vec3 aPos;\n"</span>
    <span class="token string">"void main()\n"</span>
    <span class="token string">"{\n"</span>
    <span class="token string">"   gl_Position = vec4(aPos.x, aPos.y, aPos.z, 1.0);\n"</span>
    <span class="token string">"}\0"</span><span class="token punctuation">;</span>

<span class="token comment">// 片段着色器源码</span>
<span class="token keyword keyword-const">const</span> <span class="token keyword keyword-char">char</span> <span class="token operator">*</span>fragmentShaderSource <span class="token operator">=</span> <span class="token string">"#version 330 core\n"</span>
    <span class="token string">"out vec4 FragColor;\n"</span>
    <span class="token string">"void main()\n"</span>
    <span class="token string">"{\n"</span>
    <span class="token string">"   FragColor = vec4(1.0f, 0.5f, 0.2f, 1.0f);\n"</span>
    <span class="token string">"}\n\0"</span><span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">glfwInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// OpenGL：3.3核心版本</span>
    <span class="token function">glfwWindowHint</span><span class="token punctuation">(</span>GLFW_CONTEXT_VERSION_MAJOR <span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwWindowHint</span><span class="token punctuation">(</span>GLFW_CONTEXT_VERSION_MINOR <span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwWindowHint</span><span class="token punctuation">(</span>GLFW_OPENGL_PROFILE <span class="token punctuation">,</span> GLFW_OPENGL_CORE_PROFILE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwWindowHint</span><span class="token punctuation">(</span>GLFW_OPENGL_FORWARD_COMPAT <span class="token punctuation">,</span> GL_TRUE<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建窗口</span>
    GLFWwindow <span class="token operator">*</span> window <span class="token operator">=</span> <span class="token function">glfwCreateWindow</span><span class="token punctuation">(</span><span class="token number">800</span> <span class="token punctuation">,</span> <span class="token number">600</span> <span class="token punctuation">,</span> <span class="token string">"Hello Triangle"</span> <span class="token punctuation">,</span> <span class="token constant">NULL</span> <span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwMakeContextCurrent</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 初始化glad</span>
    <span class="token function">gladLoadGLLoader</span><span class="token punctuation">(</span><span class="token punctuation">(</span>GLADloadproc<span class="token punctuation">)</span>glfwGetProcAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 视口设置</span>
    <span class="token function">glViewport</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">,</span> <span class="token number">800</span> <span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 注册回调函数</span>
    <span class="token function">glfwSetFramebufferSizeCallback</span><span class="token punctuation">(</span>window <span class="token punctuation">,</span> framebuffer_size_callback<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 顶点着色器</span>
    <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> vertexShader <span class="token operator">=</span> <span class="token function">glCreateShader</span><span class="token punctuation">(</span>GL_VERTEX_SHADER<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glShaderSource</span><span class="token punctuation">(</span>vertexShader<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>vertexShaderSource<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glCompileShader</span><span class="token punctuation">(</span>vertexShader<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 片段着色器</span>
    <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> fragmentShader <span class="token operator">=</span> <span class="token function">glCreateShader</span><span class="token punctuation">(</span>GL_FRAGMENT_SHADER<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glShaderSource</span><span class="token punctuation">(</span>fragmentShader<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>fragmentShaderSource<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glCompileShader</span><span class="token punctuation">(</span>fragmentShader<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 链接到着色器程序</span>
    <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> shaderProgram <span class="token operator">=</span> <span class="token function">glCreateProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glAttachShader</span><span class="token punctuation">(</span>shaderProgram<span class="token punctuation">,</span> vertexShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glAttachShader</span><span class="token punctuation">(</span>shaderProgram<span class="token punctuation">,</span> fragmentShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glLinkProgram</span><span class="token punctuation">(</span>shaderProgram<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 删除着色器</span>
    <span class="token function">glDeleteShader</span><span class="token punctuation">(</span>vertexShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glDeleteShader</span><span class="token punctuation">(</span>fragmentShader<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 原始顶点数据，放在CPU中</span>
    <span class="token keyword keyword-float">float</span> vertices<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> 
         <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> 
         <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span>    
    <span class="token punctuation">}</span><span class="token punctuation">;</span> 

    <span class="token comment">// 注册VBO，VAO并绑定完成设置</span>
    <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> VBO<span class="token punctuation">,</span> VAO<span class="token punctuation">;</span>
    <span class="token function">glGenVertexArrays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>VAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glGenBuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>VBO<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>VAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> VBO<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">glBufferData</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>vertices<span class="token punctuation">)</span><span class="token punctuation">,</span> vertices<span class="token punctuation">,</span> GL_STATIC_DRAW<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token number">3</span> <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 解除绑定VBO，VAO</span>
    <span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token function">glBindVertexArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 


    <span class="token comment">// 渲染循环</span>
    <span class="token keyword keyword-while">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">glfwWindowShouldClose</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">processInput</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 按下Esc后退出</span>

        <span class="token comment">// 清屏设置</span>
        <span class="token function">glClearColor</span><span class="token punctuation">(</span><span class="token number">0.2f</span> <span class="token punctuation">,</span> <span class="token number">0.3f</span> <span class="token punctuation">,</span> <span class="token number">0.3f</span> <span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token function">glClear</span><span class="token punctuation">(</span>GL_COLOR_BUFFER_BIT<span class="token punctuation">)</span><span class="token punctuation">;</span> 

        <span class="token comment">// 绘制三角形</span>
        <span class="token function">glUseProgram</span><span class="token punctuation">(</span>shaderProgram<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>VAO<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 实际只需绑定一次，这里为了显示标准流程</span>
        <span class="token function">glDrawArrays</span><span class="token punctuation">(</span>GL_TRIANGLES<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">glfwSwapBuffers</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 双缓冲机制</span>
        <span class="token function">glfwPollEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>

    <span class="token comment">// 释放资源</span>
    <span class="token function">glDeleteVertexArrays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>VAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glDeleteBuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>VBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glDeleteProgram</span><span class="token punctuation">(</span>shaderProgram<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwTerminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></details>
<h3 id="ebo">EBO </h3>
<p>如果想用上面绘制三角形的方式绘制矩形，会略显麻烦；<br>
我们需要传入6个顶点数据（2个重复），来绘制2个三角形；<br>
这么做在缓冲区中存了重复的元素，显然是不希望看到的；<br>
使用EBO(也叫做IBO)可以解决该问题；</p>
<p>仍然只在VBO中存不重复的顶点信息；<br>
用indices数组声明如何使用顶点绘制每个三角形；<br>
把indices数组加载到EBO中去，并完成绑定；</p>
<p>代码示例如下：</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-float">float</span> vertices<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>   
    <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>  
    <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> 
    <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span>   
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> indices<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token number">0</span> <span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// 第一个三角形顶点编号</span>
    <span class="token number">1</span> <span class="token punctuation">,</span> <span class="token number">2</span> <span class="token punctuation">,</span> <span class="token number">3</span>  <span class="token comment">// 第二个三角形顶点编号</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 注册并绑定EBO对象</span>
<span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> EBO<span class="token punctuation">;</span>
<span class="token function">glGenBuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>EBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ELEMENT_ARRAY_BUFFER<span class="token punctuation">,</span> EBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBufferData</span><span class="token punctuation">(</span>GL_ELEMENT_ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>indices<span class="token punctuation">)</span><span class="token punctuation">,</span> indices<span class="token punctuation">,</span> GL_STATIC_DRAW<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 以线框形式绘制</span>
<span class="token function">glPolygonMode</span><span class="token punctuation">(</span>GL_FRONT_AND_BACK<span class="token punctuation">,</span> GL_LINE<span class="token punctuation">)</span>

<span class="token comment">// 绘制</span>
<span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ELEMENT_ARRAY_BUFFER<span class="token punctuation">,</span> EBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glDrawElements</span><span class="token punctuation">(</span>GL_TRIANGLES<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> GL_UNSIGNED_INT<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>特别提醒：要解绑EBO的话，必须在VAO之后进行；</p>
<h2 id="glsl">GLSL </h2>
<p>GLSL是着色器语言，简单熟悉一下用法：</p>
<h3 id="向量">向量 </h3>
<p>有如下形式向量可以选择：<code>vecn</code>,<code>bvecn</code>,<code>ivecn</code>,<code>uvecn</code>,<code>dvecn</code>；<br>
分别表示不同数据类型的n维向量，一般用vec(float)足够；</p>
<p>向量有一些有趣的管理方法：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>vec2 vect1 <span class="token operator">=</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">0.5</span> <span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
vec4 vect2 <span class="token operator">=</span> vect1<span class="token punctuation">.</span>xyxx 
vec3 vect3 <span class="token operator">=</span> <span class="token function">vec3</span><span class="token punctuation">(</span>vect2<span class="token punctuation">.</span>xw <span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="输入输出">输入输出 </h3>
<p>首先需要明确，着色器程序是在GPU中的，彼此独立，因此需要专门的输入输出方式；<br>
layout(location = 0)通常用来指示从CPU来的数据所放的VBO中的窗口位置；<br>
out / in 是GPU之间的内部通道，上一个着色器的out可以在下一个着色器用in接受(相同名字和类型);<br>
gl_Position等是着色器的内置输出变量，无需专门声明；</p>
<h3 id="uniform">Uniform </h3>
<p>uniform的作用是可以更自由地从CPU向任意着色器发送数据；<br>
只要在着色器中声明uniform就可以使用；<br>
在外部代码中，可以找到并更新这个uniform的值；</p>
<p>看一个简单的例子，想让三角形的颜色变起来，我们在每个渲染循环中生成颜色，传递给一个uniform变量"ourColor"，并在片段着色器中直接使用该对象作为颜色输出：</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// 渲染循环中</span>

<span class="token comment">// 必须先激活着色器才能传递uniform</span>
<span class="token function">glUseProgram</span><span class="token punctuation">(</span>shaderProgram<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-float">float</span> timeValue <span class="token operator">=</span> <span class="token function">glfwGetTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-float">float</span> greenValue <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">sin</span><span class="token punctuation">(</span>timeValue<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0f</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0.5f</span><span class="token punctuation">;</span>
<span class="token keyword keyword-int">int</span> vertexColorLocation <span class="token operator">=</span> <span class="token function">glGetUniformLocation</span><span class="token punctuation">(</span>shaderProgram<span class="token punctuation">,</span> <span class="token string">"ourColor"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glUniform4f</span><span class="token punctuation">(</span>vertexColorLocation<span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> greenValue<span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 片段着色器</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">330</span> core</span></span>
out vec4 FragColor<span class="token punctuation">;</span>

uniform vec4 ourColor<span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    FragColor <span class="token operator">=</span> ourColor<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>如果在VBO中本身存入了三个顶点的颜色信息，并在顶点着色器中读取后传递给片段着色器的话，实际会看到绘制出的三角形并不是均匀颜色，因为默认对片段色彩进行了插值；</p>
<h3 id="着色器类">着色器类 </h3>
<p>注意到之前编写着色器程序是在main.cpp中，显得比较臃肿；<br>
我们希望把这部分功能独立出来，使得在main.cpp中能够使用很少的代码完成有关着色器的使用设置；</p>
<p>具体而言，需要在shader.h中定义着色器类；<br>
在"shader.vs"和"shader.fs"文件中编写顶点着色器和片段着色器程序;<br>
shader.h的代码较为通用，可以在多处使用；</p>
<p>shader.h的代码如下所示：</p>
<details>
<summary>shader.h</summary>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">SHADER_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SHADER_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;glad/glad.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fstream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sstream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

class Shader
<span class="token punctuation">{</span>
public<span class="token operator">:</span>
    <span class="token comment">// 着色器程序ID</span>
    <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> ID<span class="token punctuation">;</span>

    <span class="token function">Shader</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-char">char</span><span class="token operator">*</span> vertexPath<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-char">char</span><span class="token operator">*</span> fragmentPath<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 从文件读取顶点/片段着色器代码</span>
        std<span class="token operator">::</span>string vertexCode<span class="token punctuation">;</span>
        std<span class="token operator">::</span>string fragmentCode<span class="token punctuation">;</span>
        std<span class="token operator">::</span>ifstream vShaderFile<span class="token punctuation">;</span>
        std<span class="token operator">::</span>ifstream fShaderFile<span class="token punctuation">;</span>

        <span class="token comment">// 异常处理</span>
        vShaderFile<span class="token punctuation">.</span><span class="token function">exceptions</span> <span class="token punctuation">(</span>std<span class="token operator">::</span>ifstream<span class="token operator">::</span>failbit <span class="token operator">|</span> std<span class="token operator">::</span>ifstream<span class="token operator">::</span>badbit<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fShaderFile<span class="token punctuation">.</span><span class="token function">exceptions</span> <span class="token punctuation">(</span>std<span class="token operator">::</span>ifstream<span class="token operator">::</span>failbit <span class="token operator">|</span> std<span class="token operator">::</span>ifstream<span class="token operator">::</span>badbit<span class="token punctuation">)</span><span class="token punctuation">;</span>
        try 
        <span class="token punctuation">{</span>
            <span class="token comment">// 打开文件</span>
            vShaderFile<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>vertexPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fShaderFile<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>fragmentPath<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 读取到字符串流</span>
            std<span class="token operator">::</span>stringstream vShaderStream<span class="token punctuation">,</span> fShaderStream<span class="token punctuation">;</span>
            vShaderStream <span class="token operator">&lt;&lt;</span> vShaderFile<span class="token punctuation">.</span><span class="token function">rdbuf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            fShaderStream <span class="token operator">&lt;&lt;</span> fShaderFile<span class="token punctuation">.</span><span class="token function">rdbuf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 关闭文件</span>
            vShaderFile<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            fShaderFile<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 转换为字符串</span>
            vertexCode   <span class="token operator">=</span> vShaderStream<span class="token punctuation">.</span><span class="token function">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            fragmentCode <span class="token operator">=</span> fShaderStream<span class="token punctuation">.</span><span class="token function">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">catch</span> <span class="token punctuation">(</span>std<span class="token operator">::</span>ifstream<span class="token operator">::</span>failure<span class="token operator">&amp;</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"ERROR::SHADER::FILE_NOT_SUCCESSFULLY_READ: "</span> <span class="token operator">&lt;&lt;</span> e<span class="token punctuation">.</span><span class="token function">what</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 转换成C风格字符串</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-char">char</span><span class="token operator">*</span> vShaderCode <span class="token operator">=</span> vertexCode<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-char">char</span> <span class="token operator">*</span> fShaderCode <span class="token operator">=</span> fragmentCode<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 编译着色器</span>
        <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> vertex<span class="token punctuation">,</span> fragment<span class="token punctuation">;</span>

        vertex <span class="token operator">=</span> <span class="token function">glCreateShader</span><span class="token punctuation">(</span>GL_VERTEX_SHADER<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glShaderSource</span><span class="token punctuation">(</span>vertex<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>vShaderCode<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glCompileShader</span><span class="token punctuation">(</span>vertex<span class="token punctuation">)</span><span class="token punctuation">;</span>

        fragment <span class="token operator">=</span> <span class="token function">glCreateShader</span><span class="token punctuation">(</span>GL_FRAGMENT_SHADER<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glShaderSource</span><span class="token punctuation">(</span>fragment<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>fShaderCode<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glCompileShader</span><span class="token punctuation">(</span>fragment<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 绑定着色器程序</span>
        ID <span class="token operator">=</span> <span class="token function">glCreateProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glAttachShader</span><span class="token punctuation">(</span>ID<span class="token punctuation">,</span> vertex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glAttachShader</span><span class="token punctuation">(</span>ID<span class="token punctuation">,</span> fragment<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glLinkProgram</span><span class="token punctuation">(</span>ID<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 删除已链接着色器</span>
        <span class="token function">glDeleteShader</span><span class="token punctuation">(</span>vertex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glDeleteShader</span><span class="token punctuation">(</span>fragment<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 激活着色器程序</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{</span> 
        <span class="token function">glUseProgram</span><span class="token punctuation">(</span>ID<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>

    <span class="token comment">// 设置不同类型uniform变量</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">setBool</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> std<span class="token operator">::</span>string <span class="token operator">&amp;</span>name<span class="token punctuation">,</span> bool value<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span>
    <span class="token punctuation">{</span>         
        <span class="token function">glUniform1i</span><span class="token punctuation">(</span><span class="token function">glGetUniformLocation</span><span class="token punctuation">(</span>ID<span class="token punctuation">,</span> name<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span><span class="token punctuation">)</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">setInt</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> std<span class="token operator">::</span>string <span class="token operator">&amp;</span>name<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> value<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span>
    <span class="token punctuation">{</span> 
        <span class="token function">glUniform1i</span><span class="token punctuation">(</span><span class="token function">glGetUniformLocation</span><span class="token punctuation">(</span>ID<span class="token punctuation">,</span> name<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> std<span class="token operator">::</span>string <span class="token operator">&amp;</span>name<span class="token punctuation">,</span> <span class="token keyword keyword-float">float</span> value<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span>
    <span class="token punctuation">{</span> 
        <span class="token function">glUniform1f</span><span class="token punctuation">(</span><span class="token function">glGetUniformLocation</span><span class="token punctuation">(</span>ID<span class="token punctuation">,</span> name<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre></details>
<p>在头文件中编写好着色器程序后，在main.cpp中可以很容易地使用：</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">include</span><span class="token string">&lt;shader.h&gt;</span></span>

Shader <span class="token function">myshader</span><span class="token punctuation">(</span><span class="token string">"shader.vs"</span> <span class="token punctuation">,</span> <span class="token string">"shader.fs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-while">while</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 渲染循环中</span>

    myshader<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    myshader<span class="token punctuation">.</span><span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token string">"someValue"</span> <span class="token punctuation">,</span> <span class="token number">0.5f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 绘制逻辑</span>
<span class="token punctuation">}</span>
</code></pre><h2 id="纹理">纹理 </h2>
<h3 id="纹理坐标">纹理坐标 </h3>
<p>纹理坐标的范围是[0 , 1] x [0 , 1]；<br>
要为对象添加纹理，需要告知纹理坐标；<br>
我们只需给顶点着色器传递纹理坐标，传入到片段着色器后，会自动为每个片段进行纹理坐标插值；</p>
<p>原则上，我们不希望超出纹理坐标；<br>
超出纹理坐标范围时，有如下可选样式：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>样式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GL_REPEAT</td>
<td>默认，重复纹理图像</td>
</tr>
<tr>
<td>GL_MIRRORED</td>
<td>镜像重复</td>
</tr>
<tr>
<td>GL_CLAMP_TO_EDGE</td>
<td>超出部分为边缘拉伸</td>
</tr>
<tr>
<td>GL_CLAMP_TO_BORDER</td>
<td>超出部分用户指定颜色</td>
</tr>
</tbody>
</table>
<p>使用如下命令可以对每一个坐标轴(s,t)单独设置重复样式：</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_WRAP_S<span class="token punctuation">,</span> GL_MIRRORED_REPEAT<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-float">float</span> borderColor<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">glTexParameterfv</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_BORDER_COLOR<span class="token punctuation">,</span> borderColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="纹理像素">纹理像素 </h3>
<p>同样地，我们需要把纹理像素(Texel)，也就是纹理图片，映射到纹理坐标上；<br>
可以想象，如果要把一张低分辨率的图，贴到一个超大的物体上；<br>
这里的大指的是在屏幕上占的像素多，因此需要更多的采样；<br>
会导致贴图看起来模糊，因为一个采样点并不十分精确地对应到一个Texel；</p>
<p>有如下两种过滤方式得到近似的像素颜色：<br>
GL_NEAREST：取最接近的像素的颜色；<br>
GL_LINEAR：取周围像素颜色的差值；</p>
<p>前者会使得看起来颗粒感较强，后者虽然模糊，但是更真实；</p>
<p>利用如下代码可以在放大或者缩小时指定过滤方式：</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_MIN_FILTER<span class="token punctuation">,</span> GL_NEAREST<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_MAG_FILTER<span class="token punctuation">,</span> GL_LINEAR<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>稍微说明一下，缩小过滤，也就是说把一个超清晰的纹理图贴到一个小物体上，也需要过滤，这听起来似乎没什么必要，因为可以直接采样到值；<br>
但是实际操作中，如果不进行过滤的话，会导致摩尔纹等视觉问题；</p>
<p>总而言之，过滤是为了保证纹理图像和最终画出来的物理图像相匹配，以得到最真实的视觉效果；</p>
<h3 id="多级纹理">多级纹理 </h3>
<p>对于越远的物体，应该使用分辨率更低的纹理贴图；<br>
但是手动判断物体应该使用多大的纹理贴图是麻烦的；<br>
使用Mipmap可以方便地解决这一问题；</p>
<p>它能够自动把纹理处理成这样：<br>
<img src="..\assets\images\learning opengl\image-4.png" alt="alt text"></p>
<p>可以使用四种方式进行多级纹理的过滤：<br>
GL_[层内采样规则]<em>MIPMAP</em>[层间采样规则]</p>
<p>代码如下，一般选择线性插值：</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_MIN_FILTER<span class="token punctuation">,</span> GL_LINEAR_MIPMAP_LINEAR<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>特别需要注意的是，使用mipmap是为了处理缩小纹理的情形，对于放大纹理的情形，使用mipmap会报错；</p>
<h3 id="加载纹理">加载纹理 </h3>
<p>使用图像加载库stb_image.h加载纹理；<br>
具体地，在<a href="https://github.com/nothings/stb/blob/master/stb_image.h">这里</a>下载头文件；</p>
<p>并新建一个stb_image_loader.cpp文件，在其中写入：</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">STB_IMAGE_IMPLEMENTATION</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"stb_image.h"</span></span>
</code></pre><p>然后将其加入到CMakeLists.txt的add_executable中即可；</p>
<p>在main.cpp中，使用如下方式即可加载图片：</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-int">int</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> nrChannels<span class="token punctuation">;</span>
<span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-char">char</span> <span class="token operator">*</span>data <span class="token operator">=</span> <span class="token function">stbi_load</span><span class="token punctuation">(</span><span class="token string">"name.jpg"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>width<span class="token punctuation">,</span> <span class="token operator">&amp;</span>height<span class="token punctuation">,</span> <span class="token operator">&amp;</span>nrChannels<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="生成纹理">生成纹理 </h3>
<p>使用如下代码生成纹理：</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> texture<span class="token punctuation">;</span>
<span class="token function">glGenTextures</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>texture<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> texture<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 为当前绑定的纹理对象设置环绕、过滤方式</span>
<span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_WRAP_S<span class="token punctuation">,</span> GL_REPEAT<span class="token punctuation">)</span><span class="token punctuation">;</span>   
<span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_WRAP_T<span class="token punctuation">,</span> GL_REPEAT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_MIN_FILTER<span class="token punctuation">,</span> GL_LINEAR<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_MAG_FILTER<span class="token punctuation">,</span> GL_LINEAR<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 加载并生成纹理</span>
<span class="token keyword keyword-int">int</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> nrChannels<span class="token punctuation">;</span>
<span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-char">char</span> <span class="token operator">*</span>data <span class="token operator">=</span> <span class="token function">stbi_load</span><span class="token punctuation">(</span><span class="token string">"container.jpg"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>width<span class="token punctuation">,</span> <span class="token operator">&amp;</span>height<span class="token punctuation">,</span> <span class="token operator">&amp;</span>nrChannels<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 载入图片数据生成纹理</span>
<span class="token function">glTexImage2D</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GL_RGB<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GL_RGB<span class="token punctuation">,</span> GL_UNSIGNED_BYTE<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 第一个参数是纹理目标</span>
<span class="token comment">// 第二个参数是多级渐远处理级别，0表示基本级别</span>
<span class="token comment">// 第三个参数是纹理储存格式</span>
<span class="token comment">// 第四、五个参数是文里的宽和高</span>
<span class="token comment">// 第六个参数总是被设置为0</span>
<span class="token comment">// 第七、八个参数定义源图的格式和数据类型</span>
<span class="token comment">// 第九个参数是图像数据</span>
<span class="token function">glGenerateMipmap</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 释放图像内存</span>
<span class="token function">stbi_image_free</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="应用纹理">应用纹理 </h3>
<p>按照如下方式可以应用纹理：</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// 顶点着色器</span>
<span class="token function">layout</span> <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span> in vec2 aTexCoord<span class="token punctuation">;</span>
out vec2 TexCoord<span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    TexCoord <span class="token operator">=</span> aTexCoord<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 片段着色器</span>
in vec2 TexCoord<span class="token punctuation">;</span>

uniform sampler2D ourTexture<span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    FragColor <span class="token operator">=</span> <span class="token function">texture</span><span class="token punctuation">(</span>ourTexture<span class="token punctuation">,</span> TexCoord<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 渲染循环</span>
<span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> texture<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>VAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glDrawElements</span><span class="token punctuation">(</span>GL_TRIANGLES<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> GL_UNSIGNED_INT<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="纹理单元">纹理单元 </h3>
<p>我们可以在片段着色器中设置多个纹理；<br>
每个纹理称之为纹理单元；<br>
纹理的默认激活单元是0；<br>
使用纹理前需要先进行激活，然后绑定；</p>
<p>由于需要使用2个纹理，片段着色器代码需要适当修改：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>uniform sampler2D texture1<span class="token punctuation">;</span>
uniform sampler2D texture2<span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    FragColor <span class="token operator">=</span> <span class="token function">mix</span><span class="token punctuation">(</span><span class="token function">texture</span><span class="token punctuation">(</span>texture1<span class="token punctuation">,</span> TexCoord<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">texture</span><span class="token punctuation">(</span>texture2<span class="token punctuation">,</span> TexCoord<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 第三个参数表示前一个颜色占0.8，后一个颜色占0.2</span>
<span class="token punctuation">}</span>
</code></pre><p>在完成两张纹理数据上传之后，需要告诉着色器每个采样器sampler2D对应于哪个纹理单元，这个过程放在渲染循环前面：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token function">glUseProgram</span><span class="token punctuation">(</span>shaderProgram<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glUniform1i</span><span class="token punctuation">(</span><span class="token function">glGetUniformLocation</span><span class="token punctuation">(</span>shaderProgram <span class="token punctuation">,</span> <span class="token string">"texture1"</span><span class="token punctuation">)</span> <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glUniform1i</span><span class="token punctuation">(</span><span class="token function">glGetUniformLocation</span><span class="token punctuation">(</span>shaderProgram <span class="token punctuation">,</span> <span class="token string">"texture2"</span><span class="token punctuation">)</span> <span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>在渲染循环中，需要激活再绑定纹理：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token function">glUseProgram</span><span class="token punctuation">(</span>shaderProgram<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
<span class="token function">glActiveTexture</span><span class="token punctuation">(</span>GL_TEXTURE0<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> texture1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glActiveTexture</span><span class="token punctuation">(</span>GL_TEXTURE1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> texture2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>注意有时候会发生上下颠倒的情况，是因为图片的要轴通常向下，OpenGL的y轴向上；<br>
因此需要在加载图片前添加翻转语句：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token function">stbi_set_flip_vertically_on_load</span><span class="token punctuation">(</span>true<span class="token punctuation">)</span><span class="token punctuation">;</span>
data <span class="token operator">=</span> <span class="token function">stbi_load</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h2 id="变换">变换 </h2>
<h3 id="齐次坐标">齐次坐标 </h3>
<p>三维向量可以指示方向，但是没有绝对位置的含义；<br>
为了能够准确地描述出平移，可以启用一个辅助维度w；<br>
w通常称作齐次坐标，一般而言都是1.0;</p>
<p>利用齐次坐标，可以用4 x 4矩阵表达出平移：<br>
<img src="..\assets\images\learning opengl\image-5.png" alt="alt text"><br>
如果w = 0 ，通常意味着这是一个方向向量，不能平移；</p>
<h3 id="glm">GLM </h3>
<p>OpenGL中处理矩阵的库为GLM；<br>
从<a href="https://github.com/g-truc/glm/releases/tag/1.0.2">这里</a>进行下载，然后把glm文件夹添加到include中；</p>
<p>通常我们在main.cpp中使用到如下三个头文件:</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;glm/glm.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;glm/gtc/matrix_transform.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;glm/gtc/type_ptr.hpp&gt;</span></span>
</code></pre><p>简单地使用示例如下：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">// w值设置为1</span>
glm<span class="token operator">::</span>vec4 <span class="token function">vec</span><span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 初始化为单位矩阵，需要手动进行</span>
glm<span class="token operator">::</span>mat4 trans <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">mat4</span><span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token punctuation">)</span>

<span class="token comment">// 接受一个单位矩阵trans，把它加入平移项</span>
<span class="token comment">// 后一项为平移的向量</span>
trans <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">translate</span><span class="token punctuation">(</span>trans<span class="token punctuation">,</span> glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
vec <span class="token operator">=</span> trans <span class="token operator">*</span> vec<span class="token punctuation">;</span>

<span class="token comment">// 旋转和缩放</span>
trans <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">rotate</span><span class="token punctuation">(</span>trans<span class="token punctuation">,</span> glm<span class="token operator">::</span><span class="token function">radians</span><span class="token punctuation">(</span><span class="token number">90.0f</span><span class="token punctuation">)</span><span class="token punctuation">,</span> glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
trans <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">scale</span><span class="token punctuation">(</span>trans<span class="token punctuation">,</span> glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>实际上，转移矩阵应该在着色器中发挥作用：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">// 顶点着色器</span>
uniform mat4 transform<span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> transform <span class="token operator">*</span> <span class="token function">vec4</span><span class="token punctuation">(</span>aPos<span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>这就需要把我们之前定义的trans发送给着色器：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> transformLoc <span class="token operator">=</span> <span class="token function">glGetUniformLocation</span><span class="token punctuation">(</span>shaderProgram<span class="token punctuation">,</span> <span class="token string">"transform"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 第二个参数表明发送1个矩阵</span>
<span class="token comment">// 第三个参数表示是否希望进行转置，一般不需要</span>
<span class="token comment">// 最后一个参数，先转换成OpenGL希望的形式，再传入</span>
<span class="token function">glUniformMatrix4fv</span><span class="token punctuation">(</span>transformLoc<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> glm<span class="token operator">::</span><span class="token function">value_ptr</span><span class="token punctuation">(</span>trans<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>需要注意矩阵乘法的顺序从右往左；<br>
但是我们写代码的顺序是从左到右的变换矩阵写的；<br>
因此后加入的矩阵，实际上新进行变换；<br>
如下例子中，就是先平移，再旋转：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>glm<span class="token operator">::</span>mat4 trans <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">mat4</span><span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
trans <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">translate</span><span class="token punctuation">(</span>trans<span class="token punctuation">,</span> glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
trans <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">rotate</span><span class="token punctuation">(</span>trans<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token function">glfwGetTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h2 id="坐标系统">坐标系统 </h2>
<h3 id="坐标空间--矩阵">坐标空间 &amp; 矩阵 </h3>
<p>局部坐标：描述物体本身，中心在物体上；<br>
世界坐标：真实世界的坐标系，固定不动；</p>
<p>从局部坐标到世界坐标，需要用一个矩阵变换，即模型矩阵(Model)；<br>
容易知道，模型矩阵实际上就是描述物体在真实世界中的哪个位置；</p>
<p>观察坐标：中心在相机，方向沿着相机的朝向；<br>
从世界坐标到观察坐标，需要一个矩阵变换，即观察矩阵(View)；<br>
容易知道，观察矩阵实际上就是描述相机在真实世界中的那个位置；</p>
<p>裁剪坐标：可以理解为为了把三维变成二维，需要使用的一套过渡的坐标系；<br>
为了理解裁剪坐标，需要引入Frustum(观察箱，四棱台)的概念；</p>
<div style="display: flex; gap: 10px; ">
  <div style="flex: 1; ">
    <img src="..\assets\images\learning opengl\image-6.png" alt="正射投影" style="width: 100%; ">
  </div>
  <div style="flex: 1;">
    <img src="..\assets\images\learning opengl\image-7.png" alt="透视投影" style="width: 100%;">
  </div>
</div>
所谓裁剪，指的就是并非三维空间中所有部分都能被看到，只有在Frustum中的部分才能最终被看见；
这里其实可以理解游戏中的穿墙透视现象；
在离得太近的时候，物体不在我们的Frustum中，导致看不到，因此视线直接穿过去；
<p>为了描述能看见的部分，我们需要一个额外的坐标维度w，它基本上描述了Frustum中特定深度的平面的大小；</p>
<p>这里有两种Frustum的模式：<br>
左图称为正视投影，即每个w是一样的，这不符合实际视觉效果，但在工程制图中常用；<br>
右图称为透视投影，更符合人实际看到的，有近大远小的效果；</p>
<p>所谓近大远小，其实容易理解；<br>
近处的可见范围w小，远处的可见范围w大；<br>
但是最终需要画在同一尺寸的屏幕上，显然近处的物体显得更大；</p>
<p>从观察坐标到裁剪坐标需要使用投影矩阵(Projection)；<br>
这个矩阵的目的基本就是根据原坐标，生成对应的w；<br>
有意思的地方在于，之前我们的第四维度是用来进行平移的；<br>
这里的第四维度是用来存w的，因此矩阵都是四维的，但是含义却有一些变化；</p>
<p>比较方便的是，投影矩阵并不需要我们自己进行构造：<br>
使用如下方式可以快速得到出投影矩阵：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">// 正交投影</span>
glm<span class="token operator">::</span><span class="token function">ortho</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">800.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">600.0f</span><span class="token punctuation">,</span> <span class="token number">0.1f</span><span class="token punctuation">,</span> <span class="token number">100.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 前两个参数描述左右，中间两个参数描述上下，最后两个参数描述远近</span>

<span class="token comment">// 透视投影</span>
glm<span class="token operator">::</span>mat4 proj <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">perspective</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">radians</span><span class="token punctuation">(</span><span class="token number">45.0f</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span>width<span class="token operator">/</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span>height<span class="token punctuation">,</span> <span class="token number">0.1f</span><span class="token punctuation">,</span> <span class="token number">100.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 第一个参数就是图中的fov ，第二个参数是宽高比 ， 最后两个参数是远近</span>
</code></pre><p>总结来说，我们有如下的公式：<br>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>V</mi><mrow><mi>c</mi><mi>l</mi><mi>i</mi><mi>p</mi></mrow></msub><mo>=</mo><msub><mi>M</mi><mrow><mi>p</mi><mi>r</mi><mi>o</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></msub><mo>⋅</mo><msub><mi>M</mi><mrow><mi>v</mi><mi>i</mi><mi>e</mi><mi>w</mi></mrow></msub><mo>⋅</mo><msub><mi>M</mi><mrow><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi></mrow></msub><mo>⋅</mo><msub><mi>V</mi><mrow><mi>l</mi><mi>o</mi><mi>c</mi><mi>a</mi><mi>l</mi></mrow></msub></mrow><annotation encoding="application/x-tex">V_{clip} = M_{projection} \cdot M_{view} \cdot M_{model} \cdot V_{local}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">p</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">ro</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mord mathnormal mtight">ec</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">oc</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<p>屏幕坐标：屏幕上的位置；<br>
从裁剪左边到屏幕坐标，最核心的一部就是要使用透视除法；<br>
即(x,y,z)要变成(x/w , y/w , z/w);<br>
这一步实际上是在片段着色器中自动执行的；<br>
其中新的x',y'就是在屏幕上看到的位置；</p>
<p>可能会有疑问，那最后的z'还有什么用？<br>
实际上这是用来保存深度信息的；<br>
因为我们需要最终画在屏幕上的物体有正确的前后遮挡关系，因此必须存储深度值；</p>
<p>另一个问题在于，z 和 w不应该成正比吗？为什么还能表示深度信息；<br>
这其实是因为投影矩阵实际上对z也做了特定的变换；<br>
使得<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mrow><mi>c</mi><mi>l</mi><mi>i</mi><mi>p</mi></mrow></msub></mrow><annotation encoding="application/x-tex">z_{clip}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">p</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>并不等于到相机的深度<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mrow><mi>v</mi><mi>i</mi><mi>e</mi><mi>w</mi></mrow></msub></mrow><annotation encoding="application/x-tex">z_{view}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，而是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><msub><mi>z</mi><mrow><mi>v</mi><mi>i</mi><mi>e</mi><mi>w</mi></mrow></msub><mo>+</mo><mi>B</mi></mrow><annotation encoding="application/x-tex">A z_{view} + B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal">A</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span>；<br>
因此最后得到的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>z</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>∼</mo><mi>A</mi><mo>+</mo><mi>B</mi><mi mathvariant="normal">/</mi><msub><mi>z</mi><mrow><mi>v</mi><mi>i</mi><mi>e</mi><mi>w</mi></mrow></msub></mrow><annotation encoding="application/x-tex">z' \sim A + B / z_{view}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7519em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord">/</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，仍然保存了深度信息；</p>
<h3 id="hello_3d">Hello_3D </h3>
<p>默认情况下，坐标系的方向如下所示：<br>
<img src="..\assets\images\learning opengl\image-8.png" alt="alt text"><br>
我们总是可以想象真实坐标系是这样的；<br>
因为实际上，最需要填写的Model和View矩阵都关联到真实坐标系；</p>
<p>我们想做一个旋转的立方体盒子：<br>
让盒子转起来，需要修改Model：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>model <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">rotate</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token function">glfwGetTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> glm<span class="token operator">::</span><span class="token function">radians</span><span class="token punctuation">(</span><span class="token number">50.0f</span><span class="token punctuation">)</span><span class="token punctuation">,</span> glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>把相机摆在(0 , 0 , 3)位置上，就是需要把场景想-z方向平移3格，按照如下方式设置View:</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>view <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">translate</span><span class="token punctuation">(</span>view<span class="token punctuation">,</span> glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3.0f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>投影矩阵按照之前的方式定义；<br>
我们需要在顶点着色器中用到这些矩阵：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">330</span> core</span></span>
<span class="token function">layout</span> <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> in vec3 aPos<span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
uniform mat4 model<span class="token punctuation">;</span>
uniform mat4 view<span class="token punctuation">;</span>
uniform mat4 projection<span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// 注意乘法要从右向左读</span>
    gl_Position <span class="token operator">=</span> projection <span class="token operator">*</span> view <span class="token operator">*</span> model <span class="token operator">*</span> <span class="token function">vec4</span><span class="token punctuation">(</span>aPos<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><p>注意不要忘了把矩阵传给顶点着色器；</p>
<p>我们之前忽略了深度测试这一步，在OpenGL中这是自动完成的；<br>
只需要在开始渲染之前启用深度测试并正确清除即可：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token function">glEnable</span><span class="token punctuation">(</span>GL_DEPTH_TEST<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 需要在渲染循环中先清除，否则带有之前的深度信息</span>
<span class="token function">glClear</span><span class="token punctuation">(</span>GL_COLOR_BUFFER_BIT <span class="token operator">|</span> GL_DEPTH_BUFFER_BIT<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>完整的main.cpp如下所示：</p>
<details>
<summary>main.cpp</summary>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;glad/glad.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;GLFW/glfw3.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stb_image.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;glm/glm.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;glm/gtc/matrix_transform.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;glm/gtc/type_ptr.hpp&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;shader.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cmath&gt;</span></span>

<span class="token comment">// 注册回调函数，相应窗口大小的调整</span>
<span class="token keyword keyword-void">void</span> <span class="token function">framebuffer_size_callback</span><span class="token punctuation">(</span>GLFWwindow <span class="token operator">*</span> window <span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> width <span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> height<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">glViewport</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">,</span> width <span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 检测是否按下返回键Esc</span>
<span class="token keyword keyword-void">void</span> <span class="token function">processInput</span><span class="token punctuation">(</span>GLFWwindow <span class="token operator">*</span>window<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token function">glfwGetKey</span><span class="token punctuation">(</span>window <span class="token punctuation">,</span> GLFW_KEY_ESCAPE<span class="token punctuation">)</span> <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span>
        <span class="token function">glfwSetWindowShouldClose</span><span class="token punctuation">(</span>window <span class="token punctuation">,</span> true<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">glfwInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// OpenGL：3.3核心版本</span>
    <span class="token function">glfwWindowHint</span><span class="token punctuation">(</span>GLFW_CONTEXT_VERSION_MAJOR <span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwWindowHint</span><span class="token punctuation">(</span>GLFW_CONTEXT_VERSION_MINOR <span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwWindowHint</span><span class="token punctuation">(</span>GLFW_OPENGL_PROFILE <span class="token punctuation">,</span> GLFW_OPENGL_CORE_PROFILE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwWindowHint</span><span class="token punctuation">(</span>GLFW_OPENGL_FORWARD_COMPAT <span class="token punctuation">,</span> GL_TRUE<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建窗口</span>
    GLFWwindow <span class="token operator">*</span> window <span class="token operator">=</span> <span class="token function">glfwCreateWindow</span><span class="token punctuation">(</span><span class="token number">800</span> <span class="token punctuation">,</span> <span class="token number">600</span> <span class="token punctuation">,</span> <span class="token string">"Hello 3D"</span> <span class="token punctuation">,</span> <span class="token constant">NULL</span> <span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwMakeContextCurrent</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 初始化glad</span>
    <span class="token function">gladLoadGLLoader</span><span class="token punctuation">(</span><span class="token punctuation">(</span>GLADloadproc<span class="token punctuation">)</span>glfwGetProcAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 视口设置</span>
    <span class="token function">glViewport</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">,</span> <span class="token number">800</span> <span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 注册回调函数</span>
    <span class="token function">glfwSetFramebufferSizeCallback</span><span class="token punctuation">(</span>window <span class="token punctuation">,</span> framebuffer_size_callback<span class="token punctuation">)</span><span class="token punctuation">;</span>

    Shader <span class="token function">my_shader</span><span class="token punctuation">(</span><span class="token string">"../src/vertexshader.vs"</span> <span class="token punctuation">,</span> <span class="token string">"../src/fragmentshader.fs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 传入36个顶点，是为了画12个三角形</span>
    <span class="token keyword keyword-float">float</span> vertices<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>

        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>

        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>

         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>

        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>

        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// 注册VBO，VAO并绑定完成设置</span>
    <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> VBO<span class="token punctuation">,</span> VAO<span class="token punctuation">;</span>
    <span class="token function">glGenVertexArrays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>VAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glGenBuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>VBO<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>VAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> VBO<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">glBufferData</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>vertices<span class="token punctuation">)</span><span class="token punctuation">,</span> vertices<span class="token punctuation">,</span> GL_STATIC_DRAW<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 解除绑定VBO，VAO</span>
    <span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token function">glBindVertexArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

    <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> texture1<span class="token punctuation">;</span>
    <span class="token function">glGenTextures</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>texture1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> texture1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 为当前绑定的纹理对象设置环绕、过滤方式</span>
    <span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_WRAP_S<span class="token punctuation">,</span> GL_REPEAT<span class="token punctuation">)</span><span class="token punctuation">;</span>   
    <span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_WRAP_T<span class="token punctuation">,</span> GL_REPEAT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_MIN_FILTER<span class="token punctuation">,</span> GL_LINEAR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_MAG_FILTER<span class="token punctuation">,</span> GL_LINEAR<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 加载并生成纹理</span>
    <span class="token keyword keyword-int">int</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> nrChannels<span class="token punctuation">;</span>
    <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-char">char</span> <span class="token operator">*</span>data <span class="token operator">=</span> <span class="token function">stbi_load</span><span class="token punctuation">(</span><span class="token string">"../wall.jpg"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>width<span class="token punctuation">,</span> <span class="token operator">&amp;</span>height<span class="token punctuation">,</span> <span class="token operator">&amp;</span>nrChannels<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">glTexImage2D</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GL_RGB<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GL_RGB<span class="token punctuation">,</span> GL_UNSIGNED_BYTE<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glGenerateMipmap</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">stbi_image_free</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> texture2<span class="token punctuation">;</span>
    <span class="token function">glGenTextures</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>texture2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> texture2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 为当前绑定的纹理对象设置环绕、过滤方式</span>
    <span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_WRAP_S<span class="token punctuation">,</span> GL_REPEAT<span class="token punctuation">)</span><span class="token punctuation">;</span>   
    <span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_WRAP_T<span class="token punctuation">,</span> GL_REPEAT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_MIN_FILTER<span class="token punctuation">,</span> GL_LINEAR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_MAG_FILTER<span class="token punctuation">,</span> GL_LINEAR<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">stbi_set_flip_vertically_on_load</span><span class="token punctuation">(</span>true<span class="token punctuation">)</span><span class="token punctuation">;</span>
    data <span class="token operator">=</span> <span class="token function">stbi_load</span><span class="token punctuation">(</span><span class="token string">"../awesomeface.png"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>width<span class="token punctuation">,</span> <span class="token operator">&amp;</span>height<span class="token punctuation">,</span> <span class="token operator">&amp;</span>nrChannels<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">glTexImage2D</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GL_RGBA<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GL_RGBA<span class="token punctuation">,</span> GL_UNSIGNED_BYTE<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glGenerateMipmap</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">stbi_image_free</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

    my_shader<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    my_shader<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token string">"texture1"</span> <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    my_shader<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token string">"texture2"</span> <span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">glEnable</span><span class="token punctuation">(</span>GL_DEPTH_TEST<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 渲染循环</span>
    <span class="token keyword keyword-while">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">glfwWindowShouldClose</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">processInput</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 按下Esc后退出</span>

        <span class="token comment">// 清屏设置</span>
        <span class="token function">glClearColor</span><span class="token punctuation">(</span><span class="token number">0.2f</span> <span class="token punctuation">,</span> <span class="token number">0.3f</span> <span class="token punctuation">,</span> <span class="token number">0.3f</span> <span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token function">glClear</span><span class="token punctuation">(</span>GL_COLOR_BUFFER_BIT <span class="token operator">|</span> GL_DEPTH_BUFFER_BIT<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        
        my_shader<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token function">glActiveTexture</span><span class="token punctuation">(</span>GL_TEXTURE0<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> texture1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glActiveTexture</span><span class="token punctuation">(</span>GL_TEXTURE1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> texture2<span class="token punctuation">)</span><span class="token punctuation">;</span>

        glm<span class="token operator">::</span>mat4 model <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">mat4</span><span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        glm<span class="token operator">::</span>mat4 view <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">mat4</span><span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        glm<span class="token operator">::</span>mat4 proj <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">mat4</span><span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        model <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">rotate</span><span class="token punctuation">(</span>model <span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token function">glfwGetTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">,</span> glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.5f</span> <span class="token punctuation">,</span> <span class="token number">1.0f</span> <span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        view <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">translate</span><span class="token punctuation">(</span>view <span class="token punctuation">,</span> glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0f</span> <span class="token punctuation">,</span> <span class="token number">0.0f</span> <span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3.0f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        proj <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">perspective</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">radians</span><span class="token punctuation">(</span><span class="token number">45.0f</span><span class="token punctuation">)</span> <span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span> <span class="token number">800.0f</span> <span class="token operator">/</span> <span class="token number">600.0f</span> <span class="token punctuation">,</span> <span class="token number">0.1f</span> <span class="token punctuation">,</span> <span class="token number">100.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        my_shader<span class="token punctuation">.</span><span class="token function">setMat4</span><span class="token punctuation">(</span><span class="token string">"model"</span> <span class="token punctuation">,</span> model<span class="token punctuation">)</span><span class="token punctuation">;</span>
        my_shader<span class="token punctuation">.</span><span class="token function">setMat4</span><span class="token punctuation">(</span><span class="token string">"view"</span> <span class="token punctuation">,</span> view<span class="token punctuation">)</span><span class="token punctuation">;</span>
        my_shader<span class="token punctuation">.</span><span class="token function">setMat4</span><span class="token punctuation">(</span><span class="token string">"projection"</span> <span class="token punctuation">,</span> proj<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>VAO<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token function">glDrawArrays</span><span class="token punctuation">(</span>GL_TRIANGLES <span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">glfwSwapBuffers</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glfwPollEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>

    <span class="token comment">// 释放资源</span>
    <span class="token function">glDeleteVertexArrays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>VAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glDeleteBuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>VBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwTerminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></details>
<h2 id="摄像机">摄像机 </h2>
<h3 id="lookat">LookAt </h3>
<p>完全确定摄像机看到的世界，也就是观察坐标，至少需要知道有关摄像机的如下信息：<br>
位置，摄像机摆在哪儿，在上一节例子中为(0 , 0 , 3);<br>
目标，摄像机看向哪儿，在上一节例子中为(0 , 0 , 0)，即看向原点；<br>
实际上重要的是看向的方向，只不过通过目标和位置可以容易地得到；</p>
<p>以上两点还不够，因为我们仍旧可以使摄像机绕着看向的方向转动；<br>
因此我们还需要定义一个摄像机的向上方向；<br>
在上一节例子中，上方向为(0 , 1 , 0)；</p>
<p>原则上，通过以上三个信息就可以得到view矩阵；<br>
但是求解起来还是略有一些繁琐，好在OpenGL帮我们实现了这一点，使用如下方法即可快速得到view矩阵：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>glm<span class="token operator">::</span>mat4 view<span class="token punctuation">;</span>
view <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">lookAt</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">3.0f</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
           glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
           glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 三个参数分别为:位置,目标,上方向</span>
</code></pre><h3 id="位置移动">位置移动 </h3>
<p>让相机的位置随着用户的指令移动,就有了探索世界的感觉;<br>
在程序上,其实不难实现,我们只需要把移动方向设置好即可:</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>glm<span class="token operator">::</span>vec3 cameraPos   <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">3.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
glm<span class="token operator">::</span>vec3 cameraFront <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
glm<span class="token operator">::</span>vec3 cameraUp    <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

view <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">lookAt</span><span class="token punctuation">(</span>cameraPos<span class="token punctuation">,</span> cameraPos <span class="token operator">+</span> cameraFront<span class="token punctuation">,</span> cameraUp<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">processInput</span><span class="token punctuation">(</span>GLFWwindow <span class="token operator">*</span>window<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword keyword-float">float</span> cameraSpeed <span class="token operator">=</span> <span class="token number">0.05f</span><span class="token punctuation">;</span> 

    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">glfwGetKey</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> GLFW_KEY_W<span class="token punctuation">)</span> <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span>
        cameraPos <span class="token operator">+=</span> cameraSpeed <span class="token operator">*</span> cameraFront<span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">glfwGetKey</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> GLFW_KEY_S<span class="token punctuation">)</span> <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span>
        cameraPos <span class="token operator">-=</span> cameraSpeed <span class="token operator">*</span> cameraFront<span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">glfwGetKey</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> GLFW_KEY_A<span class="token punctuation">)</span> <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span>
        cameraPos <span class="token operator">-=</span> glm<span class="token operator">::</span><span class="token function">normalize</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">cross</span><span class="token punctuation">(</span>cameraFront<span class="token punctuation">,</span> cameraUp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> cameraSpeed<span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">glfwGetKey</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> GLFW_KEY_D<span class="token punctuation">)</span> <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span>
        cameraPos <span class="token operator">+=</span> glm<span class="token operator">::</span><span class="token function">normalize</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">cross</span><span class="token punctuation">(</span>cameraFront<span class="token punctuation">,</span> cameraUp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> cameraSpeed<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>目前的移动速度是个常数，看起来没什么问题；<br>
但是实际上，这会导致在不同处理器下，移动速度不同；<br>
具体而言，处理器的不同会导致渲染每一帧的时间不同；<br>
因此调用processInput的频率就不同，调用的越多就会移动地越快；</p>
<p>解决问题的方式是让我们设定的常数是真正意义上的速度；<br>
而非之前所设置的每一帧的移动距离；<br>
因此我们还需要用到一个参数，也就是两帧之间的时间差；</p>
<p>具体而言，代码实现如下：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">// 全局变量</span>
<span class="token keyword keyword-float">float</span> deltaTime <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span> 
<span class="token keyword keyword-float">float</span> lastFrame <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span> 

<span class="token comment">// 渲染循环中</span>
<span class="token keyword keyword-float">float</span> currentFrame <span class="token operator">=</span> <span class="token function">glfwGetTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
deltaTime <span class="token operator">=</span> currentFrame <span class="token operator">-</span> lastFrame<span class="token punctuation">;</span>
lastFrame <span class="token operator">=</span> currentFrame<span class="token punctuation">;</span>

<span class="token comment">// processInput函数</span>
<span class="token keyword keyword-float">float</span> cameraSpeed <span class="token operator">=</span> <span class="token number">2.5f</span> <span class="token operator">*</span> deltaTime<span class="token punctuation">;</span>
</code></pre><h3 id="视角移动">视角移动 </h3>
<p>只用键盘移动有些单调，其原因在于cameraFront不能移动；<br>
我们希望根据鼠标移动改变cameraFront向量；</p>
<p>这里需要欧拉角的概念：<br>
<img src="..\assets\images\learning opengl\image-9.png" alt="alt text"></p>
<p>对于摄像机系统，pitch和yaw是重要的，翻滚的意义不大(摄像机并不会翻滚)；<br>
因此我们的目的是通过两个角度pitch , yaw得到cameraFront向量；</p>
<p>以下两图清晰地表明了几何关系：</p>
<div style="display: flex; gap: 10px; ">
  <div style="flex: 1; ">
    <img src="..\assets\images\learning opengl\image-10.png" alt="pitch" style="width: 100%; ">
  </div>
  <div style="flex: 1;">
    <img src="..\assets\images\learning opengl\image-11.png" alt="yaw" style="width: 100%;">
  </div>
</div>
<p>于是可以得到方向向量：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>direction<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token function">cos</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">radians</span><span class="token punctuation">(</span>pitch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">cos</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">radians</span><span class="token punctuation">(</span>yaw<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
direction<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">radians</span><span class="token punctuation">(</span>pitch<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
direction<span class="token punctuation">.</span>z <span class="token operator">=</span> <span class="token function">cos</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">radians</span><span class="token punctuation">(</span>pitch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">sin</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">radians</span><span class="token punctuation">(</span>yaw<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>现在的问题是如何通过鼠标输入得到pitch和yaw；<br>
这里的方法是，当前帧鼠标和上一帧鼠标的竖直/水平位移大小；<br>
对应了pitch/yaw的角度大小；</p>
<p>首先我们要让光标不显示，并只能被我们的程序所使用，直至退出：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token function">glfwSetInputMode</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> GLFW_CURSOR<span class="token punctuation">,</span> GLFW_CURSOR_DISABLED<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>鼠标回调的完整代码如下：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token function">glfwSetCursorPosCallback</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> mouse_callback<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">mouse_callback</span><span class="token punctuation">(</span>GLFWwindow<span class="token operator">*</span> window<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> xpos<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> ypos<span class="token punctuation">)</span>
<span class="token punctuation">{</span>   
    <span class="token comment">// 初始为1，为了防止刚进入程序时跳动</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>firstMouse<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        lastX <span class="token operator">=</span> xpos<span class="token punctuation">;</span>
        lastY <span class="token operator">=</span> ypos<span class="token punctuation">;</span>
        firstMouse <span class="token operator">=</span> false<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-float">float</span> xoffset <span class="token operator">=</span> xpos <span class="token operator">-</span> lastX<span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> yoffset <span class="token operator">=</span> lastY <span class="token operator">-</span> ypos<span class="token punctuation">;</span> 
    lastX <span class="token operator">=</span> xpos<span class="token punctuation">;</span>
    lastY <span class="token operator">=</span> ypos<span class="token punctuation">;</span>

    <span class="token comment">// 防止太敏感</span>
    <span class="token keyword keyword-float">float</span> sensitivity <span class="token operator">=</span> <span class="token number">0.05</span><span class="token punctuation">;</span>
    xoffset <span class="token operator">*=</span> sensitivity<span class="token punctuation">;</span>
    yoffset <span class="token operator">*=</span> sensitivity<span class="token punctuation">;</span>

    <span class="token comment">// 全局变量</span>
    yaw   <span class="token operator">+=</span> xoffset<span class="token punctuation">;</span>
    pitch <span class="token operator">+=</span> yoffset<span class="token punctuation">;</span>

    <span class="token comment">// 防止俯仰角转过了</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>pitch <span class="token operator">&gt;</span> <span class="token number">89.0f</span><span class="token punctuation">)</span>
        pitch <span class="token operator">=</span> <span class="token number">89.0f</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>pitch <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">89.0f</span><span class="token punctuation">)</span>
        pitch <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">89.0f</span><span class="token punctuation">;</span>

    glm<span class="token operator">::</span>vec3 front<span class="token punctuation">;</span>
    front<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token function">cos</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">radians</span><span class="token punctuation">(</span>yaw<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">cos</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">radians</span><span class="token punctuation">(</span>pitch<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    front<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">radians</span><span class="token punctuation">(</span>pitch<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    front<span class="token punctuation">.</span>z <span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">radians</span><span class="token punctuation">(</span>yaw<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">cos</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">radians</span><span class="token punctuation">(</span>pitch<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cameraFront <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">normalize</span><span class="token punctuation">(</span>front<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>需要注意设置pitch的初始值0，yaw的初始值-90，因为初始看向-z方向；</p>
<h3 id="视角大小">视角大小 </h3>
<p>我们希望能够使用滚轮来调整视角大小；<br>
需要注册相应的回调函数：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-void">void</span> <span class="token function">scroll_callback</span><span class="token punctuation">(</span>GLFWwindow<span class="token operator">*</span> window<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> xoffset<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> yoffset<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// 视角大小限制在1 ~ 45度 </span>
  <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>fov <span class="token operator">&gt;=</span> <span class="token number">1.0f</span> <span class="token operator">&amp;&amp;</span> fov <span class="token operator">&lt;=</span> <span class="token number">45.0f</span><span class="token punctuation">)</span>
    fov <span class="token operator">-=</span> yoffset<span class="token punctuation">;</span>
  <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>fov <span class="token operator">&lt;=</span> <span class="token number">1.0f</span><span class="token punctuation">)</span>
    fov <span class="token operator">=</span> <span class="token number">1.0f</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>fov <span class="token operator">&gt;=</span> <span class="token number">45.0f</span><span class="token punctuation">)</span>
    fov <span class="token operator">=</span> <span class="token number">45.0f</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">glfwSetScrollCallback</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> scroll_callback<span class="token punctuation">)</span><span class="token punctuation">;</span>

projection <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">perspective</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">radians</span><span class="token punctuation">(</span>fov<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">800.0f</span> <span class="token operator">/</span> <span class="token number">600.0f</span><span class="token punctuation">,</span> <span class="token number">0.1f</span><span class="token punctuation">,</span> <span class="token number">100.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="摄像机类">摄像机类 </h3>
<p>为了简化代码，可以把有关摄像机的设置塞到一个类中；<br>
不过个人感觉实际上也并没有太多的简化，只是把回调函数打包了一下；</p>
<h1 id="光照">光照 </h1>
<h2 id="颜色">颜色 </h2>
<h3 id="物体颜色">物体颜色 </h3>
<p>颜色通常用三维向量表示，分别表示红绿蓝三个通道；<br>
1.0表示最亮，0.0表示最暗；</p>
<p>更物理地，我们认为物体的颜色是反射各种颜色光的能力；<br>
光本身也有颜色，用一个颜色向量表述；<br>
因此我们看到的物体颜色，不仅跟物体本身有关，也跟光的颜色有关；</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>glm<span class="token operator">::</span>vec3 <span class="token function">lightColor</span><span class="token punctuation">(</span><span class="token number">0.33f</span><span class="token punctuation">,</span> <span class="token number">0.42f</span><span class="token punctuation">,</span> <span class="token number">0.18f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
glm<span class="token operator">::</span>vec3 <span class="token function">toyColor</span><span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token number">0.31f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
glm<span class="token operator">::</span>vec3 result <span class="token operator">=</span> lightColor <span class="token operator">*</span> toyColor<span class="token punctuation">;</span>
</code></pre><h3 id="光照场景">光照场景 </h3>
<p>我们想在场景中呈现光源和物体；<br>
为了简单起见，光源和物体都视为立方体，因此可以用完全相同的VBO；</p>
<p>需要注意的是，我们为光源单独维护一个VAO；<br>
其目的是后续章节，可能对于物体的各个属性会有增加、修改等(纹理、颜色等)；<br>
但是对于光源，我们只需要坐标这一个“窗口”打开即可；<br>
同时，使用相同的VBO可以减少在GPU中占用的内存；</p>
<p>此外，我们想要强行让光源可见；<br>
光源的颜色和物体的颜色有所不同；<br>
光源的颜色我们只需要保持为白光即可，物体需要根据光照颜色和物体本身的颜色来确定最终片段的颜色；</p>
<p>完整的main.cpp代码如下：</p>
<details>
<summary>main.cpp</summary>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;glad/glad.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;GLFW/glfw3.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stb_image.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;glm/glm.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;glm/gtc/matrix_transform.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;glm/gtc/type_ptr.hpp&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;shader.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cmath&gt;</span></span>

<span class="token comment">// 注册回调函数，相应窗口大小的调整</span>
<span class="token keyword keyword-void">void</span> <span class="token function">framebuffer_size_callback</span><span class="token punctuation">(</span>GLFWwindow <span class="token operator">*</span> window <span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> width <span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> height<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">glViewport</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">,</span> width <span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-float">float</span> deltaTime <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span> 
<span class="token keyword keyword-float">float</span> lastFrame <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span> 

<span class="token keyword keyword-bool">bool</span> firstMouse <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword keyword-float">float</span> lastX <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
<span class="token keyword keyword-float">float</span> lastY <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
<span class="token keyword keyword-float">float</span> pitch <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
<span class="token comment">// 初始时看向 -z方向，yaw为-90度</span>
<span class="token keyword keyword-float">float</span> yaw <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">90.0f</span><span class="token punctuation">;</span>

<span class="token keyword keyword-float">float</span> fov <span class="token operator">=</span> <span class="token number">45.0f</span><span class="token punctuation">;</span>

glm<span class="token double-colon punctuation">::</span>vec3 cameraPos   <span class="token operator">=</span> glm<span class="token double-colon punctuation">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">3.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
glm<span class="token double-colon punctuation">::</span>vec3 cameraFront <span class="token operator">=</span> glm<span class="token double-colon punctuation">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
glm<span class="token double-colon punctuation">::</span>vec3 cameraUp    <span class="token operator">=</span> glm<span class="token double-colon punctuation">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

glm<span class="token double-colon punctuation">::</span>vec3 <span class="token function">lightPos</span><span class="token punctuation">(</span><span class="token number">1.2f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">2.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">processInput</span><span class="token punctuation">(</span>GLFWwindow <span class="token operator">*</span>window<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token function">glfwGetKey</span><span class="token punctuation">(</span>window <span class="token punctuation">,</span> GLFW_KEY_ESCAPE<span class="token punctuation">)</span> <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span>
        <span class="token function">glfwSetWindowShouldClose</span><span class="token punctuation">(</span>window <span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// float cameraSpeed = 0.05f; </span>
    <span class="token keyword keyword-float">float</span> cameraSpeed <span class="token operator">=</span> <span class="token number">2.5f</span> <span class="token operator">*</span> deltaTime<span class="token punctuation">;</span>
    
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">glfwGetKey</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> GLFW_KEY_W<span class="token punctuation">)</span> <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span>
        cameraPos <span class="token operator">+=</span> cameraSpeed <span class="token operator">*</span> cameraFront<span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">glfwGetKey</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> GLFW_KEY_S<span class="token punctuation">)</span> <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span>
        cameraPos <span class="token operator">-=</span> cameraSpeed <span class="token operator">*</span> cameraFront<span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">glfwGetKey</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> GLFW_KEY_A<span class="token punctuation">)</span> <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span>
        cameraPos <span class="token operator">-=</span> glm<span class="token double-colon punctuation">::</span><span class="token function">normalize</span><span class="token punctuation">(</span>glm<span class="token double-colon punctuation">::</span><span class="token function">cross</span><span class="token punctuation">(</span>cameraFront<span class="token punctuation">,</span> cameraUp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> cameraSpeed<span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">glfwGetKey</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> GLFW_KEY_D<span class="token punctuation">)</span> <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span>
        cameraPos <span class="token operator">+=</span> glm<span class="token double-colon punctuation">::</span><span class="token function">normalize</span><span class="token punctuation">(</span>glm<span class="token double-colon punctuation">::</span><span class="token function">cross</span><span class="token punctuation">(</span>cameraFront<span class="token punctuation">,</span> cameraUp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> cameraSpeed<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">mouse_callback</span><span class="token punctuation">(</span>GLFWwindow<span class="token operator">*</span> window<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> xpos<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> ypos<span class="token punctuation">)</span>
<span class="token punctuation">{</span>   
    <span class="token comment">// 初始为1，为了防止刚进入程序时跳动</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>firstMouse<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        lastX <span class="token operator">=</span> xpos<span class="token punctuation">;</span>
        lastY <span class="token operator">=</span> ypos<span class="token punctuation">;</span>
        firstMouse <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-float">float</span> xoffset <span class="token operator">=</span> xpos <span class="token operator">-</span> lastX<span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> yoffset <span class="token operator">=</span> lastY <span class="token operator">-</span> ypos<span class="token punctuation">;</span> 
    lastX <span class="token operator">=</span> xpos<span class="token punctuation">;</span>
    lastY <span class="token operator">=</span> ypos<span class="token punctuation">;</span>

    <span class="token comment">// 防止太敏感</span>
    <span class="token keyword keyword-float">float</span> sensitivity <span class="token operator">=</span> <span class="token number">0.05</span><span class="token punctuation">;</span>
    xoffset <span class="token operator">*=</span> sensitivity<span class="token punctuation">;</span>
    yoffset <span class="token operator">*=</span> sensitivity<span class="token punctuation">;</span>

    <span class="token comment">// 全局变量</span>
    yaw   <span class="token operator">+=</span> xoffset<span class="token punctuation">;</span>
    pitch <span class="token operator">+=</span> yoffset<span class="token punctuation">;</span>

    <span class="token comment">// 防止俯仰角转过了</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>pitch <span class="token operator">&gt;</span> <span class="token number">89.0f</span><span class="token punctuation">)</span>
        pitch <span class="token operator">=</span> <span class="token number">89.0f</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>pitch <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">89.0f</span><span class="token punctuation">)</span>
        pitch <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">89.0f</span><span class="token punctuation">;</span>

    glm<span class="token double-colon punctuation">::</span>vec3 front<span class="token punctuation">;</span>
    front<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token function">cos</span><span class="token punctuation">(</span>glm<span class="token double-colon punctuation">::</span><span class="token function">radians</span><span class="token punctuation">(</span>yaw<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">cos</span><span class="token punctuation">(</span>glm<span class="token double-colon punctuation">::</span><span class="token function">radians</span><span class="token punctuation">(</span>pitch<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    front<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span>glm<span class="token double-colon punctuation">::</span><span class="token function">radians</span><span class="token punctuation">(</span>pitch<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    front<span class="token punctuation">.</span>z <span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span>glm<span class="token double-colon punctuation">::</span><span class="token function">radians</span><span class="token punctuation">(</span>yaw<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">cos</span><span class="token punctuation">(</span>glm<span class="token double-colon punctuation">::</span><span class="token function">radians</span><span class="token punctuation">(</span>pitch<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cameraFront <span class="token operator">=</span> glm<span class="token double-colon punctuation">::</span><span class="token function">normalize</span><span class="token punctuation">(</span>front<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">scroll_callback</span><span class="token punctuation">(</span>GLFWwindow<span class="token operator">*</span> window<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> xoffset<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> yoffset<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// 视角大小限制在1 ~ 45度 </span>
  <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>fov <span class="token operator">&gt;=</span> <span class="token number">1.0f</span> <span class="token operator">&amp;&amp;</span> fov <span class="token operator">&lt;=</span> <span class="token number">45.0f</span><span class="token punctuation">)</span>
    fov <span class="token operator">-=</span> yoffset<span class="token punctuation">;</span>
  <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>fov <span class="token operator">&lt;=</span> <span class="token number">1.0f</span><span class="token punctuation">)</span>
    fov <span class="token operator">=</span> <span class="token number">1.0f</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>fov <span class="token operator">&gt;=</span> <span class="token number">45.0f</span><span class="token punctuation">)</span>
    fov <span class="token operator">=</span> <span class="token number">45.0f</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">glfwInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// OpenGL：3.3核心版本</span>
    <span class="token function">glfwWindowHint</span><span class="token punctuation">(</span>GLFW_CONTEXT_VERSION_MAJOR <span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwWindowHint</span><span class="token punctuation">(</span>GLFW_CONTEXT_VERSION_MINOR <span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwWindowHint</span><span class="token punctuation">(</span>GLFW_OPENGL_PROFILE <span class="token punctuation">,</span> GLFW_OPENGL_CORE_PROFILE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwWindowHint</span><span class="token punctuation">(</span>GLFW_OPENGL_FORWARD_COMPAT <span class="token punctuation">,</span> GL_TRUE<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建窗口</span>
    GLFWwindow <span class="token operator">*</span> window <span class="token operator">=</span> <span class="token function">glfwCreateWindow</span><span class="token punctuation">(</span><span class="token number">800</span> <span class="token punctuation">,</span> <span class="token number">600</span> <span class="token punctuation">,</span> <span class="token string">"Hello 3D"</span> <span class="token punctuation">,</span> <span class="token constant">NULL</span> <span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwMakeContextCurrent</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 光标捕捉</span>
    <span class="token function">glfwSetInputMode</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> GLFW_CURSOR<span class="token punctuation">,</span> GLFW_CURSOR_DISABLED<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 初始化glad</span>
    <span class="token function">gladLoadGLLoader</span><span class="token punctuation">(</span><span class="token punctuation">(</span>GLADloadproc<span class="token punctuation">)</span>glfwGetProcAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 视口设置</span>
    <span class="token function">glViewport</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">,</span> <span class="token number">800</span> <span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 注册回调函数</span>
    <span class="token function">glfwSetFramebufferSizeCallback</span><span class="token punctuation">(</span>window <span class="token punctuation">,</span> framebuffer_size_callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwSetCursorPosCallback</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> mouse_callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwSetScrollCallback</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> scroll_callback<span class="token punctuation">)</span><span class="token punctuation">;</span>

    Shader <span class="token function">obj_shader</span><span class="token punctuation">(</span><span class="token string">"../src/object.vs"</span> <span class="token punctuation">,</span> <span class="token string">"../src/object.fs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Shader <span class="token function">light_shader</span><span class="token punctuation">(</span><span class="token string">"../src/object.vs"</span> <span class="token punctuation">,</span> <span class="token string">"../src/light.fs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">pragma</span> <span class="token expression">region 物体 <span class="token operator">&amp;</span> 光源设置</span></span>
    <span class="token comment">// 传入36个顶点，是为了画12个三角形</span>
    <span class="token keyword keyword-float">float</span> vertices<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> 
         <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  
         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  
         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> 
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> 

        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> 
         <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  
         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  
         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> 
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> 

        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> 
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> 
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> 
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> 
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> 
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> 

         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  
         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  
         <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  
         <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  
         <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  
         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  

        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> 
         <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  
         <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  
         <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> 
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> 

        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> 
         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  
         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  
         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> 
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> 
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// 注册VBO，VAO并绑定完成设置</span>
    <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> VBO<span class="token punctuation">,</span> objVAO <span class="token punctuation">,</span> lightVAO<span class="token punctuation">;</span>
    <span class="token function">glGenVertexArrays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>objVAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glGenBuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>VBO<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// VBO传入</span>
    <span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> VBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBufferData</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>vertices<span class="token punctuation">)</span><span class="token punctuation">,</span> vertices<span class="token punctuation">,</span> GL_STATIC_DRAW<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 物体VAO设置</span>
    <span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>objVAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token number">3</span> <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 光源VAO设置</span>
    <span class="token function">glGenVertexArrays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>lightVAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>lightVAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token number">3</span> <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 解除绑定VBO，VAO</span>
    <span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token function">glBindVertexArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

    <span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">pragma</span> <span class="token expression">endregion</span></span>

    <span class="token function">glEnable</span><span class="token punctuation">(</span>GL_DEPTH_TEST<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 渲染循环</span>
    <span class="token keyword keyword-while">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">glfwWindowShouldClose</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword keyword-float">float</span> currentFrame <span class="token operator">=</span> <span class="token function">glfwGetTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        deltaTime <span class="token operator">=</span> currentFrame <span class="token operator">-</span> lastFrame<span class="token punctuation">;</span>
        lastFrame <span class="token operator">=</span> currentFrame<span class="token punctuation">;</span>

        <span class="token function">processInput</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 按下Esc后退出</span>

        <span class="token comment">// 清屏设置</span>
        <span class="token function">glClearColor</span><span class="token punctuation">(</span><span class="token number">0.1f</span> <span class="token punctuation">,</span> <span class="token number">0.1f</span> <span class="token punctuation">,</span> <span class="token number">0.1f</span> <span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token function">glClear</span><span class="token punctuation">(</span>GL_COLOR_BUFFER_BIT <span class="token operator">|</span> GL_DEPTH_BUFFER_BIT<span class="token punctuation">)</span><span class="token punctuation">;</span> 

         <span class="token comment">// view , proj设置，对于物体和光源一致</span>
        glm<span class="token double-colon punctuation">::</span>mat4 view <span class="token operator">=</span> glm<span class="token double-colon punctuation">::</span><span class="token function">mat4</span><span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        glm<span class="token double-colon punctuation">::</span>mat4 proj <span class="token operator">=</span> glm<span class="token double-colon punctuation">::</span><span class="token function">mat4</span><span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        view <span class="token operator">=</span> glm<span class="token double-colon punctuation">::</span><span class="token function">lookAt</span><span class="token punctuation">(</span>cameraPos<span class="token punctuation">,</span> cameraPos <span class="token operator">+</span> cameraFront<span class="token punctuation">,</span> cameraUp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        proj <span class="token operator">=</span> glm<span class="token double-colon punctuation">::</span><span class="token function">perspective</span><span class="token punctuation">(</span>glm<span class="token double-colon punctuation">::</span><span class="token function">radians</span><span class="token punctuation">(</span>fov<span class="token punctuation">)</span> <span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span> <span class="token number">800.0f</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token number">600.0f</span> <span class="token punctuation">,</span> <span class="token number">0.1f</span> <span class="token punctuation">,</span> <span class="token number">100.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 画物体</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"objectColor"</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token number">0.31f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"lightColor"</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        obj_shader<span class="token punctuation">.</span><span class="token function">setMat4</span><span class="token punctuation">(</span><span class="token string">"view"</span> <span class="token punctuation">,</span> view<span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setMat4</span><span class="token punctuation">(</span><span class="token string">"projection"</span> <span class="token punctuation">,</span> proj<span class="token punctuation">)</span><span class="token punctuation">;</span>

        glm<span class="token double-colon punctuation">::</span>mat4 model <span class="token operator">=</span> glm<span class="token double-colon punctuation">::</span><span class="token function">mat4</span><span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setMat4</span><span class="token punctuation">(</span><span class="token string">"model"</span> <span class="token punctuation">,</span> model<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>objVAO<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token function">glDrawArrays</span><span class="token punctuation">(</span>GL_TRIANGLES<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 画光源</span>
        light_shader<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        light_shader<span class="token punctuation">.</span><span class="token function">setMat4</span><span class="token punctuation">(</span><span class="token string">"view"</span> <span class="token punctuation">,</span> view<span class="token punctuation">)</span><span class="token punctuation">;</span>
        light_shader<span class="token punctuation">.</span><span class="token function">setMat4</span><span class="token punctuation">(</span><span class="token string">"projection"</span> <span class="token punctuation">,</span> proj<span class="token punctuation">)</span><span class="token punctuation">;</span>
        model <span class="token operator">=</span> glm<span class="token double-colon punctuation">::</span><span class="token function">mat4</span><span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model <span class="token operator">=</span> glm<span class="token double-colon punctuation">::</span><span class="token function">translate</span><span class="token punctuation">(</span>model <span class="token punctuation">,</span> lightPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
        model <span class="token operator">=</span> glm<span class="token double-colon punctuation">::</span><span class="token function">scale</span><span class="token punctuation">(</span>model <span class="token punctuation">,</span> glm<span class="token double-colon punctuation">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.2f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        light_shader<span class="token punctuation">.</span><span class="token function">setMat4</span><span class="token punctuation">(</span><span class="token string">"model"</span> <span class="token punctuation">,</span> model<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>lightVAO<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token function">glDrawArrays</span><span class="token punctuation">(</span>GL_TRIANGLES<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">glfwSwapBuffers</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glfwPollEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>

    <span class="token comment">// 释放资源</span>
    <span class="token function">glDeleteVertexArrays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>objVAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glDeleteVertexArrays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>lightVAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glDeleteBuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>VBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwTerminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></details>
<h2 id="基础光照">基础光照 </h2>
<h3 id="phong-光照模型">Phong 光照模型 </h3>
<p>为了一定程度上模拟真实光照，把光照贡献分为三个部分：<br>
环境光照(ambient)：环境亮度；<br>
漫反射光照(diffuse)：物体本身的色彩；<br>
镜面光照(specular)：反光、高光效果；<br>
<img src="..\assets\images\learning opengl\image-12.png" alt="alt text"></p>
<h3 id="环境光">环境光 </h3>
<p>出于简单考虑，现在我们认为环境光是一个很小的常数；<br>
因此只需要在物体片段着色器中设置：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-float">float</span> ambientStrength <span class="token operator">=</span> <span class="token number">0.1</span><span class="token punctuation">;</span>
vec3 ambient <span class="token operator">=</span> ambientStrength <span class="token operator">*</span> lightColor<span class="token punctuation">;</span>
</code></pre><h3 id="漫反射">漫反射 </h3>
<p>漫反射项的贡献也很简单；<br>
就是记录光源到物体表面的方向与法向的夹角<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span></span>；<br>
<img src="..\assets\images\learning opengl\image-13.png" alt="alt text"><br>
把对应的光照贡献乘上<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\cos(\theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span></span>即可；</p>
<p>不过这要求我们记录法向量；<br>
现阶段，我们需要在顶点数据中手动输入法向量；<br>
我们输入的顶点法向量实际上是每一个需要绘制的三角形的法向量；</p>
<details>
<summary>vertices</summary>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-float">float</span> vertices<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>
     <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> 
     <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> 
     <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> 
    <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> 
    <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> 

    <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
     <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
     <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
     <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>

    <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>

     <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
     <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
     <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
     <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
     <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
     <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>

    <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
     <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
     <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
     <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>

    <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
     <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
     <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
     <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></details>
<p>为了传递法向量，需要通过顶点着色器转手一下；<br>
同时，后续我们需要计算光源到片段的方向，因此还需要知道片段的位置坐标，也需要用过顶点着色器传递给片段着色器；<br>
同时在片段着色器中，我们还需要传入光源的位置；</p>
<p>需要注意的是，虽然我们把光源画成了一个立方体，但实际上光源充当的效果还是一个点光源；</p>
<p>完整的着色器代码如下所示：</p>
<details>
<summary>object.vs</summary>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">330</span> core</span></span>
<span class="token function">layout</span> <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> in vec3 aPos<span class="token punctuation">;</span>
<span class="token function">layout</span> <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> in vec3 aNormal<span class="token punctuation">;</span>

uniform mat4 model<span class="token punctuation">;</span>
uniform mat4 view<span class="token punctuation">;</span>
uniform mat4 projection<span class="token punctuation">;</span>

out vec3 FragPos<span class="token punctuation">;</span>
out vec3 Normal<span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>	
	FragPos <span class="token operator">=</span> <span class="token function">vec3</span><span class="token punctuation">(</span>model <span class="token operator">*</span> <span class="token function">vec4</span><span class="token punctuation">(</span>aPos <span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Normal <span class="token operator">=</span> aNormal<span class="token punctuation">;</span>

	gl_Position <span class="token operator">=</span> projection <span class="token operator">*</span> view <span class="token operator">*</span> <span class="token function">vec4</span><span class="token punctuation">(</span>FragPos<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></details>
<details>
<summary>object.fs</summary>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">330</span> core</span></span>
out vec4 FragColor<span class="token punctuation">;</span>

uniform vec3 objectColor<span class="token punctuation">;</span>
uniform vec3 lightColor<span class="token punctuation">;</span>
uniform vec3 lightPos<span class="token punctuation">;</span>

in vec3 Normal<span class="token punctuation">;</span>
in vec3 FragPos<span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>   
    <span class="token keyword keyword-float">float</span> ambientStrength <span class="token operator">=</span> <span class="token number">0.1</span><span class="token punctuation">;</span>
    vec3 ambient <span class="token operator">=</span> ambientStrength <span class="token operator">*</span> lightColor<span class="token punctuation">;</span>

    vec3 norm <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>Normal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    vec3 lightDir <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>lightPos <span class="token operator">-</span> FragPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 负数即看不到，取为0即可</span>
    <span class="token keyword keyword-float">float</span> diff <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>norm <span class="token punctuation">,</span> lightDir<span class="token punctuation">)</span> <span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vec3 diffuse <span class="token operator">=</span> diff <span class="token operator">*</span> lightColor<span class="token punctuation">;</span>

    vec3 result <span class="token punctuation">;</span>
    result <span class="token operator">=</span> <span class="token punctuation">(</span>ambient <span class="token operator">+</span> diffuse<span class="token punctuation">)</span> <span class="token operator">*</span> objectColor<span class="token punctuation">;</span>
    FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></details>
<p>需要注意的是，上面忽略了一个问题，就是传入数据时法线是定义在局部坐标中的；<br>
但是实际上我们使用的是世界坐标中的法线向量；<br>
以上例子没出问题是因为我们还没有进行旋转缩放等操作；<br>
可以预见，需要对法线方向维护一个自己的model矩阵，以实现局部坐标到世界坐标的变换；</p>
<p>注意这个矩阵和位置坐标的model是不一样的；<br>
因为法线是方向向量，不存在平移；<br>
法线矩阵实际上是model的逆的转置；</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>Normal <span class="token operator">=</span> <span class="token function">mat3</span><span class="token punctuation">(</span><span class="token function">transpose</span><span class="token punctuation">(</span><span class="token function">inverse</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> aNormal<span class="token punctuation">;</span>
</code></pre><p>从数学上，也比较容易理解：<br>
切向向量T，法向向量N，切向向量在模型上，符合变换矩阵；<br>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>N</mi><mi>T</mi></msup><mi>T</mi><mo>=</mo><mn>0</mn><mo separator="true">;</mo><mspace linebreak="newline"></mspace><msup><mi>N</mi><mrow><mo mathvariant="normal">′</mo><mi>T</mi></mrow></msup><msup><mi>T</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>=</mo><mn>0</mn><mo separator="true">;</mo><mspace linebreak="newline"></mspace><msup><mi>N</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>=</mo><mi>G</mi><mi>N</mi><mo separator="true">,</mo><msup><mi>T</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>=</mo><mi>M</mi><mi>T</mi><mo separator="true">;</mo><mspace linebreak="newline"></mspace><mo>⇒</mo><msup><mi>N</mi><mi>T</mi></msup><msup><mi>G</mi><mi>T</mi></msup><mi>M</mi><mi>T</mi><mo>=</mo><mn>0</mn><mo separator="true">;</mo><mspace linebreak="newline"></mspace><mo>⇒</mo><msup><mi>G</mi><mi>T</mi></msup><mi>M</mi><mo>=</mo><mi>I</mi><mo separator="true">,</mo><mi>G</mi><mo>=</mo><mo stretchy="false">(</mo><msup><mi>M</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><msup><mo stretchy="false">)</mo><mi>T</mi></msup><mo separator="true">;</mo></mrow><annotation encoding="application/x-tex">N^T T = 0;\\
N'^T T' = 0;\\
N' = G N , T' = M T;\\
\Rightarrow N^T G^T M T = 0;\\
\Rightarrow G^TM = I , G = (M^{-1})^T;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">0</span><span class="mpunct">;</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.8413em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">0</span><span class="mpunct">;</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.7519em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9463em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">GN</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">MT</span><span class="mpunct">;</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">⇒</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8413em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.13889em;">MT</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">0</span><span class="mpunct">;</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">⇒</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8413em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">G</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0913em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mpunct">;</span></span></span></span></p>
<p>需要说明的是，逆矩阵是一个昂贵的操作，这里在顶点着色器中计算并不是很好，实际应该在CPU计算完，把整体的法线矩阵传递到GPU中能得到更好的性能。</p>
<h3 id="镜面光照">镜面光照 </h3>
<p><img src="..\assets\images\learning opengl\image-14.png" alt="alt text"><br>
镜面光照是另一种光照强度的贡献，它说的是如果观察方向和反射光方向约接近，看到的效果应该是越亮的；</p>
<p>为了量化这里所谓的看到的效果更亮，我们引入spec；</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-float">float</span> spec <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>viewDir<span class="token punctuation">,</span> reflectDir<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>它是观察方向(从片段指向观察点)和反射光方向夹角的余弦的32次幂；<br>
这个可以认为是经验公式，据此得出的效果是最好的；</p>
<p>完整的片段着色器代码如下所示：</p>
<details>
<summary>objec.fs</summary>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">330</span> core</span></span>
out vec4 FragColor<span class="token punctuation">;</span>

uniform vec3 objectColor<span class="token punctuation">;</span>
uniform vec3 lightColor<span class="token punctuation">;</span>
uniform vec3 lightPos<span class="token punctuation">;</span>
uniform vec3 viewPos<span class="token punctuation">;</span>

in vec3 Normal<span class="token punctuation">;</span>
in vec3 FragPos<span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>   
    <span class="token keyword keyword-float">float</span> ambientStrength <span class="token operator">=</span> <span class="token number">0.1</span><span class="token punctuation">;</span>
    vec3 ambient <span class="token operator">=</span> ambientStrength <span class="token operator">*</span> lightColor<span class="token punctuation">;</span>

    vec3 norm <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>Normal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    vec3 lightDir <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>lightPos <span class="token operator">-</span> FragPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 负数即看不到，取为0即可</span>
    <span class="token keyword keyword-float">float</span> diff <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>norm <span class="token punctuation">,</span> lightDir<span class="token punctuation">)</span> <span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vec3 diffuse <span class="token operator">=</span> diff <span class="token operator">*</span> lightColor<span class="token punctuation">;</span>

    <span class="token keyword keyword-float">float</span> specularStrength <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
    vec3 viewDir <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>viewPos <span class="token operator">-</span> FragPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 第一个参数是光源指向片段</span>
    vec3 reflectDir <span class="token operator">=</span> <span class="token function">reflect</span><span class="token punctuation">(</span><span class="token operator">-</span>lightDir<span class="token punctuation">,</span> norm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> spec <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>viewDir<span class="token punctuation">,</span> reflectDir<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vec3 specular <span class="token operator">=</span> specularStrength <span class="token operator">*</span> spec <span class="token operator">*</span> lightColor<span class="token punctuation">;</span>

    vec3 result <span class="token punctuation">;</span>
    result <span class="token operator">=</span> <span class="token punctuation">(</span>ambient <span class="token operator">+</span> diffuse <span class="token operator">+</span> specular<span class="token punctuation">)</span> <span class="token operator">*</span> objectColor<span class="token punctuation">;</span>
    FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></details>
现在我们可以看到，随着视角的移动，物体表面的高光表现也会有相应的移动；
<h2 id="材质">材质 </h2>
<p>不论是对于环境光、漫反射还是镜面，其实都有一个与材质相关的系数在之前被我们所忽略了；<br>
在之前，我们认为这个系数是物体本身的颜色objectColor，实际上可以更细分；<br>
对于环境、反射、高光都有各自的objectColor(高光一般会选定为(0.5 , 0.5 , 0.5))；<br>
我们可以把这些系数(包括之前的幂次32，称为反光度，也可以自定义)定义到一个结构体Material中：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-struct">struct</span> <span class="token class-name">Material</span> <span class="token punctuation">{</span>
    vec3 ambient<span class="token punctuation">;</span>
    vec3 diffuse<span class="token punctuation">;</span>
    vec3 specular<span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> shininess<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span> 

uniform Material material<span class="token punctuation">;</span>
</code></pre><p>仿照之前的思路，我们也可以为这三种贡献定义不同的lightColor，也定义成结构体，注意，把光源位置也可以塞到这个结构体中：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-struct">struct</span> <span class="token class-name">Light</span> <span class="token punctuation">{</span>
    vec3 position<span class="token punctuation">;</span>

    vec3 ambient<span class="token punctuation">;</span>
    vec3 diffuse<span class="token punctuation">;</span>
    vec3 specular<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

uniform Light light<span class="token punctuation">;</span>
</code></pre><p>因此，我们可以得到一个灵活度更高的片段着色器：</p>
<details>
<summary>material.fs</summary>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">330</span> core</span></span>
out vec4 FragColor<span class="token punctuation">;</span>

<span class="token keyword keyword-struct">struct</span> <span class="token class-name">Material</span> <span class="token punctuation">{</span>
    vec3 ambient<span class="token punctuation">;</span>
    vec3 diffuse<span class="token punctuation">;</span>
    vec3 specular<span class="token punctuation">;</span>    
    <span class="token keyword keyword-float">float</span> shininess<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span> 

<span class="token keyword keyword-struct">struct</span> <span class="token class-name">Light</span> <span class="token punctuation">{</span>
    vec3 position<span class="token punctuation">;</span>

    vec3 ambient<span class="token punctuation">;</span>
    vec3 diffuse<span class="token punctuation">;</span>
    vec3 specular<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

in vec3 FragPos<span class="token punctuation">;</span>  
in vec3 Normal<span class="token punctuation">;</span>  
  
uniform vec3 viewPos<span class="token punctuation">;</span>
uniform Material material<span class="token punctuation">;</span>
uniform Light light<span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    vec3 ambient <span class="token operator">=</span> light<span class="token punctuation">.</span>ambient <span class="token operator">*</span> material<span class="token punctuation">.</span>ambient<span class="token punctuation">;</span>
  	
    vec3 norm <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>Normal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    vec3 lightDir <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>light<span class="token punctuation">.</span>position <span class="token operator">-</span> FragPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> diff <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>norm<span class="token punctuation">,</span> lightDir<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vec3 diffuse <span class="token operator">=</span> light<span class="token punctuation">.</span>diffuse <span class="token operator">*</span> <span class="token punctuation">(</span>diff <span class="token operator">*</span> material<span class="token punctuation">.</span>diffuse<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    vec3 viewDir <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>viewPos <span class="token operator">-</span> FragPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    vec3 reflectDir <span class="token operator">=</span> <span class="token function">reflect</span><span class="token punctuation">(</span><span class="token operator">-</span>lightDir<span class="token punctuation">,</span> norm<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token keyword keyword-float">float</span> spec <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>viewDir<span class="token punctuation">,</span> reflectDir<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> material<span class="token punctuation">.</span>shininess<span class="token punctuation">)</span><span class="token punctuation">;</span>
    vec3 specular <span class="token operator">=</span> light<span class="token punctuation">.</span>specular <span class="token operator">*</span> <span class="token punctuation">(</span>spec <span class="token operator">*</span> material<span class="token punctuation">.</span>specular<span class="token punctuation">)</span><span class="token punctuation">;</span>  
        
    vec3 result <span class="token operator">=</span> ambient <span class="token operator">+</span> diffuse <span class="token operator">+</span> specular<span class="token punctuation">;</span>
    FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
</code></pre></details>
<h2 id="光照贴图">光照贴图 </h2>
<p>想要绘制出更丰富的物体，光靠手动设置材质参数显然是不够的；<br>
结合之前所学，一种更合理的方式是使用贴图；</p>
<p>对于diffuse值，我们可以使用一张贴图，称为漫反射贴图；<br>
这个贴图基本反映了物体的颜色信息；</p>
<p>对于specular值，我们也可以使用一张镜面高光贴图；<br>
它只有黑白区分，即三个通道分量大小相同；</p>
<p>ambient部分，我们通常认为和diffuse是一样的；</p>
<p>使用贴图的方式和之前所说的基本一致；<br>
需要注意的是我们得把Material结构体中的对应数据类型改成sampler2D；</p>
<p>修改后的片段着色器如下所示：</p>
<details>
<summary>light_texture.fs</summary>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">330</span> core</span></span>
out vec4 FragColor<span class="token punctuation">;</span>

<span class="token keyword keyword-struct">struct</span> <span class="token class-name">Material</span> <span class="token punctuation">{</span>
    sampler2D diffuse<span class="token punctuation">;</span>
    sampler2D specular<span class="token punctuation">;</span>    
    <span class="token keyword keyword-float">float</span> shininess<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span> 

<span class="token keyword keyword-struct">struct</span> <span class="token class-name">Light</span> <span class="token punctuation">{</span>
    vec3 position<span class="token punctuation">;</span>

    vec3 ambient<span class="token punctuation">;</span>
    vec3 diffuse<span class="token punctuation">;</span>
    vec3 specular<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

in vec3 FragPos<span class="token punctuation">;</span>  
in vec3 Normal<span class="token punctuation">;</span>  
in vec2 TexCoords<span class="token punctuation">;</span>
  
uniform vec3 viewPos<span class="token punctuation">;</span>
uniform Material material<span class="token punctuation">;</span>
uniform Light light<span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    vec3 ambient <span class="token operator">=</span> light<span class="token punctuation">.</span>ambient <span class="token operator">*</span> <span class="token function">texture</span><span class="token punctuation">(</span>material<span class="token punctuation">.</span>diffuse<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">.</span>rgb<span class="token punctuation">;</span>
  	
    vec3 norm <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>Normal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    vec3 lightDir <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>light<span class="token punctuation">.</span>position <span class="token operator">-</span> FragPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> diff <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>norm<span class="token punctuation">,</span> lightDir<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vec3 diffuse <span class="token operator">=</span> light<span class="token punctuation">.</span>diffuse <span class="token operator">*</span> diff <span class="token operator">*</span> <span class="token function">texture</span><span class="token punctuation">(</span>material<span class="token punctuation">.</span>diffuse<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">.</span>rgb<span class="token punctuation">;</span>  
    
    vec3 viewDir <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>viewPos <span class="token operator">-</span> FragPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    vec3 reflectDir <span class="token operator">=</span> <span class="token function">reflect</span><span class="token punctuation">(</span><span class="token operator">-</span>lightDir<span class="token punctuation">,</span> norm<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token keyword keyword-float">float</span> spec <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>viewDir<span class="token punctuation">,</span> reflectDir<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> material<span class="token punctuation">.</span>shininess<span class="token punctuation">)</span><span class="token punctuation">;</span>
    vec3 specular <span class="token operator">=</span> light<span class="token punctuation">.</span>specular <span class="token operator">*</span> spec <span class="token operator">*</span> <span class="token function">texture</span><span class="token punctuation">(</span>material<span class="token punctuation">.</span>specular<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">.</span>rgb<span class="token punctuation">;</span>  
        
    vec3 result <span class="token operator">=</span> ambient <span class="token operator">+</span> diffuse <span class="token operator">+</span> specular<span class="token punctuation">;</span>
    FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
</code></pre></details>
<h2 id="光源">光源 </h2>
<h3 id="平行光">平行光 </h3>
<p>之前我们所用的光源是点光源，现在考虑平行光；<br>
对于平行光而言，只有一个描述方向的向量，而没有光源位置；</p>
<p>这里涉及到的代码改动并不多；<br>
只需要把片段着色器中Light类的position用direction代替即可；</p>
<h3 id="点光源">点光源 </h3>
<p>之前我们所用的起始就是点光源，只不过还不够完善；<br>
因为我们还没有考虑到光的强度随之距离的衰减；</p>
<p>我们用如下经验公式来模拟光线衰减：<br>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>F</mi><mrow><mi>a</mi><mi>t</mi><mi>t</mi></mrow></msub><mo>=</mo><mfrac><mn>1.0</mn><mrow><msub><mi>K</mi><mi>c</mi></msub><mo>+</mo><msub><mi>K</mi><mi>l</mi></msub><mo>⋅</mo><mi>d</mi><mo>+</mo><msub><mi>K</mi><mi>q</mi></msub><mo>⋅</mo><msup><mi>d</mi><mn>2</mn></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">F_{att} = \frac{1.0}{K_c + K_l \cdot d + K_q \cdot d^2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">tt</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2935em;vertical-align:-0.9721em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1.0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9721em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>其中系数的取值需要靠实验总结；<br>
通常而言，我们取<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>K</mi><mi>c</mi></msub><mo>=</mo><mn>1.0</mn><mo separator="true">,</mo><msub><mi>K</mi><mi>l</mi></msub><mo>=</mo><mn>0.09</mn><mo separator="true">,</mo><msub><mi>K</mi><mi>q</mi></msub><mo>=</mo><mn>0.032</mn></mrow><annotation encoding="application/x-tex">K_c = 1.0 , K_l = 0.09 , K_q = 0.032</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord">1.0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord">0.09</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0.032</span></span></span></span>；</p>
<p>加入衰减后，我们可以实现近处亮，远处暗的点光源照明效果；</p>
<p>片段着色器的代码如下所示：</p>
<details>
<summary>light_texture.fs</summary>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">330</span> core</span></span>
out vec4 FragColor<span class="token punctuation">;</span>

<span class="token keyword keyword-struct">struct</span> <span class="token class-name">Material</span> <span class="token punctuation">{</span>
    sampler2D diffuse<span class="token punctuation">;</span>
    sampler2D specular<span class="token punctuation">;</span>    
    <span class="token keyword keyword-float">float</span> shininess<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span> 

<span class="token keyword keyword-struct">struct</span> <span class="token class-name">Light</span> <span class="token punctuation">{</span>
    vec3 position<span class="token punctuation">;</span>
    <span class="token comment">// vec3 direction;</span>

    vec3 ambient<span class="token punctuation">;</span>
    vec3 diffuse<span class="token punctuation">;</span>
    vec3 specular<span class="token punctuation">;</span>

    <span class="token comment">// 注意命名不能为const</span>
    <span class="token keyword keyword-float">float</span> constant<span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> linear<span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> quad<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

in vec3 FragPos<span class="token punctuation">;</span>  
in vec3 Normal<span class="token punctuation">;</span>  
in vec2 TexCoords<span class="token punctuation">;</span>
  
uniform vec3 viewPos<span class="token punctuation">;</span>
uniform Material material<span class="token punctuation">;</span>
uniform Light light<span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    vec3 ambient <span class="token operator">=</span> light<span class="token punctuation">.</span>ambient <span class="token operator">*</span> <span class="token function">texture</span><span class="token punctuation">(</span>material<span class="token punctuation">.</span>diffuse<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">.</span>rgb<span class="token punctuation">;</span>
  	
    vec3 norm <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>Normal<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// lightDir是指向光源的方向</span>
    vec3 lightDir <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>light<span class="token punctuation">.</span>position <span class="token operator">-</span> FragPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// vec3 lightDir = normalize(-light.direction);</span>

    <span class="token keyword keyword-float">float</span> diff <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>norm<span class="token punctuation">,</span> lightDir<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vec3 diffuse <span class="token operator">=</span> light<span class="token punctuation">.</span>diffuse <span class="token operator">*</span> diff <span class="token operator">*</span> <span class="token function">texture</span><span class="token punctuation">(</span>material<span class="token punctuation">.</span>diffuse<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">.</span>rgb<span class="token punctuation">;</span>  
    
    vec3 viewDir <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>viewPos <span class="token operator">-</span> FragPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    vec3 reflectDir <span class="token operator">=</span> <span class="token function">reflect</span><span class="token punctuation">(</span><span class="token operator">-</span>lightDir<span class="token punctuation">,</span> norm<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token keyword keyword-float">float</span> spec <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>viewDir<span class="token punctuation">,</span> reflectDir<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> material<span class="token punctuation">.</span>shininess<span class="token punctuation">)</span><span class="token punctuation">;</span>
    vec3 specular <span class="token operator">=</span> light<span class="token punctuation">.</span>specular <span class="token operator">*</span> spec <span class="token operator">*</span> <span class="token function">texture</span><span class="token punctuation">(</span>material<span class="token punctuation">.</span>specular<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">.</span>rgb<span class="token punctuation">;</span> 

    <span class="token comment">// 衰减</span>
    <span class="token keyword keyword-float">float</span> distance <span class="token operator">=</span> <span class="token function">length</span><span class="token punctuation">(</span>light<span class="token punctuation">.</span>position <span class="token operator">-</span> FragPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> attenuation <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">/</span> <span class="token punctuation">(</span>light<span class="token punctuation">.</span>constant <span class="token operator">+</span> light<span class="token punctuation">.</span>linear <span class="token operator">*</span> distance <span class="token operator">+</span> light<span class="token punctuation">.</span>quad <span class="token operator">*</span> <span class="token punctuation">(</span>distance <span class="token operator">*</span> distance<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    ambient  <span class="token operator">*=</span> attenuation<span class="token punctuation">;</span> 
    diffuse  <span class="token operator">*=</span> attenuation<span class="token punctuation">;</span>
    specular <span class="token operator">*=</span> attenuation<span class="token punctuation">;</span>
        
    vec3 result <span class="token operator">=</span> ambient <span class="token operator">+</span> diffuse <span class="token operator">+</span> specular<span class="token punctuation">;</span>
    FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
</code></pre></details>
<h3 id="聚光">聚光 </h3>
<p>我们想实现手电筒那样的光照效果，即虽然是点光源，但只有一定范围内有光：<br>
<img src="..\assets\images\learning opengl\image-15.png" alt="alt text"></p>
<p>我们可以在Light结构体中定义cutoff值，一旦超过特定范围就使用环境光；</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-float">float</span> theta <span class="token operator">=</span> <span class="token function">dot</span><span class="token punctuation">(</span>lightDir<span class="token punctuation">,</span> <span class="token function">normalize</span><span class="token punctuation">(</span><span class="token operator">-</span>light<span class="token punctuation">.</span>direction<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>theta <span class="token operator">&gt;</span> light<span class="token punctuation">.</span>cutOff<span class="token punctuation">)</span> 
<span class="token punctuation">{</span>       
  <span class="token comment">// 执行光照计算</span>
<span class="token punctuation">}</span>
<span class="token keyword keyword-else">else</span>  <span class="token comment">// 否则，使用环境光+</span>
  FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>ambient <span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>这么做会使得边缘比较锐利，不太真实；<br>
为了保证真实性，我们可以再模型化一些；<br>
取内外两个圆锥，内圆锥界限<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span></span>，外圆锥界限<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>γ</mi></mrow><annotation encoding="application/x-tex">\gamma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span></span></span></span>，在内外圆锥之间平滑过渡，线性取值：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-float">float</span> theta     <span class="token operator">=</span> <span class="token function">dot</span><span class="token punctuation">(</span>lightDir<span class="token punctuation">,</span> <span class="token function">normalize</span><span class="token punctuation">(</span><span class="token operator">-</span>light<span class="token punctuation">.</span>direction<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-float">float</span> epsilon   <span class="token operator">=</span> light<span class="token punctuation">.</span>cutOff <span class="token operator">-</span> light<span class="token punctuation">.</span>outerCutOff<span class="token punctuation">;</span>

<span class="token comment">// clamp函数保证值不会溢出</span>
<span class="token keyword keyword-float">float</span> intensity <span class="token operator">=</span> <span class="token function">clamp</span><span class="token punctuation">(</span><span class="token punctuation">(</span>theta <span class="token operator">-</span> light<span class="token punctuation">.</span>outerCutOff<span class="token punctuation">)</span> <span class="token operator">/</span> epsilon<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment">// 保持环境光</span>
diffuse  <span class="token operator">*=</span> intensity<span class="token punctuation">;</span>
specular <span class="token operator">*=</span> intensity<span class="token punctuation">;</span>
</code></pre><h3 id="多光源">多光源 </h3>
<p>如果有多个光源，则需要我们以一种更系统化的方式来组织不同光源的贡献；<br>
准确地说，在片段着色器中，会有多个Light结构体，我们需要算出多个光源的贡献；</p>
<p>如下是一个较为完善的多光源示意：</p>
<details>
<summary>multi_light.fs</summary>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">330</span> core</span></span>
out vec4 FragColor<span class="token punctuation">;</span>

<span class="token keyword keyword-struct">struct</span> <span class="token class-name">Material</span> <span class="token punctuation">{</span>
    sampler2D diffuse<span class="token punctuation">;</span>
    sampler2D specular<span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> shininess<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span> 

<span class="token comment">// 平行光</span>
<span class="token keyword keyword-struct">struct</span> <span class="token class-name">DirLight</span> <span class="token punctuation">{</span>
    vec3 direction<span class="token punctuation">;</span>
	
    vec3 ambient<span class="token punctuation">;</span>
    vec3 diffuse<span class="token punctuation">;</span>
    vec3 specular<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 点光源</span>
<span class="token keyword keyword-struct">struct</span> <span class="token class-name">PointLight</span> <span class="token punctuation">{</span>
    vec3 position<span class="token punctuation">;</span>
    
    <span class="token keyword keyword-float">float</span> constant<span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> linear<span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> quadratic<span class="token punctuation">;</span>
	
    vec3 ambient<span class="token punctuation">;</span>
    vec3 diffuse<span class="token punctuation">;</span>
    vec3 specular<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 汇聚光</span>
<span class="token keyword keyword-struct">struct</span> <span class="token class-name">SpotLight</span> <span class="token punctuation">{</span>
    vec3 position<span class="token punctuation">;</span>
    vec3 direction<span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> cutOff<span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> outercutOff<span class="token punctuation">;</span>
  
    <span class="token keyword keyword-float">float</span> constant<span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> linear<span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> quadratic<span class="token punctuation">;</span>
  
    vec3 ambient<span class="token punctuation">;</span>
    vec3 diffuse<span class="token punctuation">;</span>
    vec3 specular<span class="token punctuation">;</span>       
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">NR_POINT_LIGHTS</span> <span class="token expression"><span class="token number">4</span></span></span>

in vec3 FragPos<span class="token punctuation">;</span>
in vec3 Normal<span class="token punctuation">;</span>
in vec2 TexCoords<span class="token punctuation">;</span>

uniform vec3 viewPos<span class="token punctuation">;</span>
uniform DirLight dirLight<span class="token punctuation">;</span>
uniform PointLight pointLights<span class="token punctuation">[</span>NR_POINT_LIGHTS<span class="token punctuation">]</span><span class="token punctuation">;</span>
uniform SpotLight spotLight<span class="token punctuation">;</span>
uniform Material material<span class="token punctuation">;</span>

<span class="token comment">// 计算光照贡献的函数</span>
vec3 <span class="token function">CalcDirLight</span><span class="token punctuation">(</span>DirLight light<span class="token punctuation">,</span> vec3 normal<span class="token punctuation">,</span> vec3 viewDir<span class="token punctuation">)</span><span class="token punctuation">;</span>
vec3 <span class="token function">CalcPointLight</span><span class="token punctuation">(</span>PointLight light<span class="token punctuation">,</span> vec3 normal<span class="token punctuation">,</span> vec3 fragPos<span class="token punctuation">,</span> vec3 viewDir<span class="token punctuation">)</span><span class="token punctuation">;</span>
vec3 <span class="token function">CalcSpotLight</span><span class="token punctuation">(</span>SpotLight light<span class="token punctuation">,</span> vec3 normal<span class="token punctuation">,</span> vec3 fragPos<span class="token punctuation">,</span> vec3 viewDir<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>    
    vec3 norm <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>Normal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    vec3 viewDir <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>viewPos <span class="token operator">-</span> FragPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 平行光贡献</span>
    vec3 result <span class="token operator">=</span> <span class="token function">CalcDirLight</span><span class="token punctuation">(</span>dirLight<span class="token punctuation">,</span> norm<span class="token punctuation">,</span> viewDir<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 点光源贡献</span>
    <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> NR_POINT_LIGHTS<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        result <span class="token operator">+=</span> <span class="token function">CalcPointLight</span><span class="token punctuation">(</span>pointLights<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> norm<span class="token punctuation">,</span> FragPos<span class="token punctuation">,</span> viewDir<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    
    <span class="token comment">// 汇聚光（手电筒）贡献</span>
    result <span class="token operator">+=</span> <span class="token function">CalcSpotLight</span><span class="token punctuation">(</span>spotLight<span class="token punctuation">,</span> norm<span class="token punctuation">,</span> FragPos<span class="token punctuation">,</span> viewDir<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    
    FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


vec3 <span class="token function">CalcDirLight</span><span class="token punctuation">(</span>DirLight light<span class="token punctuation">,</span> vec3 normal<span class="token punctuation">,</span> vec3 viewDir<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    vec3 lightDir <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span><span class="token operator">-</span>light<span class="token punctuation">.</span>direction<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword keyword-float">float</span> diff <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span> lightDir<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    vec3 reflectDir <span class="token operator">=</span> <span class="token function">reflect</span><span class="token punctuation">(</span><span class="token operator">-</span>lightDir<span class="token punctuation">,</span> normal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> spec <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>viewDir<span class="token punctuation">,</span> reflectDir<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> material<span class="token punctuation">.</span>shininess<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    vec3 ambient <span class="token operator">=</span> light<span class="token punctuation">.</span>ambient <span class="token operator">*</span> <span class="token function">vec3</span><span class="token punctuation">(</span><span class="token function">texture</span><span class="token punctuation">(</span>material<span class="token punctuation">.</span>diffuse<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vec3 diffuse <span class="token operator">=</span> light<span class="token punctuation">.</span>diffuse <span class="token operator">*</span> diff <span class="token operator">*</span> <span class="token function">vec3</span><span class="token punctuation">(</span><span class="token function">texture</span><span class="token punctuation">(</span>material<span class="token punctuation">.</span>diffuse<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vec3 specular <span class="token operator">=</span> light<span class="token punctuation">.</span>specular <span class="token operator">*</span> spec <span class="token operator">*</span> <span class="token function">vec3</span><span class="token punctuation">(</span><span class="token function">texture</span><span class="token punctuation">(</span>material<span class="token punctuation">.</span>specular<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>ambient <span class="token operator">+</span> diffuse <span class="token operator">+</span> specular<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


vec3 <span class="token function">CalcPointLight</span><span class="token punctuation">(</span>PointLight light<span class="token punctuation">,</span> vec3 normal<span class="token punctuation">,</span> vec3 fragPos<span class="token punctuation">,</span> vec3 viewDir<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    vec3 lightDir <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>light<span class="token punctuation">.</span>position <span class="token operator">-</span> fragPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword keyword-float">float</span> diff <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span> lightDir<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    vec3 reflectDir <span class="token operator">=</span> <span class="token function">reflect</span><span class="token punctuation">(</span><span class="token operator">-</span>lightDir<span class="token punctuation">,</span> normal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> spec <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>viewDir<span class="token punctuation">,</span> reflectDir<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> material<span class="token punctuation">.</span>shininess<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword keyword-float">float</span> distance <span class="token operator">=</span> <span class="token function">length</span><span class="token punctuation">(</span>light<span class="token punctuation">.</span>position <span class="token operator">-</span> fragPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> attenuation <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">/</span> <span class="token punctuation">(</span>light<span class="token punctuation">.</span>constant <span class="token operator">+</span> light<span class="token punctuation">.</span>linear <span class="token operator">*</span> distance <span class="token operator">+</span> light<span class="token punctuation">.</span>quadratic <span class="token operator">*</span> <span class="token punctuation">(</span>distance <span class="token operator">*</span> distance<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    
    vec3 ambient <span class="token operator">=</span> light<span class="token punctuation">.</span>ambient <span class="token operator">*</span> <span class="token function">vec3</span><span class="token punctuation">(</span><span class="token function">texture</span><span class="token punctuation">(</span>material<span class="token punctuation">.</span>diffuse<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vec3 diffuse <span class="token operator">=</span> light<span class="token punctuation">.</span>diffuse <span class="token operator">*</span> diff <span class="token operator">*</span> <span class="token function">vec3</span><span class="token punctuation">(</span><span class="token function">texture</span><span class="token punctuation">(</span>material<span class="token punctuation">.</span>diffuse<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vec3 specular <span class="token operator">=</span> light<span class="token punctuation">.</span>specular <span class="token operator">*</span> spec <span class="token operator">*</span> <span class="token function">vec3</span><span class="token punctuation">(</span><span class="token function">texture</span><span class="token punctuation">(</span>material<span class="token punctuation">.</span>specular<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ambient <span class="token operator">*=</span> attenuation<span class="token punctuation">;</span>
    diffuse <span class="token operator">*=</span> attenuation<span class="token punctuation">;</span>
    specular <span class="token operator">*=</span> attenuation<span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>ambient <span class="token operator">+</span> diffuse <span class="token operator">+</span> specular<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


vec3 <span class="token function">CalcSpotLight</span><span class="token punctuation">(</span>SpotLight light<span class="token punctuation">,</span> vec3 normal<span class="token punctuation">,</span> vec3 fragPos<span class="token punctuation">,</span> vec3 viewDir<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    vec3 lightDir <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>light<span class="token punctuation">.</span>position <span class="token operator">-</span> fragPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword keyword-float">float</span> diff <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span> lightDir<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    vec3 reflectDir <span class="token operator">=</span> <span class="token function">reflect</span><span class="token punctuation">(</span><span class="token operator">-</span>lightDir<span class="token punctuation">,</span> normal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> spec <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>viewDir<span class="token punctuation">,</span> reflectDir<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> material<span class="token punctuation">.</span>shininess<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword keyword-float">float</span> distance <span class="token operator">=</span> <span class="token function">length</span><span class="token punctuation">(</span>light<span class="token punctuation">.</span>position <span class="token operator">-</span> fragPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> attenuation <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">/</span> <span class="token punctuation">(</span>light<span class="token punctuation">.</span>constant <span class="token operator">+</span> light<span class="token punctuation">.</span>linear <span class="token operator">*</span> distance <span class="token operator">+</span> light<span class="token punctuation">.</span>quadratic <span class="token operator">*</span> <span class="token punctuation">(</span>distance <span class="token operator">*</span> distance<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    
    <span class="token keyword keyword-float">float</span> theta <span class="token operator">=</span> <span class="token function">dot</span><span class="token punctuation">(</span>lightDir<span class="token punctuation">,</span> <span class="token function">normalize</span><span class="token punctuation">(</span><span class="token operator">-</span>light<span class="token punctuation">.</span>direction<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword keyword-float">float</span> epsilon <span class="token operator">=</span> light<span class="token punctuation">.</span>cutOff <span class="token operator">-</span> light<span class="token punctuation">.</span>outercutOff<span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> intensity <span class="token operator">=</span> <span class="token function">clamp</span><span class="token punctuation">(</span><span class="token punctuation">(</span>theta <span class="token operator">-</span> light<span class="token punctuation">.</span>outercutOff<span class="token punctuation">)</span> <span class="token operator">/</span> epsilon<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    vec3 ambient <span class="token operator">=</span> light<span class="token punctuation">.</span>ambient <span class="token operator">*</span> <span class="token function">vec3</span><span class="token punctuation">(</span><span class="token function">texture</span><span class="token punctuation">(</span>material<span class="token punctuation">.</span>diffuse<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vec3 diffuse <span class="token operator">=</span> light<span class="token punctuation">.</span>diffuse <span class="token operator">*</span> diff <span class="token operator">*</span> <span class="token function">vec3</span><span class="token punctuation">(</span><span class="token function">texture</span><span class="token punctuation">(</span>material<span class="token punctuation">.</span>diffuse<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vec3 specular <span class="token operator">=</span> light<span class="token punctuation">.</span>specular <span class="token operator">*</span> spec <span class="token operator">*</span> <span class="token function">vec3</span><span class="token punctuation">(</span><span class="token function">texture</span><span class="token punctuation">(</span>material<span class="token punctuation">.</span>specular<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ambient <span class="token operator">*=</span> attenuation <span class="token operator">*</span> intensity<span class="token punctuation">;</span>
    diffuse <span class="token operator">*=</span> attenuation <span class="token operator">*</span> intensity<span class="token punctuation">;</span>
    specular <span class="token operator">*=</span> attenuation <span class="token operator">*</span> intensity<span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>ambient <span class="token operator">+</span> diffuse <span class="token operator">+</span> specular<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></details>
<details>
<summary>light_texture.vs</summary>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">330</span> core</span></span>
<span class="token function">layout</span> <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> in vec3 aPos<span class="token punctuation">;</span>
<span class="token function">layout</span> <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> in vec3 aNormal<span class="token punctuation">;</span>
<span class="token function">layout</span> <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span> in vec2 aTexCoords<span class="token punctuation">;</span>

out vec3 FragPos<span class="token punctuation">;</span>
out vec3 Normal<span class="token punctuation">;</span>
out vec2 TexCoords<span class="token punctuation">;</span>

uniform mat4 model<span class="token punctuation">;</span>
uniform mat4 view<span class="token punctuation">;</span>
uniform mat4 projection<span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    FragPos <span class="token operator">=</span> <span class="token function">vec3</span><span class="token punctuation">(</span>model <span class="token operator">*</span> <span class="token function">vec4</span><span class="token punctuation">(</span>aPos<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Normal <span class="token operator">=</span> <span class="token function">mat3</span><span class="token punctuation">(</span><span class="token function">transpose</span><span class="token punctuation">(</span><span class="token function">inverse</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> aNormal<span class="token punctuation">;</span>  
    TexCoords <span class="token operator">=</span> aTexCoords<span class="token punctuation">;</span>
    
    gl_Position <span class="token operator">=</span> projection <span class="token operator">*</span> view <span class="token operator">*</span> <span class="token function">vec4</span><span class="token punctuation">(</span>FragPos<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></details>
<details>
<summary>main.cpp</summary>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;glad/glad.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;GLFW/glfw3.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stb_image.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;glm/glm.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;glm/gtc/matrix_transform.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;glm/gtc/type_ptr.hpp&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;shader.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cmath&gt;</span></span>

<span class="token comment">// 注册回调函数，相应窗口大小的调整</span>
<span class="token keyword keyword-void">void</span> <span class="token function">framebuffer_size_callback</span><span class="token punctuation">(</span>GLFWwindow <span class="token operator">*</span> window <span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> width <span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> height<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">glViewport</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">,</span> width <span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-float">float</span> deltaTime <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span> 
<span class="token keyword keyword-float">float</span> lastFrame <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span> 

bool firstMouse <span class="token operator">=</span> true<span class="token punctuation">;</span>
<span class="token keyword keyword-float">float</span> lastX <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
<span class="token keyword keyword-float">float</span> lastY <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
<span class="token keyword keyword-float">float</span> pitch <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
<span class="token comment">// 初始时看向 -z方向，yaw为-90度</span>
<span class="token keyword keyword-float">float</span> yaw <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">90.0f</span><span class="token punctuation">;</span>

<span class="token keyword keyword-float">float</span> fov <span class="token operator">=</span> <span class="token number">45.0f</span><span class="token punctuation">;</span>

glm<span class="token operator">::</span>vec3 cameraPos   <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">3.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
glm<span class="token operator">::</span>vec3 cameraFront <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
glm<span class="token operator">::</span>vec3 cameraUp    <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

glm<span class="token operator">::</span>vec3 lightPos <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">1.2f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">2.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">processInput</span><span class="token punctuation">(</span>GLFWwindow <span class="token operator">*</span>window<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token function">glfwGetKey</span><span class="token punctuation">(</span>window <span class="token punctuation">,</span> GLFW_KEY_ESCAPE<span class="token punctuation">)</span> <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span>
        <span class="token function">glfwSetWindowShouldClose</span><span class="token punctuation">(</span>window <span class="token punctuation">,</span> true<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// float cameraSpeed = 0.05f; </span>
    <span class="token keyword keyword-float">float</span> cameraSpeed <span class="token operator">=</span> <span class="token number">2.5f</span> <span class="token operator">*</span> deltaTime<span class="token punctuation">;</span>
    
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">glfwGetKey</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> GLFW_KEY_W<span class="token punctuation">)</span> <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span>
        cameraPos <span class="token operator">+=</span> cameraSpeed <span class="token operator">*</span> cameraFront<span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">glfwGetKey</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> GLFW_KEY_S<span class="token punctuation">)</span> <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span>
        cameraPos <span class="token operator">-=</span> cameraSpeed <span class="token operator">*</span> cameraFront<span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">glfwGetKey</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> GLFW_KEY_A<span class="token punctuation">)</span> <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span>
        cameraPos <span class="token operator">-=</span> glm<span class="token operator">::</span><span class="token function">normalize</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">cross</span><span class="token punctuation">(</span>cameraFront<span class="token punctuation">,</span> cameraUp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> cameraSpeed<span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">glfwGetKey</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> GLFW_KEY_D<span class="token punctuation">)</span> <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span>
        cameraPos <span class="token operator">+=</span> glm<span class="token operator">::</span><span class="token function">normalize</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">cross</span><span class="token punctuation">(</span>cameraFront<span class="token punctuation">,</span> cameraUp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> cameraSpeed<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">mouse_callback</span><span class="token punctuation">(</span>GLFWwindow<span class="token operator">*</span> window<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> xpos<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> ypos<span class="token punctuation">)</span>
<span class="token punctuation">{</span>   
    <span class="token comment">// 初始为1，为了防止刚进入程序时跳动</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>firstMouse<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        lastX <span class="token operator">=</span> xpos<span class="token punctuation">;</span>
        lastY <span class="token operator">=</span> ypos<span class="token punctuation">;</span>
        firstMouse <span class="token operator">=</span> false<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-float">float</span> xoffset <span class="token operator">=</span> xpos <span class="token operator">-</span> lastX<span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> yoffset <span class="token operator">=</span> lastY <span class="token operator">-</span> ypos<span class="token punctuation">;</span> 
    lastX <span class="token operator">=</span> xpos<span class="token punctuation">;</span>
    lastY <span class="token operator">=</span> ypos<span class="token punctuation">;</span>

    <span class="token comment">// 防止太敏感</span>
    <span class="token keyword keyword-float">float</span> sensitivity <span class="token operator">=</span> <span class="token number">0.05</span><span class="token punctuation">;</span>
    xoffset <span class="token operator">*=</span> sensitivity<span class="token punctuation">;</span>
    yoffset <span class="token operator">*=</span> sensitivity<span class="token punctuation">;</span>

    <span class="token comment">// 全局变量</span>
    yaw   <span class="token operator">+=</span> xoffset<span class="token punctuation">;</span>
    pitch <span class="token operator">+=</span> yoffset<span class="token punctuation">;</span>

    <span class="token comment">// 防止俯仰角转过了</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>pitch <span class="token operator">&gt;</span> <span class="token number">89.0f</span><span class="token punctuation">)</span>
        pitch <span class="token operator">=</span> <span class="token number">89.0f</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>pitch <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">89.0f</span><span class="token punctuation">)</span>
        pitch <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">89.0f</span><span class="token punctuation">;</span>

    glm<span class="token operator">::</span>vec3 front<span class="token punctuation">;</span>
    front<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token function">cos</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">radians</span><span class="token punctuation">(</span>yaw<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">cos</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">radians</span><span class="token punctuation">(</span>pitch<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    front<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">radians</span><span class="token punctuation">(</span>pitch<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    front<span class="token punctuation">.</span>z <span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">radians</span><span class="token punctuation">(</span>yaw<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">cos</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">radians</span><span class="token punctuation">(</span>pitch<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cameraFront <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">normalize</span><span class="token punctuation">(</span>front<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">scroll_callback</span><span class="token punctuation">(</span>GLFWwindow<span class="token operator">*</span> window<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> xoffset<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> yoffset<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// 视角大小限制在1 ~ 45度 </span>
  <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>fov <span class="token operator">&gt;=</span> <span class="token number">1.0f</span> <span class="token operator">&amp;&amp;</span> fov <span class="token operator">&lt;=</span> <span class="token number">45.0f</span><span class="token punctuation">)</span>
    fov <span class="token operator">-=</span> yoffset<span class="token punctuation">;</span>
  <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>fov <span class="token operator">&lt;=</span> <span class="token number">1.0f</span><span class="token punctuation">)</span>
    fov <span class="token operator">=</span> <span class="token number">1.0f</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>fov <span class="token operator">&gt;=</span> <span class="token number">45.0f</span><span class="token punctuation">)</span>
    fov <span class="token operator">=</span> <span class="token number">45.0f</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">glfwInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// OpenGL：3.3核心版本</span>
    <span class="token function">glfwWindowHint</span><span class="token punctuation">(</span>GLFW_CONTEXT_VERSION_MAJOR <span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwWindowHint</span><span class="token punctuation">(</span>GLFW_CONTEXT_VERSION_MINOR <span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwWindowHint</span><span class="token punctuation">(</span>GLFW_OPENGL_PROFILE <span class="token punctuation">,</span> GLFW_OPENGL_CORE_PROFILE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwWindowHint</span><span class="token punctuation">(</span>GLFW_OPENGL_FORWARD_COMPAT <span class="token punctuation">,</span> GL_TRUE<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建窗口</span>
    GLFWwindow <span class="token operator">*</span> window <span class="token operator">=</span> <span class="token function">glfwCreateWindow</span><span class="token punctuation">(</span><span class="token number">800</span> <span class="token punctuation">,</span> <span class="token number">600</span> <span class="token punctuation">,</span> <span class="token string">"Hello Light"</span> <span class="token punctuation">,</span> <span class="token constant">NULL</span> <span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwMakeContextCurrent</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 光标捕捉</span>
    <span class="token function">glfwSetInputMode</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> GLFW_CURSOR<span class="token punctuation">,</span> GLFW_CURSOR_DISABLED<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 初始化glad</span>
    <span class="token function">gladLoadGLLoader</span><span class="token punctuation">(</span><span class="token punctuation">(</span>GLADloadproc<span class="token punctuation">)</span>glfwGetProcAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 视口设置</span>
    <span class="token function">glViewport</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">,</span> <span class="token number">800</span> <span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 注册回调函数</span>
    <span class="token function">glfwSetFramebufferSizeCallback</span><span class="token punctuation">(</span>window <span class="token punctuation">,</span> framebuffer_size_callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwSetCursorPosCallback</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> mouse_callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwSetScrollCallback</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> scroll_callback<span class="token punctuation">)</span><span class="token punctuation">;</span>

    Shader <span class="token function">obj_shader</span><span class="token punctuation">(</span><span class="token string">"../src/light_texture.vs"</span> <span class="token punctuation">,</span> <span class="token string">"../src/multi_light.fs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Shader light_shader("../src/object.vs" , "../src/light.fs");</span>

    <span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">pragma</span> <span class="token expression">region 物体 <span class="token operator">&amp;</span> 光源设置</span></span>
    <span class="token comment">// 传入36个顶点，是为了画12个三角形</span>
    <span class="token keyword keyword-float">float</span> vertices<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token comment">// 坐标               // 法向              // 纹理坐标</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>

        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>

        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>

         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>

        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>

        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    glm<span class="token operator">::</span>vec3 cubePositions<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
        glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span> <span class="token number">2.0f</span><span class="token punctuation">,</span>  <span class="token number">5.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">15.0f</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
        glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2.2f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2.5f</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
        glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3.8f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">12.3f</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
        glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span> <span class="token number">2.4f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.4f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3.5f</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
        glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1.7f</span><span class="token punctuation">,</span>  <span class="token number">3.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">7.5f</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
        glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span> <span class="token number">1.3f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2.5f</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
        glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span> <span class="token number">1.5f</span><span class="token punctuation">,</span>  <span class="token number">2.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2.5f</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
        glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span> <span class="token number">1.5f</span><span class="token punctuation">,</span>  <span class="token number">0.2f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.5f</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
        glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1.3f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.5f</span><span class="token punctuation">)</span>  
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// 注册VBO，VAO并绑定完成设置</span>
    <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> VBO<span class="token punctuation">,</span> objVAO <span class="token punctuation">,</span> lightVAO<span class="token punctuation">;</span>
    <span class="token function">glGenVertexArrays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>objVAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glGenBuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>VBO<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// VBO传入</span>
    <span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> VBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBufferData</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>vertices<span class="token punctuation">)</span><span class="token punctuation">,</span> vertices<span class="token punctuation">,</span> GL_STATIC_DRAW<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 物体VAO设置</span>
    <span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>objVAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token number">8</span> <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token number">8</span> <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token number">8</span> <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">6</span> <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 光源VAO设置</span>
    <span class="token function">glGenVertexArrays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>lightVAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>lightVAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token number">8</span> <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 解除绑定VBO，VAO</span>
    <span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token function">glBindVertexArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

    <span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">pragma</span> <span class="token expression">endregion</span></span>

    <span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">pragma</span> <span class="token expression">region 贴图设置</span></span>

    <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> texture1<span class="token punctuation">;</span>
    <span class="token function">glGenTextures</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>texture1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> texture1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 为当前绑定的纹理对象设置环绕、过滤方式</span>
    <span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_WRAP_S<span class="token punctuation">,</span> GL_REPEAT<span class="token punctuation">)</span><span class="token punctuation">;</span>   
    <span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_WRAP_T<span class="token punctuation">,</span> GL_REPEAT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_MIN_FILTER<span class="token punctuation">,</span> GL_LINEAR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_MAG_FILTER<span class="token punctuation">,</span> GL_LINEAR<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 加载并生成纹理</span>
    <span class="token keyword keyword-int">int</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> nrChannels<span class="token punctuation">;</span>
    <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-char">char</span> <span class="token operator">*</span>data <span class="token operator">=</span> <span class="token function">stbi_load</span><span class="token punctuation">(</span><span class="token string">"../diffuse.png"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>width<span class="token punctuation">,</span> <span class="token operator">&amp;</span>height<span class="token punctuation">,</span> <span class="token operator">&amp;</span>nrChannels<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>   
        <span class="token function">glTexImage2D</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GL_RGBA<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GL_RGBA<span class="token punctuation">,</span> GL_UNSIGNED_BYTE<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glGenerateMipmap</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">stbi_image_free</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> texture2<span class="token punctuation">;</span>
    <span class="token function">glGenTextures</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>texture2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> texture2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 为当前绑定的纹理对象设置环绕、过滤方式</span>
    <span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_WRAP_S<span class="token punctuation">,</span> GL_REPEAT<span class="token punctuation">)</span><span class="token punctuation">;</span>   
    <span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_WRAP_T<span class="token punctuation">,</span> GL_REPEAT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_MIN_FILTER<span class="token punctuation">,</span> GL_LINEAR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_MAG_FILTER<span class="token punctuation">,</span> GL_LINEAR<span class="token punctuation">)</span><span class="token punctuation">;</span>

    data <span class="token operator">=</span> <span class="token function">stbi_load</span><span class="token punctuation">(</span><span class="token string">"../specular.png"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>width<span class="token punctuation">,</span> <span class="token operator">&amp;</span>height<span class="token punctuation">,</span> <span class="token operator">&amp;</span>nrChannels<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">glTexImage2D</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GL_RGBA<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GL_RGBA<span class="token punctuation">,</span> GL_UNSIGNED_BYTE<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glGenerateMipmap</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">stbi_image_free</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

    obj_shader<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    obj_shader<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token string">"material.diffuse"</span> <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    obj_shader<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token string">"material.specular"</span> <span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">pragma</span> <span class="token expression">endregion</span></span>
    
    <span class="token comment">// 点光源位置</span>
    glm<span class="token operator">::</span>vec3 pointLightPositions<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span> <span class="token number">0.7f</span><span class="token punctuation">,</span>  <span class="token number">0.2f</span><span class="token punctuation">,</span>  <span class="token number">2.0f</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span> <span class="token number">2.3f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3.3f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4.0f</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">4.0f</span><span class="token punctuation">,</span>  <span class="token number">2.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">12.0f</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3.0f</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    
    <span class="token function">glEnable</span><span class="token punctuation">(</span>GL_DEPTH_TEST<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 渲染循环</span>
    <span class="token keyword keyword-while">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">glfwWindowShouldClose</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword keyword-float">float</span> currentFrame <span class="token operator">=</span> <span class="token function">glfwGetTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        deltaTime <span class="token operator">=</span> currentFrame <span class="token operator">-</span> lastFrame<span class="token punctuation">;</span>
        lastFrame <span class="token operator">=</span> currentFrame<span class="token punctuation">;</span>

        <span class="token function">processInput</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 按下Esc后退出</span>

        <span class="token comment">// 清屏设置</span>
        <span class="token function">glClearColor</span><span class="token punctuation">(</span><span class="token number">0.1f</span> <span class="token punctuation">,</span> <span class="token number">0.1f</span> <span class="token punctuation">,</span> <span class="token number">0.1f</span> <span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token function">glClear</span><span class="token punctuation">(</span>GL_COLOR_BUFFER_BIT <span class="token operator">|</span> GL_DEPTH_BUFFER_BIT<span class="token punctuation">)</span><span class="token punctuation">;</span> 

        <span class="token comment">// view , proj设置，对于物体和光源一致</span>
        glm<span class="token operator">::</span>mat4 view <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">mat4</span><span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        glm<span class="token operator">::</span>mat4 proj <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">mat4</span><span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        view <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">lookAt</span><span class="token punctuation">(</span>cameraPos<span class="token punctuation">,</span> cameraPos <span class="token operator">+</span> cameraFront<span class="token punctuation">,</span> cameraUp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        proj <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">perspective</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">radians</span><span class="token punctuation">(</span>fov<span class="token punctuation">)</span> <span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span> <span class="token number">800.0f</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token number">600.0f</span> <span class="token punctuation">,</span> <span class="token number">0.1f</span> <span class="token punctuation">,</span> <span class="token number">100.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 画物体</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// obj_shader.setVec3("objectColor", 1.0f, 0.5f, 0.31f);</span>
        <span class="token comment">// obj_shader.setVec3("lightColor",  1.0f, 1.0f, 1.0f);</span>

        <span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">pragma</span> <span class="token expression">region 材质与光照设置</span></span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token string">"material.shininess"</span><span class="token punctuation">,</span> <span class="token number">32.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"viewPos"</span> <span class="token punctuation">,</span> cameraPos<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 平行光</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"dirLight.direction"</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.2f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.3f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"dirLight.ambient"</span><span class="token punctuation">,</span> <span class="token number">0.05f</span><span class="token punctuation">,</span> <span class="token number">0.05f</span><span class="token punctuation">,</span> <span class="token number">0.05f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"dirLight.diffuse"</span><span class="token punctuation">,</span> <span class="token number">0.4f</span><span class="token punctuation">,</span> <span class="token number">0.4f</span><span class="token punctuation">,</span> <span class="token number">0.4f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"dirLight.specular"</span><span class="token punctuation">,</span> <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token number">0.5f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 点光源</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"pointLights[0].position"</span><span class="token punctuation">,</span> pointLightPositions<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"pointLights[0].ambient"</span><span class="token punctuation">,</span> <span class="token number">0.05f</span><span class="token punctuation">,</span> <span class="token number">0.05f</span><span class="token punctuation">,</span> <span class="token number">0.05f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"pointLights[0].diffuse"</span><span class="token punctuation">,</span> <span class="token number">0.8f</span><span class="token punctuation">,</span> <span class="token number">0.8f</span><span class="token punctuation">,</span> <span class="token number">0.8f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"pointLights[0].specular"</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token string">"pointLights[0].constant"</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token string">"pointLights[0].linear"</span><span class="token punctuation">,</span> <span class="token number">0.09f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token string">"pointLights[0].quadratic"</span><span class="token punctuation">,</span> <span class="token number">0.032f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        obj_shader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"pointLights[1].position"</span><span class="token punctuation">,</span> pointLightPositions<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"pointLights[1].ambient"</span><span class="token punctuation">,</span> <span class="token number">0.05f</span><span class="token punctuation">,</span> <span class="token number">0.05f</span><span class="token punctuation">,</span> <span class="token number">0.05f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"pointLights[1].diffuse"</span><span class="token punctuation">,</span> <span class="token number">0.8f</span><span class="token punctuation">,</span> <span class="token number">0.8f</span><span class="token punctuation">,</span> <span class="token number">0.8f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"pointLights[1].specular"</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token string">"pointLights[1].constant"</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token string">"pointLights[1].linear"</span><span class="token punctuation">,</span> <span class="token number">0.09f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token string">"pointLights[1].quadratic"</span><span class="token punctuation">,</span> <span class="token number">0.032f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        obj_shader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"pointLights[2].position"</span><span class="token punctuation">,</span> pointLightPositions<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"pointLights[2].ambient"</span><span class="token punctuation">,</span> <span class="token number">0.05f</span><span class="token punctuation">,</span> <span class="token number">0.05f</span><span class="token punctuation">,</span> <span class="token number">0.05f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"pointLights[2].diffuse"</span><span class="token punctuation">,</span> <span class="token number">0.8f</span><span class="token punctuation">,</span> <span class="token number">0.8f</span><span class="token punctuation">,</span> <span class="token number">0.8f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"pointLights[2].specular"</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token string">"pointLights[2].constant"</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token string">"pointLights[2].linear"</span><span class="token punctuation">,</span> <span class="token number">0.09f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token string">"pointLights[2].quadratic"</span><span class="token punctuation">,</span> <span class="token number">0.032f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        obj_shader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"pointLights[3].position"</span><span class="token punctuation">,</span> pointLightPositions<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"pointLights[3].ambient"</span><span class="token punctuation">,</span> <span class="token number">0.05f</span><span class="token punctuation">,</span> <span class="token number">0.05f</span><span class="token punctuation">,</span> <span class="token number">0.05f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"pointLights[3].diffuse"</span><span class="token punctuation">,</span> <span class="token number">0.8f</span><span class="token punctuation">,</span> <span class="token number">0.8f</span><span class="token punctuation">,</span> <span class="token number">0.8f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"pointLights[3].specular"</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token string">"pointLights[3].constant"</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token string">"pointLights[3].linear"</span><span class="token punctuation">,</span> <span class="token number">0.09f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token string">"pointLights[3].quadratic"</span><span class="token punctuation">,</span> <span class="token number">0.032f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 手电筒</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"spotLight.position"</span><span class="token punctuation">,</span> cameraPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"spotLight.direction"</span><span class="token punctuation">,</span> cameraFront<span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"spotLight.ambient"</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"spotLight.diffuse"</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"spotLight.specular"</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token string">"spotLight.constant"</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token string">"spotLight.linear"</span><span class="token punctuation">,</span> <span class="token number">0.09f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token string">"spotLight.quadratic"</span><span class="token punctuation">,</span> <span class="token number">0.032f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token string">"spotLight.cutOff"</span><span class="token punctuation">,</span> glm<span class="token operator">::</span><span class="token function">cos</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">radians</span><span class="token punctuation">(</span><span class="token number">12.5f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token string">"spotLight.outercutOff"</span><span class="token punctuation">,</span> glm<span class="token operator">::</span><span class="token function">cos</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">radians</span><span class="token punctuation">(</span><span class="token number">15.0f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

        <span class="token comment">// obj_shader.setVec3("material.ambient",  1.0f, 0.5f, 0.31f);</span>
        <span class="token comment">// obj_shader.setVec3("material.diffuse",  1.0f, 0.5f, 0.31f);</span>
        <span class="token comment">// obj_shader.setVec3("material.specular", 0.5f, 0.5f, 0.5f);</span>
        <span class="token comment">// obj_shader.setVec3("light.ambient",  0.2f, 0.2f, 0.2f);</span>
        <span class="token comment">// obj_shader.setVec3("light.diffuse",  0.5f, 0.5f, 0.5f); </span>
        <span class="token comment">// obj_shader.setVec3("light.specular", 1.0f, 1.0f, 1.0f); </span>
        <span class="token comment">// obj_shader.setVec3("light.position" , lightPos);</span>
        <span class="token comment">// obj_shader.setVec3("light.direction", -0.2f, -1.0f, -0.3f);</span>
        <span class="token comment">// obj_shader.setVec3("light.position" , cameraPos);</span>
        <span class="token comment">// obj_shader.setVec3("light.direction", cameraFront);</span>
        <span class="token comment">// obj_shader.setFloat("light.cutOff",   glm::cos(glm::radians(12.5f)));</span>
        <span class="token comment">// obj_shader.setFloat("light.outercutOff",   glm::cos(glm::radians(17.5f)));</span>

        <span class="token comment">// obj_shader.setVec3("lightPos" , lightPos);</span>
        <span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">pragma</span> <span class="token expression">endregion</span></span>

        obj_shader<span class="token punctuation">.</span><span class="token function">setMat4</span><span class="token punctuation">(</span><span class="token string">"view"</span> <span class="token punctuation">,</span> view<span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setMat4</span><span class="token punctuation">(</span><span class="token string">"projection"</span> <span class="token punctuation">,</span> proj<span class="token punctuation">)</span><span class="token punctuation">;</span>

        glm<span class="token operator">::</span>mat4 model <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">mat4</span><span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj_shader<span class="token punctuation">.</span><span class="token function">setMat4</span><span class="token punctuation">(</span><span class="token string">"model"</span> <span class="token punctuation">,</span> model<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// obj_shader.setFloat("light.constant",  1.0f);</span>
        <span class="token comment">// obj_shader.setFloat("light.linear",    0.09f);</span>
        <span class="token comment">// obj_shader.setFloat("light.quad", 0.032f);</span>

        <span class="token comment">// 贴图激活与绑定</span>
        <span class="token function">glActiveTexture</span><span class="token punctuation">(</span>GL_TEXTURE0<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D <span class="token punctuation">,</span> texture1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glActiveTexture</span><span class="token punctuation">(</span>GL_TEXTURE1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D <span class="token punctuation">,</span> texture2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>objVAO<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token comment">// glDrawArrays(GL_TRIANGLES, 0, 36);</span>

        <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// 要为每个盒子重新设置</span>
            glm<span class="token operator">::</span>mat4 model <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">mat4</span><span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            model <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">translate</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> cubePositions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            model <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">rotate</span><span class="token punctuation">(</span>model <span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token function">glfwGetTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">,</span> glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.5f</span> <span class="token punctuation">,</span> <span class="token number">1.0f</span> <span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-float">float</span> angle <span class="token operator">=</span> <span class="token number">20.0f</span> <span class="token operator">*</span> i<span class="token punctuation">;</span> 
            model <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">rotate</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> glm<span class="token operator">::</span><span class="token function">radians</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">,</span> glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.3f</span><span class="token punctuation">,</span> <span class="token number">0.5f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            obj_shader<span class="token punctuation">.</span><span class="token function">setMat4</span><span class="token punctuation">(</span><span class="token string">"model"</span><span class="token punctuation">,</span> model<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token function">glDrawArrays</span><span class="token punctuation">(</span>GL_TRIANGLES<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">/*
        // 画光源
        light_shader.use();
        light_shader.setMat4("view" , view);
        light_shader.setMat4("projection" , proj);
        model = glm::mat4(1.0f);
        model = glm::translate(model , lightPos);
        model = glm::scale(model , glm::vec3(0.2f));
        light_shader.setMat4("model" , model);

        glBindVertexArray(lightVAO); 
        glDrawArrays(GL_TRIANGLES, 0, 36);
        */</span>

        <span class="token function">glfwSwapBuffers</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glfwPollEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>

    <span class="token comment">// 释放资源</span>
    <span class="token function">glDeleteVertexArrays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>objVAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glDeleteVertexArrays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>lightVAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glDeleteBuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>VBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwTerminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></details>
<h1 id="模型">模型 </h1>
<h2 id="assimp">Assimp </h2>
<p>模型通常由艺术家在Blender，3DS Max，Maya上制作；<br>
我们需要专门的库Assimp来导入并解析模型；</p>
<p>Mesh(网格)：绘制物体的最小单位，一个模型可以有多个网格，比如人体模型可以分成头部、四肢、衣服、武器等不同网格；</p>
<p>Mesh对象包好了渲染所需的所有相关数据，比如定点位置、法向量、纹理坐标、面(也就是图元primitive)和物体的材质；</p>
<p>Assimp进行处理是，所有东西都包含在Scene对象中；<br>
Scene中通过树状结构存储了网格数组的索引，根据索引我们就能找到每个Mesh中的真正信息；</p>
<p>下面我们来构建assimp:<br>
首先在<a href="https://github.com/assimp/assimp/blob/master/Build.md">这里</a>下载assimp源码并完成cmake；<br>
如果中间出现错误，在<a href="https://www.microsoft.com/en-us/download/details.aspx?id=6812">这里</a>下载DierctX SDK；<br>
如果出现s1023错误，需要卸载C++ Redistributable package(s)。</p>
<p>需要注意，由于我们是使用MinGW进行编译，不能使用默认的工具进行构建，具体方法为：<br>
打开cmake-gui；<br>
source code选我们下载好的源码；<br>
build选assimp下的build目录；<br>
generater选MinGW Makefiles ， Specify native compilers；<br>
配置编译器选择mingw64目录下的gcc.exe,g++.exe,gfortan.exe；<br>
完成后，把ASSIMP_WARNING_AS_ERRORS的勾选去掉；<br>
点击Generate生成；<br>
之后打开cmd进入build目录，输入命令：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>mingw32<span class="token operator">-</span>make<span class="token punctuation">.</span>exe <span class="token operator">-</span>j8
</code></pre><p>完成构建后，找到build/lib/libassimp.dll.a，build/bin/libassimp.dll这些需要放到工程的lib目录下，并链接；<br>
同时把include文件夹中的assimp整个复制到工程的include目录下；</p>
<h2 id="网格">网格 </h2>
<p>顶点需要包含位置，法向，纹理坐标信息，我们将其放在一个结构体中：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-struct">struct</span> <span class="token class-name">Vertex</span> <span class="token punctuation">{</span>
    glm<span class="token operator">::</span>vec3 Position<span class="token punctuation">;</span>
    glm<span class="token operator">::</span>vec3 Normal<span class="token punctuation">;</span>
    glm<span class="token operator">::</span>vec2 TexCoords<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p>纹理数据也可以整理到结构体中：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-struct">struct</span> <span class="token class-name">Texture</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> id<span class="token punctuation">;</span>
    string type<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p>Mesh类的结构如下所示：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>class Mesh <span class="token punctuation">{</span>
    <span class="token comment">// 外部可访问</span>
    public<span class="token operator">:</span>
        <span class="token comment">/*  网格数据  */</span>
        <span class="token comment">// vector是动态数组，其中存储的类型是Vertex</span>
        vector<span class="token operator">&lt;</span>Vertex<span class="token operator">&gt;</span> vertices<span class="token punctuation">;</span>
        vector<span class="token operator">&lt;</span><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span> indices<span class="token punctuation">;</span>
        vector<span class="token operator">&lt;</span>Texture<span class="token operator">&gt;</span> textures<span class="token punctuation">;</span>

        <span class="token comment">/*  函数  */</span>
        <span class="token function">Mesh</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>Vertex<span class="token operator">&gt;</span> vertices<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span> indices<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span>Texture<span class="token operator">&gt;</span> textures<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-void">void</span> <span class="token function">Draw</span><span class="token punctuation">(</span>Shader <span class="token operator">&amp;</span>shader<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 内部私有</span>
    private<span class="token operator">:</span>
        <span class="token comment">/*  渲染数据  */</span>
        <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> VAO<span class="token punctuation">,</span> VBO<span class="token punctuation">,</span> EBO<span class="token punctuation">;</span>
        <span class="token comment">/*  函数  */</span>
        <span class="token keyword keyword-void">void</span> <span class="token function">setupMesh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>  
</code></pre><p>Mesh函数基本就是设置一些共有变量，并调用setupMesh函数：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token function">Mesh</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>Vertex<span class="token operator">&gt;</span> vertices<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span> indices<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span>Texture<span class="token operator">&gt;</span> textures<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    this<span class="token operator">-&gt;</span>vertices <span class="token operator">=</span> vertices<span class="token punctuation">;</span>
    this<span class="token operator">-&gt;</span>indices <span class="token operator">=</span> indices<span class="token punctuation">;</span>
    this<span class="token operator">-&gt;</span>textures <span class="token operator">=</span> textures<span class="token punctuation">;</span>

    <span class="token function">setupMesh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>setupMesh的功能就是利用传入的数据，配置好缓冲和着色器设置：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-void">void</span> <span class="token function">setupMesh</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">glGenVertexArrays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>VAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glGenBuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>VBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glGenBuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>EBO<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>VAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> VBO<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 注意vertex在CPU中的地址是连续的</span>
    <span class="token function">glBufferData</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> vertices<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>Vertex<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>vertices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> GL_STATIC_DRAW<span class="token punctuation">)</span><span class="token punctuation">;</span>  

    <span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ELEMENT_ARRAY_BUFFER<span class="token punctuation">,</span> EBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBufferData</span><span class="token punctuation">(</span>GL_ELEMENT_ARRAY_BUFFER<span class="token punctuation">,</span> indices<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
                 <span class="token operator">&amp;</span>indices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> GL_STATIC_DRAW<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 顶点位置</span>
    <span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
    <span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>Vertex<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 顶点法线</span>
    <span class="token comment">// offsetof能够直接计算结构体成员的偏移量</span>
    <span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
    <span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>Vertex<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">offsetof</span><span class="token punctuation">(</span>Vertex<span class="token punctuation">,</span> Normal<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 顶点纹理坐标</span>
    <span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
    <span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>Vertex<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">offsetof</span><span class="token punctuation">(</span>Vertex<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">glBindVertexArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>  
</code></pre><p>Draw函数的代码如下：</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token keyword keyword-void">void</span> <span class="token function">Draw</span><span class="token punctuation">(</span>Shader shader<span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> diffuseNr <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> specularNr <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> textures<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">glActiveTexture</span><span class="token punctuation">(</span>GL_TEXTURE0 <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 在绑定之前激活相应的纹理单元</span>
        <span class="token comment">// 获取纹理序号（diffuse_textureN 中的 N）</span>
        string number<span class="token punctuation">;</span>
        string name <span class="token operator">=</span> textures<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>type<span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token string">"texture_diffuse"</span><span class="token punctuation">)</span>
            number <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>diffuseNr<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token string">"texture_specular"</span><span class="token punctuation">)</span>
            number <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>specularNr<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ++会先返回变量本身，再递增</span>
        <span class="token comment">// 获取unform的名称</span>

        shader<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"material."</span> <span class="token operator">+</span> name <span class="token operator">+</span> number<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> textures<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">glActiveTexture</span><span class="token punctuation">(</span>GL_TEXTURE0<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 绘制网格</span>
    <span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>VAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glDrawElements</span><span class="token punctuation">(</span>GL_TRIANGLES<span class="token punctuation">,</span> indices<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> GL_UNSIGNED_INT<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBindVertexArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h2 id="模型-1">模型 </h2>
<p>Model类的结构如下所示：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>class Model 
<span class="token punctuation">{</span>
    public<span class="token operator">:</span>
        <span class="token comment">/*  函数   */</span>
        <span class="token function">Model</span><span class="token punctuation">(</span><span class="token keyword keyword-char">char</span> <span class="token operator">*</span>path<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// 加载模型</span>
            <span class="token function">loadModel</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 这里的draw就是调用每个mesh各自的draw</span>
        <span class="token keyword keyword-void">void</span> <span class="token function">Draw</span><span class="token punctuation">(</span>Shader shader<span class="token punctuation">)</span><span class="token punctuation">;</span>   
    private<span class="token operator">:</span>
        <span class="token comment">/*  模型数据  */</span>
        vector<span class="token operator">&lt;</span>Mesh<span class="token operator">&gt;</span> meshes<span class="token punctuation">;</span>
        string directory<span class="token punctuation">;</span>
        <span class="token comment">/*  函数   */</span>
        <span class="token keyword keyword-void">void</span> <span class="token function">loadModel</span><span class="token punctuation">(</span>string path<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-void">void</span> <span class="token function">processNode</span><span class="token punctuation">(</span>aiNode <span class="token operator">*</span>node<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> aiScene <span class="token operator">*</span>scene<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ai开头的是assimp中自带的实现</span>
        <span class="token comment">// assimp加载完后会得到一个scene数据结构</span>

        Mesh <span class="token function">processMesh</span><span class="token punctuation">(</span>aiMesh <span class="token operator">*</span>mesh<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> aiScene <span class="token operator">*</span>scene<span class="token punctuation">)</span><span class="token punctuation">;</span>
        vector<span class="token operator">&lt;</span>Texture<span class="token operator">&gt;</span> <span class="token function">loadMaterialTextures</span><span class="token punctuation">(</span>aiMaterial <span class="token operator">*</span>mat<span class="token punctuation">,</span> aiTextureType type<span class="token punctuation">,</span> 
        string typeName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p>loadModel函数如下所示：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">// 注意需要包含如下头文件</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;assimp/Importer.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;assimp/scene.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;assimp/postprocess.h&gt;</span></span>

<span class="token keyword keyword-void">void</span> <span class="token function">loadModel</span><span class="token punctuation">(</span>string path<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// 使用assimp库加载到scene中</span>
    Assimp<span class="token operator">::</span>Importer import<span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> aiScene <span class="token operator">*</span>scene <span class="token operator">=</span> import<span class="token punctuation">.</span><span class="token function">ReadFile</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> aiProcess_Triangulate <span class="token operator">|</span> aiProcess_FlipUVs<span class="token punctuation">)</span><span class="token punctuation">;</span>    

    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token operator">!</span>scene <span class="token operator">||</span> scene<span class="token operator">-&gt;</span>mFlags <span class="token operator">&amp;</span> AI_SCENE_FLAGS_INCOMPLETE <span class="token operator">||</span> <span class="token operator">!</span>scene<span class="token operator">-&gt;</span>mRootNode<span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"ERROR::ASSIMP::"</span> <span class="token operator">&lt;&lt;</span> import<span class="token punctuation">.</span><span class="token function">GetErrorString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 获取文件的目录</span>
    directory <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">find_last_of</span><span class="token punctuation">(</span><span class="token char">'/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">processNode</span><span class="token punctuation">(</span>scene<span class="token operator">-&gt;</span>mRootNode<span class="token punctuation">,</span> scene<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>processNode函数如下所示：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-void">void</span> <span class="token function">processNode</span><span class="token punctuation">(</span>aiNode <span class="token operator">*</span>node<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> aiScene <span class="token operator">*</span>scene<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// 处理节点所有的网格</span>
    <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> node<span class="token operator">-&gt;</span>mNumMeshes<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>   
        <span class="token comment">// meshes是我们自己定义的网格对象数组</span>
        <span class="token comment">// mesh是assimp处理后得到的网格对象</span>
        <span class="token comment">// 需要processMesh函数进行处理</span>
        aiMesh <span class="token operator">*</span>mesh <span class="token operator">=</span> scene<span class="token operator">-&gt;</span>mMeshes<span class="token punctuation">[</span>node<span class="token operator">-&gt;</span>mMeshes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
        meshes<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">processMesh</span><span class="token punctuation">(</span>mesh<span class="token punctuation">,</span> scene<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         
    <span class="token punctuation">}</span>
    <span class="token comment">// 接下来对它的子节点重复这一过程</span>
    <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> node<span class="token operator">-&gt;</span>mNumChildren<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">processNode</span><span class="token punctuation">(</span>node<span class="token operator">-&gt;</span>mChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> scene<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>processMesh是把一个aiMesh转换成我们自己的Mesh:</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>Mesh <span class="token function">processMesh</span><span class="token punctuation">(</span>aiMesh <span class="token operator">*</span>mesh<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> aiScene <span class="token operator">*</span>scene<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// 实际上就是读取然后加载进来</span>
    vector<span class="token operator">&lt;</span>Vertex<span class="token operator">&gt;</span> vertices<span class="token punctuation">;</span>
    vector<span class="token operator">&lt;</span><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span> indices<span class="token punctuation">;</span>
    vector<span class="token operator">&lt;</span>Texture<span class="token operator">&gt;</span> textures<span class="token punctuation">;</span>

    <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> mesh<span class="token operator">-&gt;</span>mNumVertices<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Vertex vertex<span class="token punctuation">;</span>
        <span class="token comment">// 处理顶点位置、法线和纹理坐标</span>
        glm<span class="token operator">::</span>vec3 vector<span class="token punctuation">;</span> 
        <span class="token comment">// 位置</span>
        vector<span class="token punctuation">.</span>x <span class="token operator">=</span> mesh<span class="token operator">-&gt;</span>mVertices<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">;</span>
        vector<span class="token punctuation">.</span>y <span class="token operator">=</span> mesh<span class="token operator">-&gt;</span>mVertices<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>
        vector<span class="token punctuation">.</span>z <span class="token operator">=</span> mesh<span class="token operator">-&gt;</span>mVertices<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token punctuation">;</span> 
        vertex<span class="token punctuation">.</span>Position <span class="token operator">=</span> vector<span class="token punctuation">;</span>
        <span class="token comment">// 法线</span>
        vector<span class="token punctuation">.</span>x <span class="token operator">=</span> mesh<span class="token operator">-&gt;</span>mNormals<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">;</span>
        vector<span class="token punctuation">.</span>y <span class="token operator">=</span> mesh<span class="token operator">-&gt;</span>mNormals<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>
        vector<span class="token punctuation">.</span>z <span class="token operator">=</span> mesh<span class="token operator">-&gt;</span>mNormals<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token punctuation">;</span>
        vertex<span class="token punctuation">.</span>Normal <span class="token operator">=</span> vector<span class="token punctuation">;</span>
        <span class="token comment">// 纹理坐标</span>
        <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>mesh<span class="token operator">-&gt;</span>mTextureCoords<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 网格是否有纹理坐标？</span>
        <span class="token punctuation">{</span>
            glm<span class="token operator">::</span>vec2 vec<span class="token punctuation">;</span>
            vec<span class="token punctuation">.</span>x <span class="token operator">=</span> mesh<span class="token operator">-&gt;</span>mTextureCoords<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">;</span> 
            vec<span class="token punctuation">.</span>y <span class="token operator">=</span> mesh<span class="token operator">-&gt;</span>mTextureCoords<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>
            vertex<span class="token punctuation">.</span>TexCoords <span class="token operator">=</span> vec<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-else">else</span>
            vertex<span class="token punctuation">.</span>TexCoords <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        vertices<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>vertex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 处理索引</span>
    <span class="token comment">// 把所有face的索引传入即可</span>
    <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> mesh<span class="token operator">-&gt;</span>mNumFaces<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        aiFace face <span class="token operator">=</span> mesh<span class="token operator">-&gt;</span>mFaces<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> face<span class="token punctuation">.</span>mNumIndices<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
            indices<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>face<span class="token punctuation">.</span>mIndices<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 处理材质</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>mesh<span class="token operator">-&gt;</span>mMaterialIndex <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 材质信息存储在assimp中的aiMaterial类中</span>
        <span class="token comment">// 这里做的也就是读出这两个贴图</span>
        <span class="token comment">// 放到我们自己的Texure类中</span>
        aiMaterial <span class="token operator">*</span>material <span class="token operator">=</span> scene<span class="token operator">-&gt;</span>mMaterials<span class="token punctuation">[</span>mesh<span class="token operator">-&gt;</span>mMaterialIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
        
        vector<span class="token operator">&lt;</span>Texture<span class="token operator">&gt;</span> diffuseMaps <span class="token operator">=</span> <span class="token function">loadMaterialTextures</span><span class="token punctuation">(</span>material<span class="token punctuation">,</span> 
        aiTextureType_DIFFUSE<span class="token punctuation">,</span> <span class="token string">"texture_diffuse"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        textures<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>textures<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> diffuseMaps<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> diffuseMaps<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        vector<span class="token operator">&lt;</span>Texture<span class="token operator">&gt;</span> specularMaps <span class="token operator">=</span> <span class="token function">loadMaterialTextures</span><span class="token punctuation">(</span>material<span class="token punctuation">,</span> 
        aiTextureType_SPECULAR<span class="token punctuation">,</span> <span class="token string">"texture_specular"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        textures<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>textures<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> specularMaps<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> specularMaps<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-return">return</span> <span class="token function">Mesh</span><span class="token punctuation">(</span>vertices<span class="token punctuation">,</span> indices<span class="token punctuation">,</span> textures<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>loadMateriaTextures可以加载特定类型的纹理到我们自己的Texure类中：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">// 很多模型会重用纹理，因此单独为每个纹理都存储一遍并不高效</span>
<span class="token comment">// 我们可以记录下纹理而对存储路径</span>
<span class="token comment">// 对于已经加载过的纹理，可以跳过</span>
<span class="token keyword keyword-struct">struct</span> <span class="token class-name">Texture</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> id<span class="token punctuation">;</span>
    string type<span class="token punctuation">;</span>
    aiString path<span class="token punctuation">;</span>  <span class="token comment">// 我们储存纹理的路径用于与其它纹理进行比较</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

vector<span class="token operator">&lt;</span>Texture<span class="token operator">&gt;</span> textures_loaded<span class="token punctuation">;</span>

vector<span class="token operator">&lt;</span>Texture<span class="token operator">&gt;</span> <span class="token function">loadMaterialTextures</span><span class="token punctuation">(</span>aiMaterial <span class="token operator">*</span>mat<span class="token punctuation">,</span> aiTextureType type<span class="token punctuation">,</span> string typeName<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    vector<span class="token operator">&lt;</span>Texture<span class="token operator">&gt;</span> textures<span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> mat<span class="token operator">-&gt;</span><span class="token function">GetTextureCount</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        aiString str<span class="token punctuation">;</span>
        mat<span class="token operator">-&gt;</span><span class="token function">GetTexture</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
        bool skip <span class="token operator">=</span> false<span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> textures_loaded<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>std<span class="token operator">::</span><span class="token function">strcmp</span><span class="token punctuation">(</span>textures_loaded<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> str<span class="token punctuation">.</span><span class="token function">C_Str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                textures<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>textures_loaded<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                skip <span class="token operator">=</span> true<span class="token punctuation">;</span> 
                <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token operator">!</span>skip<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>   <span class="token comment">// 如果纹理还没有被加载，则加载它</span>
            Texture texture<span class="token punctuation">;</span>

            <span class="token comment">// 新工具函数，加载纹理并返回ID</span>
            <span class="token comment">// 注意这里的路径是相对路径</span>
            texture<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token function">TextureFromFile</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">C_Str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> directory<span class="token punctuation">)</span><span class="token punctuation">;</span>

            texture<span class="token punctuation">.</span>type <span class="token operator">=</span> typeName<span class="token punctuation">;</span>
            texture<span class="token punctuation">.</span>path <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">C_Str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            textures<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>texture<span class="token punctuation">)</span><span class="token punctuation">;</span>
            textures_loaded<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>texture<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加到已加载的纹理中</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> textures<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>完整的代码实现如下所示：</p>
<details>
<summary>shader.h</summary>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">SHADER_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SHADER_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;glad/glad.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;glm/glm.hpp&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fstream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sstream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

<span class="token comment">// 封装shader</span>
<span class="token comment">// 后续只需要写单独的着色器程序</span>
<span class="token comment">// 然后使用如下命令:</span>

<span class="token comment">// 创建着色器程序：Shader my_shader(vertexpath , fragmentpath , geometrypath);</span>
<span class="token comment">// 启用着色器程序：my_shader.use();</span>
<span class="token comment">// 传入uniform变量：my_shader.setxxx("xxx" , xxx);</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Shader</span>
<span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> ID<span class="token punctuation">;</span>

    <span class="token function">Shader</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-char">char</span><span class="token operator">*</span> vertexPath<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-char">char</span><span class="token operator">*</span> fragmentPath<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-char">char</span><span class="token operator">*</span> geometryPath <span class="token operator">=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 定义三个着色器的源码和文件</span>
        std<span class="token double-colon punctuation">::</span>string vertexCode<span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>string fragmentCode<span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>string geometryCode<span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>ifstream vShaderFile<span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>ifstream fShaderFile<span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>ifstream gShaderFile<span class="token punctuation">;</span>
        <span class="token comment">// 异常处理保证</span>
        vShaderFile<span class="token punctuation">.</span><span class="token function">exceptions</span> <span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>ifstream<span class="token double-colon punctuation">::</span>failbit <span class="token operator">|</span> std<span class="token double-colon punctuation">::</span>ifstream<span class="token double-colon punctuation">::</span>badbit<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fShaderFile<span class="token punctuation">.</span><span class="token function">exceptions</span> <span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>ifstream<span class="token double-colon punctuation">::</span>failbit <span class="token operator">|</span> std<span class="token double-colon punctuation">::</span>ifstream<span class="token double-colon punctuation">::</span>badbit<span class="token punctuation">)</span><span class="token punctuation">;</span>
        gShaderFile<span class="token punctuation">.</span><span class="token function">exceptions</span> <span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>ifstream<span class="token double-colon punctuation">::</span>failbit <span class="token operator">|</span> std<span class="token double-colon punctuation">::</span>ifstream<span class="token double-colon punctuation">::</span>badbit<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-try">try</span> 
        <span class="token punctuation">{</span>

            vShaderFile<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>vertexPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fShaderFile<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>fragmentPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            std<span class="token double-colon punctuation">::</span>stringstream vShaderStream<span class="token punctuation">,</span> fShaderStream<span class="token punctuation">;</span>

            vShaderStream <span class="token operator">&lt;&lt;</span> vShaderFile<span class="token punctuation">.</span><span class="token function">rdbuf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            fShaderStream <span class="token operator">&lt;&lt;</span> fShaderFile<span class="token punctuation">.</span><span class="token function">rdbuf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		

            vShaderFile<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            fShaderFile<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 转换源码</span>
            vertexCode <span class="token operator">=</span> vShaderStream<span class="token punctuation">.</span><span class="token function">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            fragmentCode <span class="token operator">=</span> fShaderStream<span class="token punctuation">.</span><span class="token function">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			
            <span class="token comment">// 有几何着色器才进行读取</span>
            <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>geometryPath <span class="token operator">!=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                gShaderFile<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>geometryPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
                std<span class="token double-colon punctuation">::</span>stringstream gShaderStream<span class="token punctuation">;</span>
                gShaderStream <span class="token operator">&lt;&lt;</span> gShaderFile<span class="token punctuation">.</span><span class="token function">rdbuf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                gShaderFile<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                geometryCode <span class="token operator">=</span> gShaderStream<span class="token punctuation">.</span><span class="token function">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>ifstream<span class="token double-colon punctuation">::</span>failure<span class="token operator">&amp;</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// 处理读取失败，通常是因为传入路径不对</span>
            std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"ERROR::SHADER::FILE_NOT_SUCCESSFULLY_READ: "</span> <span class="token operator">&lt;&lt;</span> e<span class="token punctuation">.</span><span class="token function">what</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-char">char</span><span class="token operator">*</span> vShaderCode <span class="token operator">=</span> vertexCode<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-char">char</span> <span class="token operator">*</span> fShaderCode <span class="token operator">=</span> fragmentCode<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> vertex<span class="token punctuation">,</span> fragment<span class="token punctuation">;</span>
        <span class="token comment">// vs</span>
        vertex <span class="token operator">=</span> <span class="token function">glCreateShader</span><span class="token punctuation">(</span>GL_VERTEX_SHADER<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glShaderSource</span><span class="token punctuation">(</span>vertex<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>vShaderCode<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glCompileShader</span><span class="token punctuation">(</span>vertex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">checkCompileErrors</span><span class="token punctuation">(</span>vertex<span class="token punctuation">,</span> <span class="token string">"VERTEX"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// fs</span>
        fragment <span class="token operator">=</span> <span class="token function">glCreateShader</span><span class="token punctuation">(</span>GL_FRAGMENT_SHADER<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glShaderSource</span><span class="token punctuation">(</span>fragment<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>fShaderCode<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glCompileShader</span><span class="token punctuation">(</span>fragment<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">checkCompileErrors</span><span class="token punctuation">(</span>fragment<span class="token punctuation">,</span> <span class="token string">"FRAGMENT"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// gs</span>
        <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> geometry<span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>geometryPath <span class="token operator">!=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-char">char</span> <span class="token operator">*</span> gShaderCode <span class="token operator">=</span> geometryCode<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            geometry <span class="token operator">=</span> <span class="token function">glCreateShader</span><span class="token punctuation">(</span>GL_GEOMETRY_SHADER<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">glShaderSource</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>gShaderCode<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">glCompileShader</span><span class="token punctuation">(</span>geometry<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">checkCompileErrors</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> <span class="token string">"GEOMETRY"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 绑定到着色器程序</span>
        ID <span class="token operator">=</span> <span class="token function">glCreateProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glAttachShader</span><span class="token punctuation">(</span>ID<span class="token punctuation">,</span> vertex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glAttachShader</span><span class="token punctuation">(</span>ID<span class="token punctuation">,</span> fragment<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>geometryPath <span class="token operator">!=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">)</span>
            <span class="token function">glAttachShader</span><span class="token punctuation">(</span>ID<span class="token punctuation">,</span> geometry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glLinkProgram</span><span class="token punctuation">(</span>ID<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">checkCompileErrors</span><span class="token punctuation">(</span>ID<span class="token punctuation">,</span> <span class="token string">"PROGRAM"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 删除着色器</span>
        <span class="token function">glDeleteShader</span><span class="token punctuation">(</span>vertex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glDeleteShader</span><span class="token punctuation">(</span>fragment<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>geometryPath <span class="token operator">!=</span> <span class="token keyword keyword-nullptr">nullptr</span><span class="token punctuation">)</span>
            <span class="token function">glDeleteShader</span><span class="token punctuation">(</span>geometry<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token comment">// 启用着色器</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{</span> 
        <span class="token function">glUseProgram</span><span class="token punctuation">(</span>ID<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>

    <span class="token comment">// uniform变量设置</span>
    <span class="token comment">// ------------------------------------------------------------------------</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">setBool</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> std<span class="token double-colon punctuation">::</span>string <span class="token operator">&amp;</span>name<span class="token punctuation">,</span> <span class="token keyword keyword-bool">bool</span> value<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span>
    <span class="token punctuation">{</span>         
        <span class="token function">glUniform1i</span><span class="token punctuation">(</span><span class="token function">glGetUniformLocation</span><span class="token punctuation">(</span>ID<span class="token punctuation">,</span> name<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span><span class="token punctuation">)</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
    <span class="token comment">// ------------------------------------------------------------------------</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">setInt</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> std<span class="token double-colon punctuation">::</span>string <span class="token operator">&amp;</span>name<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> value<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span>
    <span class="token punctuation">{</span> 
        <span class="token function">glUniform1i</span><span class="token punctuation">(</span><span class="token function">glGetUniformLocation</span><span class="token punctuation">(</span>ID<span class="token punctuation">,</span> name<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
    <span class="token comment">// ------------------------------------------------------------------------</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> std<span class="token double-colon punctuation">::</span>string <span class="token operator">&amp;</span>name<span class="token punctuation">,</span> <span class="token keyword keyword-float">float</span> value<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span>
    <span class="token punctuation">{</span> 
        <span class="token function">glUniform1f</span><span class="token punctuation">(</span><span class="token function">glGetUniformLocation</span><span class="token punctuation">(</span>ID<span class="token punctuation">,</span> name<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
    <span class="token comment">// ------------------------------------------------------------------------</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">setVec2</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> std<span class="token double-colon punctuation">::</span>string <span class="token operator">&amp;</span>name<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> glm<span class="token double-colon punctuation">::</span>vec2 <span class="token operator">&amp;</span>value<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span>
    <span class="token punctuation">{</span> 
        <span class="token function">glUniform2fv</span><span class="token punctuation">(</span><span class="token function">glGetUniformLocation</span><span class="token punctuation">(</span>ID<span class="token punctuation">,</span> name<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>value<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">setVec2</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> std<span class="token double-colon punctuation">::</span>string <span class="token operator">&amp;</span>name<span class="token punctuation">,</span> <span class="token keyword keyword-float">float</span> x<span class="token punctuation">,</span> <span class="token keyword keyword-float">float</span> y<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span>
    <span class="token punctuation">{</span> 
        <span class="token function">glUniform2f</span><span class="token punctuation">(</span><span class="token function">glGetUniformLocation</span><span class="token punctuation">(</span>ID<span class="token punctuation">,</span> name<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
    <span class="token comment">// ------------------------------------------------------------------------</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> std<span class="token double-colon punctuation">::</span>string <span class="token operator">&amp;</span>name<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> glm<span class="token double-colon punctuation">::</span>vec3 <span class="token operator">&amp;</span>value<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span>
    <span class="token punctuation">{</span> 
        <span class="token function">glUniform3fv</span><span class="token punctuation">(</span><span class="token function">glGetUniformLocation</span><span class="token punctuation">(</span>ID<span class="token punctuation">,</span> name<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>value<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> std<span class="token double-colon punctuation">::</span>string <span class="token operator">&amp;</span>name<span class="token punctuation">,</span> <span class="token keyword keyword-float">float</span> x<span class="token punctuation">,</span> <span class="token keyword keyword-float">float</span> y<span class="token punctuation">,</span> <span class="token keyword keyword-float">float</span> z<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span>
    <span class="token punctuation">{</span> 
        <span class="token function">glUniform3f</span><span class="token punctuation">(</span><span class="token function">glGetUniformLocation</span><span class="token punctuation">(</span>ID<span class="token punctuation">,</span> name<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
    <span class="token comment">// ------------------------------------------------------------------------</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">setVec4</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> std<span class="token double-colon punctuation">::</span>string <span class="token operator">&amp;</span>name<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> glm<span class="token double-colon punctuation">::</span>vec4 <span class="token operator">&amp;</span>value<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span>
    <span class="token punctuation">{</span> 
        <span class="token function">glUniform4fv</span><span class="token punctuation">(</span><span class="token function">glGetUniformLocation</span><span class="token punctuation">(</span>ID<span class="token punctuation">,</span> name<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>value<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">setVec4</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> std<span class="token double-colon punctuation">::</span>string <span class="token operator">&amp;</span>name<span class="token punctuation">,</span> <span class="token keyword keyword-float">float</span> x<span class="token punctuation">,</span> <span class="token keyword keyword-float">float</span> y<span class="token punctuation">,</span> <span class="token keyword keyword-float">float</span> z<span class="token punctuation">,</span> <span class="token keyword keyword-float">float</span> w<span class="token punctuation">)</span> 
    <span class="token punctuation">{</span> 
        <span class="token function">glUniform4f</span><span class="token punctuation">(</span><span class="token function">glGetUniformLocation</span><span class="token punctuation">(</span>ID<span class="token punctuation">,</span> name<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> w<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
    <span class="token comment">// ------------------------------------------------------------------------</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">setMat2</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> std<span class="token double-colon punctuation">::</span>string <span class="token operator">&amp;</span>name<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> glm<span class="token double-colon punctuation">::</span>mat2 <span class="token operator">&amp;</span>mat<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span>
    <span class="token punctuation">{</span>
        <span class="token function">glUniformMatrix2fv</span><span class="token punctuation">(</span><span class="token function">glGetUniformLocation</span><span class="token punctuation">(</span>ID<span class="token punctuation">,</span> name<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token operator">&amp;</span>mat<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ------------------------------------------------------------------------</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">setMat3</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> std<span class="token double-colon punctuation">::</span>string <span class="token operator">&amp;</span>name<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> glm<span class="token double-colon punctuation">::</span>mat3 <span class="token operator">&amp;</span>mat<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span>
    <span class="token punctuation">{</span>
        <span class="token function">glUniformMatrix3fv</span><span class="token punctuation">(</span><span class="token function">glGetUniformLocation</span><span class="token punctuation">(</span>ID<span class="token punctuation">,</span> name<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token operator">&amp;</span>mat<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ------------------------------------------------------------------------</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">setMat4</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> std<span class="token double-colon punctuation">::</span>string <span class="token operator">&amp;</span>name<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> glm<span class="token double-colon punctuation">::</span>mat4 <span class="token operator">&amp;</span>mat<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span>
    <span class="token punctuation">{</span>
        <span class="token function">glUniformMatrix4fv</span><span class="token punctuation">(</span><span class="token function">glGetUniformLocation</span><span class="token punctuation">(</span>ID<span class="token punctuation">,</span> name<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token operator">&amp;</span>mat<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
    <span class="token comment">// 检查着色器编译错误</span>
    <span class="token comment">// ------------------------------------------------------------------------</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">checkCompileErrors</span><span class="token punctuation">(</span>GLuint shader<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>string type<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        GLint success<span class="token punctuation">;</span>
        GLchar infoLog<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>type <span class="token operator">!=</span> <span class="token string">"PROGRAM"</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// 着色器编译错误，也就是某个着色器程序没写对</span>
            <span class="token function">glGetShaderiv</span><span class="token punctuation">(</span>shader<span class="token punctuation">,</span> GL_COMPILE_STATUS<span class="token punctuation">,</span> <span class="token operator">&amp;</span>success<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token operator">!</span>success<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token function">glGetShaderInfoLog</span><span class="token punctuation">(</span>shader<span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> infoLog<span class="token punctuation">)</span><span class="token punctuation">;</span>
                std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"ERROR::SHADER_COMPILATION_ERROR of type: "</span> <span class="token operator">&lt;&lt;</span> type <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span> <span class="token operator">&lt;&lt;</span> infoLog <span class="token operator">&lt;&lt;</span> <span class="token string">"\n -- --------------------------------------------------- -- "</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-else">else</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// 着色器程序链接错误，感觉一般不会发生</span>
            <span class="token function">glGetProgramiv</span><span class="token punctuation">(</span>shader<span class="token punctuation">,</span> GL_LINK_STATUS<span class="token punctuation">,</span> <span class="token operator">&amp;</span>success<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token operator">!</span>success<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token function">glGetProgramInfoLog</span><span class="token punctuation">(</span>shader<span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> infoLog<span class="token punctuation">)</span><span class="token punctuation">;</span>
                std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"ERROR::PROGRAM_LINKING_ERROR of type: "</span> <span class="token operator">&lt;&lt;</span> type <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span> <span class="token operator">&lt;&lt;</span> infoLog <span class="token operator">&lt;&lt;</span> <span class="token string">"\n -- --------------------------------------------------- -- "</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre></details>
<details>
<summary>camera.h</summary>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">CAMERA_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CAMERA_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;glad/glad.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;glm/glm.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;glm/gtc/matrix_transform.hpp&gt;</span></span>

<span class="token comment">// 封装camera</span>
<span class="token comment">// 只需要用如下几条简单的命令即可拥有丰富的相机视角：</span>

<span class="token comment">// 初始化相机：Camera camera(position); （其他方向基本都是上和右，已经预置）</span>
<span class="token comment">// 获得view矩阵：view = camera.GetViewMatrix();</span>
<span class="token comment">// 获得proj矩阵的第一个参数fov：cmera.Zoom</span>

<span class="token comment">// 键盘鼠标回调函数中</span>
<span class="token comment">// camera.ProcessKeyboard ; camera.ProcessMouseMovement ; camera.ProcessMouseScroll(static_cast&lt;float&gt;(yoffset));</span>

<span class="token keyword keyword-enum">enum</span> <span class="token class-name">Camera_Movement</span> <span class="token punctuation">{</span>
    FORWARD<span class="token punctuation">,</span>
    BACKWARD<span class="token punctuation">,</span>
    LEFT<span class="token punctuation">,</span>
    RIGHT
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 初始时看向-z方向，防止一开始跳动</span>
<span class="token keyword keyword-const">const</span> <span class="token keyword keyword-float">float</span> YAW         <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">90.0f</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> <span class="token keyword keyword-float">float</span> PITCH       <span class="token operator">=</span>  <span class="token number">0.0f</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> <span class="token keyword keyword-float">float</span> SPEED       <span class="token operator">=</span>  <span class="token number">2.5f</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> <span class="token keyword keyword-float">float</span> SENSITIVITY <span class="token operator">=</span>  <span class="token number">0.1f</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> <span class="token keyword keyword-float">float</span> ZOOM        <span class="token operator">=</span>  <span class="token number">45.0f</span><span class="token punctuation">;</span>


<span class="token keyword keyword-class">class</span> <span class="token class-name">Camera</span>
<span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    
    glm<span class="token double-colon punctuation">::</span>vec3 Position<span class="token punctuation">;</span>
    glm<span class="token double-colon punctuation">::</span>vec3 Front<span class="token punctuation">;</span>
    glm<span class="token double-colon punctuation">::</span>vec3 Up<span class="token punctuation">;</span>
    glm<span class="token double-colon punctuation">::</span>vec3 Right<span class="token punctuation">;</span>
    glm<span class="token double-colon punctuation">::</span>vec3 WorldUp<span class="token punctuation">;</span>
    
    <span class="token keyword keyword-float">float</span> Yaw<span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> Pitch<span class="token punctuation">;</span>
    
    <span class="token keyword keyword-float">float</span> MovementSpeed<span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> MouseSensitivity<span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> Zoom<span class="token punctuation">;</span>

    <span class="token comment">// 定义相机的方式</span>
    <span class="token function">Camera</span><span class="token punctuation">(</span>glm<span class="token double-colon punctuation">::</span>vec3 position <span class="token operator">=</span> glm<span class="token double-colon punctuation">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">)</span><span class="token punctuation">,</span> glm<span class="token double-colon punctuation">::</span>vec3 up <span class="token operator">=</span> glm<span class="token double-colon punctuation">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword keyword-float">float</span> yaw <span class="token operator">=</span> YAW<span class="token punctuation">,</span> <span class="token keyword keyword-float">float</span> pitch <span class="token operator">=</span> PITCH<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">Front</span><span class="token punctuation">(</span>glm<span class="token double-colon punctuation">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">MovementSpeed</span><span class="token punctuation">(</span>SPEED<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">MouseSensitivity</span><span class="token punctuation">(</span>SENSITIVITY<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Zoom</span><span class="token punctuation">(</span>ZOOM<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Position <span class="token operator">=</span> position<span class="token punctuation">;</span>
        WorldUp <span class="token operator">=</span> up<span class="token punctuation">;</span>
        Yaw <span class="token operator">=</span> yaw<span class="token punctuation">;</span>
        Pitch <span class="token operator">=</span> pitch<span class="token punctuation">;</span>
        <span class="token function">updateCameraVectors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token function">Camera</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span> posX<span class="token punctuation">,</span> <span class="token keyword keyword-float">float</span> posY<span class="token punctuation">,</span> <span class="token keyword keyword-float">float</span> posZ<span class="token punctuation">,</span> <span class="token keyword keyword-float">float</span> upX<span class="token punctuation">,</span> <span class="token keyword keyword-float">float</span> upY<span class="token punctuation">,</span> <span class="token keyword keyword-float">float</span> upZ<span class="token punctuation">,</span> <span class="token keyword keyword-float">float</span> yaw<span class="token punctuation">,</span> <span class="token keyword keyword-float">float</span> pitch<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">Front</span><span class="token punctuation">(</span>glm<span class="token double-colon punctuation">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">MovementSpeed</span><span class="token punctuation">(</span>SPEED<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">MouseSensitivity</span><span class="token punctuation">(</span>SENSITIVITY<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Zoom</span><span class="token punctuation">(</span>ZOOM<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Position <span class="token operator">=</span> glm<span class="token double-colon punctuation">::</span><span class="token function">vec3</span><span class="token punctuation">(</span>posX<span class="token punctuation">,</span> posY<span class="token punctuation">,</span> posZ<span class="token punctuation">)</span><span class="token punctuation">;</span>
        WorldUp <span class="token operator">=</span> glm<span class="token double-colon punctuation">::</span><span class="token function">vec3</span><span class="token punctuation">(</span>upX<span class="token punctuation">,</span> upY<span class="token punctuation">,</span> upZ<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Yaw <span class="token operator">=</span> yaw<span class="token punctuation">;</span>
        Pitch <span class="token operator">=</span> pitch<span class="token punctuation">;</span>
        <span class="token function">updateCameraVectors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 计算view矩阵</span>
    glm<span class="token double-colon punctuation">::</span>mat4 <span class="token function">GetViewMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> glm<span class="token double-colon punctuation">::</span><span class="token function">lookAt</span><span class="token punctuation">(</span>Position<span class="token punctuation">,</span> Position <span class="token operator">+</span> Front<span class="token punctuation">,</span> Up<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 处理键盘响应</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">ProcessKeyboard</span><span class="token punctuation">(</span>Camera_Movement direction<span class="token punctuation">,</span> <span class="token keyword keyword-float">float</span> deltaTime<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-float">float</span> velocity <span class="token operator">=</span> MovementSpeed <span class="token operator">*</span> deltaTime<span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>direction <span class="token operator">==</span> FORWARD<span class="token punctuation">)</span>
            Position <span class="token operator">+=</span> Front <span class="token operator">*</span> velocity<span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>direction <span class="token operator">==</span> BACKWARD<span class="token punctuation">)</span>
            Position <span class="token operator">-=</span> Front <span class="token operator">*</span> velocity<span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>direction <span class="token operator">==</span> LEFT<span class="token punctuation">)</span>
            Position <span class="token operator">-=</span> Right <span class="token operator">*</span> velocity<span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>direction <span class="token operator">==</span> RIGHT<span class="token punctuation">)</span>
            Position <span class="token operator">+=</span> Right <span class="token operator">*</span> velocity<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 处理鼠标相应</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">ProcessMouseMovement</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span> xoffset<span class="token punctuation">,</span> <span class="token keyword keyword-float">float</span> yoffset<span class="token punctuation">,</span> GLboolean constrainPitch <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        xoffset <span class="token operator">*=</span> MouseSensitivity<span class="token punctuation">;</span>
        yoffset <span class="token operator">*=</span> MouseSensitivity<span class="token punctuation">;</span>

        Yaw   <span class="token operator">+=</span> xoffset<span class="token punctuation">;</span>
        Pitch <span class="token operator">+=</span> yoffset<span class="token punctuation">;</span>

        <span class="token comment">// 防止上下转过头</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>constrainPitch<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>Pitch <span class="token operator">&gt;</span> <span class="token number">89.0f</span><span class="token punctuation">)</span>
                Pitch <span class="token operator">=</span> <span class="token number">89.0f</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>Pitch <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">89.0f</span><span class="token punctuation">)</span>
                Pitch <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">89.0f</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 更新摄像机位置</span>
        <span class="token function">updateCameraVectors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 处理滚轮</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">ProcessMouseScroll</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span> yoffset<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Zoom <span class="token operator">-=</span> <span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span>yoffset<span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>Zoom <span class="token operator">&lt;</span> <span class="token number">1.0f</span><span class="token punctuation">)</span>
            Zoom <span class="token operator">=</span> <span class="token number">1.0f</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>Zoom <span class="token operator">&gt;</span> <span class="token number">45.0f</span><span class="token punctuation">)</span>
            Zoom <span class="token operator">=</span> <span class="token number">45.0f</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
    <span class="token comment">// 计算摄像机参数</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">updateCameraVectors</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 前向方向，完全由欧拉角决定</span>
        glm<span class="token double-colon punctuation">::</span>vec3 front<span class="token punctuation">;</span>
        front<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token function">cos</span><span class="token punctuation">(</span>glm<span class="token double-colon punctuation">::</span><span class="token function">radians</span><span class="token punctuation">(</span>Yaw<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">cos</span><span class="token punctuation">(</span>glm<span class="token double-colon punctuation">::</span><span class="token function">radians</span><span class="token punctuation">(</span>Pitch<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        front<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span>glm<span class="token double-colon punctuation">::</span><span class="token function">radians</span><span class="token punctuation">(</span>Pitch<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        front<span class="token punctuation">.</span>z <span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span>glm<span class="token double-colon punctuation">::</span><span class="token function">radians</span><span class="token punctuation">(</span>Yaw<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">cos</span><span class="token punctuation">(</span>glm<span class="token double-colon punctuation">::</span><span class="token function">radians</span><span class="token punctuation">(</span>Pitch<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Front <span class="token operator">=</span> glm<span class="token double-colon punctuation">::</span><span class="token function">normalize</span><span class="token punctuation">(</span>front<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 右、上方向，实际上不大会变，因为我们设定了上方向始终是(0,1,0)</span>
        Right <span class="token operator">=</span> glm<span class="token double-colon punctuation">::</span><span class="token function">normalize</span><span class="token punctuation">(</span>glm<span class="token double-colon punctuation">::</span><span class="token function">cross</span><span class="token punctuation">(</span>Front<span class="token punctuation">,</span> WorldUp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        Up    <span class="token operator">=</span> glm<span class="token double-colon punctuation">::</span><span class="token function">normalize</span><span class="token punctuation">(</span>glm<span class="token double-colon punctuation">::</span><span class="token function">cross</span><span class="token punctuation">(</span>Right<span class="token punctuation">,</span> Front<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre></details>
<details>
<summary>mesh.h</summary>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">MESH_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MESH_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;glad/glad.h&gt;</span> </span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;glm/glm.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;glm/gtc/matrix_transform.hpp&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;shader.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MAX_BONE_INFLUENCE</span> <span class="token expression"><span class="token number">4</span></span></span>

<span class="token comment">// 封装mesh</span>
<span class="token comment">// 只会在model中被使用</span>
<span class="token comment">// 在main.cpp中都不需要使用这个头文件</span>
<span class="token comment">// 处于model的下层</span>

<span class="token keyword keyword-struct">struct</span> <span class="token class-name">Vertex</span> <span class="token punctuation">{</span>
    
    glm<span class="token double-colon punctuation">::</span>vec3 Position<span class="token punctuation">;</span>
    
    glm<span class="token double-colon punctuation">::</span>vec3 Normal<span class="token punctuation">;</span>
    
    glm<span class="token double-colon punctuation">::</span>vec2 TexCoords<span class="token punctuation">;</span>
    
    <span class="token comment">// 切线，副切线</span>
    <span class="token comment">// 和法线贴图有关，还没学，但是也先封装好</span>
    glm<span class="token double-colon punctuation">::</span>vec3 Tangent<span class="token punctuation">;</span>
    glm<span class="token double-colon punctuation">::</span>vec3 Bitangent<span class="token punctuation">;</span>
	
    <span class="token comment">// 骨骼索引和权重</span>
    <span class="token comment">// 和骨骼动画有关，还没学，但是也先封装好</span>
	<span class="token keyword keyword-int">int</span> m_BoneIDs<span class="token punctuation">[</span>MAX_BONE_INFLUENCE<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-float">float</span> m_Weights<span class="token punctuation">[</span>MAX_BONE_INFLUENCE<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-struct">struct</span> <span class="token class-name">Texture</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> id<span class="token punctuation">;</span>
    string type<span class="token punctuation">;</span>
    string path<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Mesh</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    
    vector<span class="token operator">&lt;</span>Vertex<span class="token operator">&gt;</span>       vertices<span class="token punctuation">;</span>
    vector<span class="token operator">&lt;</span><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span> indices<span class="token punctuation">;</span>
    vector<span class="token operator">&lt;</span>Texture<span class="token operator">&gt;</span>      textures<span class="token punctuation">;</span>
    <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> VAO<span class="token punctuation">;</span>

    
    <span class="token function">Mesh</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>Vertex<span class="token operator">&gt;</span> vertices<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span> indices<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span>Texture<span class="token operator">&gt;</span> textures<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-this">this</span><span class="token operator">-&gt;</span>vertices <span class="token operator">=</span> vertices<span class="token punctuation">;</span>
        <span class="token keyword keyword-this">this</span><span class="token operator">-&gt;</span>indices <span class="token operator">=</span> indices<span class="token punctuation">;</span>
        <span class="token keyword keyword-this">this</span><span class="token operator">-&gt;</span>textures <span class="token operator">=</span> textures<span class="token punctuation">;</span>

        <span class="token function">setupMesh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-void">void</span> <span class="token function">Draw</span><span class="token punctuation">(</span>Shader <span class="token operator">&amp;</span>shader<span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> diffuseNr  <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> specularNr <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> normalNr   <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> heightNr   <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> textures<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">glActiveTexture</span><span class="token punctuation">(</span>GL_TEXTURE0 <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token comment">// 把着色器需要的采样器给绑定好</span>
            string number<span class="token punctuation">;</span>
            string name <span class="token operator">=</span> textures<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>type<span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token string">"texture_diffuse"</span><span class="token punctuation">)</span>
                number <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>diffuseNr<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token string">"texture_specular"</span><span class="token punctuation">)</span>
                number <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>specularNr<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token string">"texture_normal"</span><span class="token punctuation">)</span>
                number <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>normalNr<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
             <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token string">"texture_height"</span><span class="token punctuation">)</span>
                number <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>heightNr<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

            <span class="token function">glUniform1i</span><span class="token punctuation">(</span><span class="token function">glGetUniformLocation</span><span class="token punctuation">(</span>shader<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> <span class="token punctuation">(</span>name <span class="token operator">+</span> number<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> textures<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">// 绘制</span>
        <span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>VAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glDrawElements</span><span class="token punctuation">(</span>GL_TRIANGLES<span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>indices<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> GL_UNSIGNED_INT<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glBindVertexArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 清除</span>
        <span class="token function">glActiveTexture</span><span class="token punctuation">(</span>GL_TEXTURE0<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
    <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> VBO<span class="token punctuation">,</span> EBO<span class="token punctuation">;</span>

    <span class="token keyword keyword-void">void</span> <span class="token function">setupMesh</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">glGenVertexArrays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>VAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glGenBuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>VBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glGenBuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>EBO<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>VAO<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 上载VBO,EBO数据</span>
        <span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> VBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glBufferData</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> vertices<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>Vertex<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>vertices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> GL_STATIC_DRAW<span class="token punctuation">)</span><span class="token punctuation">;</span>  

        <span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ELEMENT_ARRAY_BUFFER<span class="token punctuation">,</span> EBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glBufferData</span><span class="token punctuation">(</span>GL_ELEMENT_ARRAY_BUFFER<span class="token punctuation">,</span> indices<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>indices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> GL_STATIC_DRAW<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 位置</span>
        <span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
        <span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>Vertex<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 法线</span>
        <span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
        <span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>Vertex<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">offsetof</span><span class="token punctuation">(</span>Vertex<span class="token punctuation">,</span> Normal<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 纹理坐标</span>
        <span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
        <span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>Vertex<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">offsetof</span><span class="token punctuation">(</span>Vertex<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 切线</span>
        <span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>Vertex<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">offsetof</span><span class="token punctuation">(</span>Vertex<span class="token punctuation">,</span> Tangent<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 副切线</span>
        <span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>Vertex<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">offsetof</span><span class="token punctuation">(</span>Vertex<span class="token punctuation">,</span> Bitangent<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 骨骼索引</span>
		<span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glVertexAttribIPointer</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> GL_INT<span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>Vertex<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">offsetof</span><span class="token punctuation">(</span>Vertex<span class="token punctuation">,</span> m_BoneIDs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 权重</span>
		<span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>Vertex<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">offsetof</span><span class="token punctuation">(</span>Vertex<span class="token punctuation">,</span> m_Weights<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glBindVertexArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre></details>
<details>
<summary>model.h</summary>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">MODEL_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MODEL_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;glad/glad.h&gt;</span> </span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;glm/glm.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;glm/gtc/matrix_transform.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stb_image.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;assimp/Importer.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;assimp/scene.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;assimp/postprocess.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;mesh.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;shader.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fstream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sstream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;map&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token comment">// 封装model</span>
<span class="token comment">// 只需要如下几个很简单的命令：</span>

<span class="token comment">// 定义模型:Model my_model(path);</span>
<span class="token comment">// 绘制模型:my_model.Draw(my_shader);</span>

<span class="token comment">// 需要特别注意的是着色器中的采样器的明明形式只能为:texture_specularN</span>

<span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> <span class="token function">TextureFromFile</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-char">char</span> <span class="token operator">*</span>path<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> string <span class="token operator">&amp;</span>directory<span class="token punctuation">,</span> <span class="token keyword keyword-bool">bool</span> gamma <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Model</span> 
<span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    
    <span class="token comment">// 只存不一样的贴图，可以使贴图复用，节约内存</span>
    vector<span class="token operator">&lt;</span>Texture<span class="token operator">&gt;</span> textures_loaded<span class="token punctuation">;</span>

    vector<span class="token operator">&lt;</span>Mesh<span class="token operator">&gt;</span>    meshes<span class="token punctuation">;</span>
    string directory<span class="token punctuation">;</span>
    <span class="token keyword keyword-bool">bool</span> gammaCorrection<span class="token punctuation">;</span>

    <span class="token comment">// 加载</span>
    <span class="token function">Model</span><span class="token punctuation">(</span>string <span class="token keyword keyword-const">const</span> <span class="token operator">&amp;</span>path<span class="token punctuation">,</span> <span class="token keyword keyword-bool">bool</span> gamma <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">gammaCorrection</span><span class="token punctuation">(</span>gamma<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">loadModel</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 绘制</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">Draw</span><span class="token punctuation">(</span>Shader <span class="token operator">&amp;</span>shader<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> meshes<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            meshes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">Draw</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
    <span class="token comment">// 利用assimp加载模型</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">loadModel</span><span class="token punctuation">(</span>string <span class="token keyword keyword-const">const</span> <span class="token operator">&amp;</span>path<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        
        Assimp<span class="token double-colon punctuation">::</span>Importer importer<span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> aiScene<span class="token operator">*</span> scene <span class="token operator">=</span> importer<span class="token punctuation">.</span><span class="token function">ReadFile</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> aiProcess_Triangulate <span class="token operator">|</span> aiProcess_GenSmoothNormals <span class="token operator">|</span> aiProcess_FlipUVs <span class="token operator">|</span> aiProcess_CalcTangentSpace<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token operator">!</span>scene <span class="token operator">||</span> scene<span class="token operator">-&gt;</span>mFlags <span class="token operator">&amp;</span> AI_SCENE_FLAGS_INCOMPLETE <span class="token operator">||</span> <span class="token operator">!</span>scene<span class="token operator">-&gt;</span>mRootNode<span class="token punctuation">)</span> 
        <span class="token punctuation">{</span>
            cout <span class="token operator">&lt;&lt;</span> <span class="token string">"ERROR::ASSIMP:: "</span> <span class="token operator">&lt;&lt;</span> importer<span class="token punctuation">.</span><span class="token function">GetErrorString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        directory <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">find_last_of</span><span class="token punctuation">(</span><span class="token char">'/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        
        <span class="token function">processNode</span><span class="token punctuation">(</span>scene<span class="token operator">-&gt;</span>mRootNode<span class="token punctuation">,</span> scene<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 找到所有的mesh</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">processNode</span><span class="token punctuation">(</span>aiNode <span class="token operator">*</span>node<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> aiScene <span class="token operator">*</span>scene<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> node<span class="token operator">-&gt;</span>mNumMeshes<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            aiMesh<span class="token operator">*</span> mesh <span class="token operator">=</span> scene<span class="token operator">-&gt;</span>mMeshes<span class="token punctuation">[</span>node<span class="token operator">-&gt;</span>mMeshes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            meshes<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">processMesh</span><span class="token punctuation">(</span>mesh<span class="token punctuation">,</span> scene<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> node<span class="token operator">-&gt;</span>mNumChildren<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">processNode</span><span class="token punctuation">(</span>node<span class="token operator">-&gt;</span>mChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> scene<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token comment">// 把assimp中的mesh转换成自己的mesh</span>
    Mesh <span class="token function">processMesh</span><span class="token punctuation">(</span>aiMesh <span class="token operator">*</span>mesh<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> aiScene <span class="token operator">*</span>scene<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        vector<span class="token operator">&lt;</span>Vertex<span class="token operator">&gt;</span> vertices<span class="token punctuation">;</span>
        vector<span class="token operator">&lt;</span><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span> indices<span class="token punctuation">;</span>
        vector<span class="token operator">&lt;</span>Texture<span class="token operator">&gt;</span> textures<span class="token punctuation">;</span>
        <span class="token comment">// 存vertices</span>
        <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> mesh<span class="token operator">-&gt;</span>mNumVertices<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            Vertex vertex<span class="token punctuation">;</span>
            glm<span class="token double-colon punctuation">::</span>vec3 vector<span class="token punctuation">;</span> 
            vector<span class="token punctuation">.</span>x <span class="token operator">=</span> mesh<span class="token operator">-&gt;</span>mVertices<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">;</span>
            vector<span class="token punctuation">.</span>y <span class="token operator">=</span> mesh<span class="token operator">-&gt;</span>mVertices<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>
            vector<span class="token punctuation">.</span>z <span class="token operator">=</span> mesh<span class="token operator">-&gt;</span>mVertices<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token punctuation">;</span>
            vertex<span class="token punctuation">.</span>Position <span class="token operator">=</span> vector<span class="token punctuation">;</span>

            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>mesh<span class="token operator">-&gt;</span><span class="token function">HasNormals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                vector<span class="token punctuation">.</span>x <span class="token operator">=</span> mesh<span class="token operator">-&gt;</span>mNormals<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">;</span>
                vector<span class="token punctuation">.</span>y <span class="token operator">=</span> mesh<span class="token operator">-&gt;</span>mNormals<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>
                vector<span class="token punctuation">.</span>z <span class="token operator">=</span> mesh<span class="token operator">-&gt;</span>mNormals<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token punctuation">;</span>
                vertex<span class="token punctuation">.</span>Normal <span class="token operator">=</span> vector<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>mesh<span class="token operator">-&gt;</span>mTextureCoords<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
            <span class="token punctuation">{</span>
                glm<span class="token double-colon punctuation">::</span>vec2 vec<span class="token punctuation">;</span>

                vec<span class="token punctuation">.</span>x <span class="token operator">=</span> mesh<span class="token operator">-&gt;</span>mTextureCoords<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">;</span> 
                vec<span class="token punctuation">.</span>y <span class="token operator">=</span> mesh<span class="token operator">-&gt;</span>mTextureCoords<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>
                vertex<span class="token punctuation">.</span>TexCoords <span class="token operator">=</span> vec<span class="token punctuation">;</span>

                vector<span class="token punctuation">.</span>x <span class="token operator">=</span> mesh<span class="token operator">-&gt;</span>mTangents<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">;</span>
                vector<span class="token punctuation">.</span>y <span class="token operator">=</span> mesh<span class="token operator">-&gt;</span>mTangents<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>
                vector<span class="token punctuation">.</span>z <span class="token operator">=</span> mesh<span class="token operator">-&gt;</span>mTangents<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token punctuation">;</span>
                vertex<span class="token punctuation">.</span>Tangent <span class="token operator">=</span> vector<span class="token punctuation">;</span>

                vector<span class="token punctuation">.</span>x <span class="token operator">=</span> mesh<span class="token operator">-&gt;</span>mBitangents<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">;</span>
                vector<span class="token punctuation">.</span>y <span class="token operator">=</span> mesh<span class="token operator">-&gt;</span>mBitangents<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>
                vector<span class="token punctuation">.</span>z <span class="token operator">=</span> mesh<span class="token operator">-&gt;</span>mBitangents<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token punctuation">;</span>
                vertex<span class="token punctuation">.</span>Bitangent <span class="token operator">=</span> vector<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-else">else</span>
                vertex<span class="token punctuation">.</span>TexCoords <span class="token operator">=</span> glm<span class="token double-colon punctuation">::</span><span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            vertices<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>vertex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 存indices</span>
        <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> mesh<span class="token operator">-&gt;</span>mNumFaces<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            aiFace face <span class="token operator">=</span> mesh<span class="token operator">-&gt;</span>mFaces<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> face<span class="token punctuation">.</span>mNumIndices<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
                indices<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>face<span class="token punctuation">.</span>mIndices<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        
        <span class="token punctuation">}</span>

        aiMaterial<span class="token operator">*</span> material <span class="token operator">=</span> scene<span class="token operator">-&gt;</span>mMaterials<span class="token punctuation">[</span>mesh<span class="token operator">-&gt;</span>mMaterialIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>    

        <span class="token comment">// 着色器中的采样器命名只能是texture_diffuseN的形式</span>

        <span class="token comment">// 1. diffuse</span>
        vector<span class="token operator">&lt;</span>Texture<span class="token operator">&gt;</span> diffuseMaps <span class="token operator">=</span> <span class="token function">loadMaterialTextures</span><span class="token punctuation">(</span>material<span class="token punctuation">,</span> aiTextureType_DIFFUSE<span class="token punctuation">,</span> <span class="token string">"texture_diffuse"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        textures<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>textures<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> diffuseMaps<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> diffuseMaps<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2. specular</span>
        vector<span class="token operator">&lt;</span>Texture<span class="token operator">&gt;</span> specularMaps <span class="token operator">=</span> <span class="token function">loadMaterialTextures</span><span class="token punctuation">(</span>material<span class="token punctuation">,</span> aiTextureType_SPECULAR<span class="token punctuation">,</span> <span class="token string">"texture_specular"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        textures<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>textures<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> specularMaps<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> specularMaps<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3. normal</span>
        std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Texture<span class="token operator">&gt;</span> normalMaps <span class="token operator">=</span> <span class="token function">loadMaterialTextures</span><span class="token punctuation">(</span>material<span class="token punctuation">,</span> aiTextureType_HEIGHT<span class="token punctuation">,</span> <span class="token string">"texture_normal"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        textures<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>textures<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> normalMaps<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> normalMaps<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4. height</span>
        std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Texture<span class="token operator">&gt;</span> heightMaps <span class="token operator">=</span> <span class="token function">loadMaterialTextures</span><span class="token punctuation">(</span>material<span class="token punctuation">,</span> aiTextureType_AMBIENT<span class="token punctuation">,</span> <span class="token string">"texture_height"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        textures<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>textures<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> heightMaps<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> heightMaps<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword keyword-return">return</span> <span class="token function">Mesh</span><span class="token punctuation">(</span>vertices<span class="token punctuation">,</span> indices<span class="token punctuation">,</span> textures<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    vector<span class="token operator">&lt;</span>Texture<span class="token operator">&gt;</span> <span class="token function">loadMaterialTextures</span><span class="token punctuation">(</span>aiMaterial <span class="token operator">*</span>mat<span class="token punctuation">,</span> aiTextureType type<span class="token punctuation">,</span> string typeName<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        vector<span class="token operator">&lt;</span>Texture<span class="token operator">&gt;</span> textures<span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> mat<span class="token operator">-&gt;</span><span class="token function">GetTextureCount</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            aiString str<span class="token punctuation">;</span>
            mat<span class="token operator">-&gt;</span><span class="token function">GetTexture</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token keyword keyword-bool">bool</span> skip <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> textures_loaded<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">strcmp</span><span class="token punctuation">(</span>textures_loaded<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> str<span class="token punctuation">.</span><span class="token function">C_Str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    textures<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>textures_loaded<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    skip <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> 
                    <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token operator">!</span>skip<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>   
                Texture texture<span class="token punctuation">;</span>
                texture<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token function">TextureFromFile</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">C_Str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword keyword-this">this</span><span class="token operator">-&gt;</span>directory<span class="token punctuation">)</span><span class="token punctuation">;</span>
                texture<span class="token punctuation">.</span>type <span class="token operator">=</span> typeName<span class="token punctuation">;</span>
                texture<span class="token punctuation">.</span>path <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">C_Str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                textures<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>texture<span class="token punctuation">)</span><span class="token punctuation">;</span>
                textures_loaded<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>texture<span class="token punctuation">)</span><span class="token punctuation">;</span>  
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> textures<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> <span class="token function">TextureFromFile</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-char">char</span> <span class="token operator">*</span>path<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> string <span class="token operator">&amp;</span>directory<span class="token punctuation">,</span> <span class="token keyword keyword-bool">bool</span> gamma<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    string filename <span class="token operator">=</span> <span class="token function">string</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
    filename <span class="token operator">=</span> directory <span class="token operator">+</span> <span class="token char">'/'</span> <span class="token operator">+</span> filename<span class="token punctuation">;</span>

    <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> textureID<span class="token punctuation">;</span>
    <span class="token function">glGenTextures</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>textureID<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-int">int</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> nrComponents<span class="token punctuation">;</span>
    <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-char">char</span> <span class="token operator">*</span>data <span class="token operator">=</span> <span class="token function">stbi_load</span><span class="token punctuation">(</span>filename<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>width<span class="token punctuation">,</span> <span class="token operator">&amp;</span>height<span class="token punctuation">,</span> <span class="token operator">&amp;</span>nrComponents<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        GLenum format<span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>nrComponents <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
            format <span class="token operator">=</span> GL_RED<span class="token punctuation">;</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>nrComponents <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span>
            format <span class="token operator">=</span> GL_RGB<span class="token punctuation">;</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>nrComponents <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span>
            format <span class="token operator">=</span> GL_RGBA<span class="token punctuation">;</span>

        <span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> textureID<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glTexImage2D</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> format<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> format<span class="token punctuation">,</span> GL_UNSIGNED_BYTE<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glGenerateMipmap</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_WRAP_S<span class="token punctuation">,</span> GL_REPEAT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_WRAP_T<span class="token punctuation">,</span> GL_REPEAT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_MIN_FILTER<span class="token punctuation">,</span> GL_LINEAR_MIPMAP_LINEAR<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_MAG_FILTER<span class="token punctuation">,</span> GL_LINEAR<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">stbi_image_free</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-else">else</span>
    <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Texture failed to load at path: "</span> <span class="token operator">&lt;&lt;</span> path <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
        <span class="token function">stbi_image_free</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-return">return</span> textureID<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre></details>
<details>
<summary>main.cpp</summary>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;glad/glad.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;GLFW/glfw3.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;glm/glm.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;glm/gtc/matrix_transform.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;glm/gtc/type_ptr.hpp&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;shader.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;camera.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;model.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

<span class="token keyword keyword-void">void</span> <span class="token function">framebuffer_size_callback</span><span class="token punctuation">(</span>GLFWwindow<span class="token operator">*</span> window<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> width<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-void">void</span> <span class="token function">mouse_callback</span><span class="token punctuation">(</span>GLFWwindow<span class="token operator">*</span> window<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> xpos<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> ypos<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-void">void</span> <span class="token function">scroll_callback</span><span class="token punctuation">(</span>GLFWwindow<span class="token operator">*</span> window<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> xoffset<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> yoffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-void">void</span> <span class="token function">processInput</span><span class="token punctuation">(</span>GLFWwindow <span class="token operator">*</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> SCR_WIDTH <span class="token operator">=</span> <span class="token number">800</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> SCR_HEIGHT <span class="token operator">=</span> <span class="token number">600</span><span class="token punctuation">;</span>

Camera <span class="token function">camera</span><span class="token punctuation">(</span>glm<span class="token double-colon punctuation">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">3.0f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-float">float</span> lastX <span class="token operator">=</span> SCR_WIDTH <span class="token operator">/</span> <span class="token number">2.0f</span><span class="token punctuation">;</span>
<span class="token keyword keyword-float">float</span> lastY <span class="token operator">=</span> SCR_HEIGHT <span class="token operator">/</span> <span class="token number">2.0f</span><span class="token punctuation">;</span>
<span class="token keyword keyword-bool">bool</span> firstMouse <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token keyword keyword-float">float</span> deltaTime <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
<span class="token keyword keyword-float">float</span> lastFrame <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// glfw设置</span>
    <span class="token function">glfwInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwWindowHint</span><span class="token punctuation">(</span>GLFW_CONTEXT_VERSION_MAJOR<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwWindowHint</span><span class="token punctuation">(</span>GLFW_CONTEXT_VERSION_MINOR<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwWindowHint</span><span class="token punctuation">(</span>GLFW_OPENGL_PROFILE<span class="token punctuation">,</span> GLFW_OPENGL_CORE_PROFILE<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 窗口设置</span>
    GLFWwindow<span class="token operator">*</span> window <span class="token operator">=</span> <span class="token function">glfwCreateWindow</span><span class="token punctuation">(</span>SCR_WIDTH<span class="token punctuation">,</span> SCR_HEIGHT<span class="token punctuation">,</span> <span class="token string">"Hello model"</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>window <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Failed to create GLFW window"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
        <span class="token function">glfwTerminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 回调设置</span>
    <span class="token function">glfwMakeContextCurrent</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwSetFramebufferSizeCallback</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> framebuffer_size_callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwSetCursorPosCallback</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> mouse_callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwSetScrollCallback</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> scroll_callback<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 鼠标捕获</span>
    <span class="token function">glfwSetInputMode</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> GLFW_CURSOR<span class="token punctuation">,</span> GLFW_CURSOR_DISABLED<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// glad设置</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">gladLoadGLLoader</span><span class="token punctuation">(</span><span class="token punctuation">(</span>GLADloadproc<span class="token punctuation">)</span>glfwGetProcAddress<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Failed to initialize GLAD"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 一般而言，用stb_image.h导入OpenGL处理都要翻转一下</span>
    <span class="token function">stbi_set_flip_vertically_on_load</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 深度测试</span>
    <span class="token function">glEnable</span><span class="token punctuation">(</span>GL_DEPTH_TEST<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 着色器创建</span>
    Shader <span class="token function">ourShader</span><span class="token punctuation">(</span><span class="token string">"../src/model.vs"</span><span class="token punctuation">,</span> <span class="token string">"../src/model.fs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 模型加载</span>
    Model <span class="token function">ourModel</span><span class="token punctuation">(</span><span class="token string">"../resource/backpack/backpack.obj"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 工作目录在build中,../就会回到根目录</span>

    <span class="token comment">// 点光源位置</span>
    glm<span class="token double-colon punctuation">::</span>vec3 pointLightPositions<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        glm<span class="token double-colon punctuation">::</span><span class="token function">vec3</span><span class="token punctuation">(</span> <span class="token number">0.7f</span><span class="token punctuation">,</span>  <span class="token number">0.2f</span><span class="token punctuation">,</span>  <span class="token number">2.0f</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        glm<span class="token double-colon punctuation">::</span><span class="token function">vec3</span><span class="token punctuation">(</span> <span class="token number">2.3f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3.3f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4.0f</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        glm<span class="token double-colon punctuation">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">4.0f</span><span class="token punctuation">,</span>  <span class="token number">2.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">12.0f</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        glm<span class="token double-colon punctuation">::</span><span class="token function">vec3</span><span class="token punctuation">(</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3.0f</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// 渲染循环</span>
    <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">glfwWindowShouldClose</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// deltaTime计算</span>
        <span class="token keyword keyword-float">float</span> currentFrame <span class="token operator">=</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token function">glfwGetTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        deltaTime <span class="token operator">=</span> currentFrame <span class="token operator">-</span> lastFrame<span class="token punctuation">;</span>
        lastFrame <span class="token operator">=</span> currentFrame<span class="token punctuation">;</span>

        <span class="token comment">// 响应键鼠</span>
        <span class="token function">processInput</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 渲染</span>
        <span class="token function">glClearColor</span><span class="token punctuation">(</span><span class="token number">0.05f</span><span class="token punctuation">,</span> <span class="token number">0.05f</span><span class="token punctuation">,</span> <span class="token number">0.05f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glClear</span><span class="token punctuation">(</span>GL_COLOR_BUFFER_BIT <span class="token operator">|</span> GL_DEPTH_BUFFER_BIT<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 启用着色器</span>
        ourShader<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 传入view , proj到着色器</span>
        glm<span class="token double-colon punctuation">::</span>mat4 projection <span class="token operator">=</span> glm<span class="token double-colon punctuation">::</span><span class="token function">perspective</span><span class="token punctuation">(</span>glm<span class="token double-colon punctuation">::</span><span class="token function">radians</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>Zoom<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span>SCR_WIDTH <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span>SCR_HEIGHT<span class="token punctuation">,</span> <span class="token number">0.1f</span><span class="token punctuation">,</span> <span class="token number">100.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        glm<span class="token double-colon punctuation">::</span>mat4 view <span class="token operator">=</span> camera<span class="token punctuation">.</span><span class="token function">GetViewMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setMat4</span><span class="token punctuation">(</span><span class="token string">"projection"</span><span class="token punctuation">,</span> projection<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setMat4</span><span class="token punctuation">(</span><span class="token string">"view"</span><span class="token punctuation">,</span> view<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 光源设置</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token string">"shininess"</span> <span class="token punctuation">,</span> <span class="token number">32.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"viewPos"</span> <span class="token punctuation">,</span> camera<span class="token punctuation">.</span>Position<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 平行光</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"dirLight.direction"</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.2f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.3f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"dirLight.ambient"</span><span class="token punctuation">,</span> <span class="token number">0.05f</span><span class="token punctuation">,</span> <span class="token number">0.05f</span><span class="token punctuation">,</span> <span class="token number">0.05f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"dirLight.diffuse"</span><span class="token punctuation">,</span> <span class="token number">0.4f</span><span class="token punctuation">,</span> <span class="token number">0.4f</span><span class="token punctuation">,</span> <span class="token number">0.4f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"dirLight.specular"</span><span class="token punctuation">,</span> <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token number">0.5f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 点光源</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"pointLights[0].position"</span><span class="token punctuation">,</span> pointLightPositions<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"pointLights[0].ambient"</span><span class="token punctuation">,</span> <span class="token number">0.05f</span><span class="token punctuation">,</span> <span class="token number">0.05f</span><span class="token punctuation">,</span> <span class="token number">0.05f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"pointLights[0].diffuse"</span><span class="token punctuation">,</span> <span class="token number">0.8f</span><span class="token punctuation">,</span> <span class="token number">0.8f</span><span class="token punctuation">,</span> <span class="token number">0.8f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"pointLights[0].specular"</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token string">"pointLights[0].constant"</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token string">"pointLights[0].linear"</span><span class="token punctuation">,</span> <span class="token number">0.09f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token string">"pointLights[0].quadratic"</span><span class="token punctuation">,</span> <span class="token number">0.032f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        ourShader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"pointLights[1].position"</span><span class="token punctuation">,</span> pointLightPositions<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"pointLights[1].ambient"</span><span class="token punctuation">,</span> <span class="token number">0.05f</span><span class="token punctuation">,</span> <span class="token number">0.05f</span><span class="token punctuation">,</span> <span class="token number">0.05f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"pointLights[1].diffuse"</span><span class="token punctuation">,</span> <span class="token number">0.8f</span><span class="token punctuation">,</span> <span class="token number">0.8f</span><span class="token punctuation">,</span> <span class="token number">0.8f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"pointLights[1].specular"</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token string">"pointLights[1].constant"</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token string">"pointLights[1].linear"</span><span class="token punctuation">,</span> <span class="token number">0.09f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token string">"pointLights[1].quadratic"</span><span class="token punctuation">,</span> <span class="token number">0.032f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        ourShader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"pointLights[2].position"</span><span class="token punctuation">,</span> pointLightPositions<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"pointLights[2].ambient"</span><span class="token punctuation">,</span> <span class="token number">0.05f</span><span class="token punctuation">,</span> <span class="token number">0.05f</span><span class="token punctuation">,</span> <span class="token number">0.05f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"pointLights[2].diffuse"</span><span class="token punctuation">,</span> <span class="token number">0.8f</span><span class="token punctuation">,</span> <span class="token number">0.8f</span><span class="token punctuation">,</span> <span class="token number">0.8f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"pointLights[2].specular"</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token string">"pointLights[2].constant"</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token string">"pointLights[2].linear"</span><span class="token punctuation">,</span> <span class="token number">0.09f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token string">"pointLights[2].quadratic"</span><span class="token punctuation">,</span> <span class="token number">0.032f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        ourShader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"pointLights[3].position"</span><span class="token punctuation">,</span> pointLightPositions<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"pointLights[3].ambient"</span><span class="token punctuation">,</span> <span class="token number">0.05f</span><span class="token punctuation">,</span> <span class="token number">0.05f</span><span class="token punctuation">,</span> <span class="token number">0.05f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"pointLights[3].diffuse"</span><span class="token punctuation">,</span> <span class="token number">0.8f</span><span class="token punctuation">,</span> <span class="token number">0.8f</span><span class="token punctuation">,</span> <span class="token number">0.8f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"pointLights[3].specular"</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token string">"pointLights[3].constant"</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token string">"pointLights[3].linear"</span><span class="token punctuation">,</span> <span class="token number">0.09f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token string">"pointLights[3].quadratic"</span><span class="token punctuation">,</span> <span class="token number">0.032f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 手电筒</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"spotLight.position"</span><span class="token punctuation">,</span> camera<span class="token punctuation">.</span>Position<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"spotLight.direction"</span><span class="token punctuation">,</span> camera<span class="token punctuation">.</span>Front<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"spotLight.ambient"</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"spotLight.diffuse"</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setVec3</span><span class="token punctuation">(</span><span class="token string">"spotLight.specular"</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token string">"spotLight.constant"</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token string">"spotLight.linear"</span><span class="token punctuation">,</span> <span class="token number">0.09f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token string">"spotLight.quadratic"</span><span class="token punctuation">,</span> <span class="token number">0.032f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token string">"spotLight.cutOff"</span><span class="token punctuation">,</span> glm<span class="token double-colon punctuation">::</span><span class="token function">cos</span><span class="token punctuation">(</span>glm<span class="token double-colon punctuation">::</span><span class="token function">radians</span><span class="token punctuation">(</span><span class="token number">12.5f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setFloat</span><span class="token punctuation">(</span><span class="token string">"spotLight.outercutOff"</span><span class="token punctuation">,</span> glm<span class="token double-colon punctuation">::</span><span class="token function">cos</span><span class="token punctuation">(</span>glm<span class="token double-colon punctuation">::</span><span class="token function">radians</span><span class="token punctuation">(</span><span class="token number">15.0f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

        <span class="token comment">// 渲染</span>
        glm<span class="token double-colon punctuation">::</span>mat4 model <span class="token operator">=</span> glm<span class="token double-colon punctuation">::</span><span class="token function">mat4</span><span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 可以进行位移和缩放</span>
        model <span class="token operator">=</span> glm<span class="token double-colon punctuation">::</span><span class="token function">translate</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> glm<span class="token double-colon punctuation">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        model <span class="token operator">=</span> glm<span class="token double-colon punctuation">::</span><span class="token function">scale</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> glm<span class="token double-colon punctuation">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
        ourShader<span class="token punctuation">.</span><span class="token function">setMat4</span><span class="token punctuation">(</span><span class="token string">"model"</span><span class="token punctuation">,</span> model<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourShader<span class="token punctuation">.</span><span class="token function">setMat3</span><span class="token punctuation">(</span><span class="token string">"Nmodel"</span><span class="token punctuation">,</span> glm<span class="token double-colon punctuation">::</span><span class="token function">mat3</span><span class="token punctuation">(</span><span class="token function">transpose</span><span class="token punctuation">(</span><span class="token function">inverse</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ourModel<span class="token punctuation">.</span><span class="token function">Draw</span><span class="token punctuation">(</span>ourShader<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">glfwSwapBuffers</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glfwPollEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">glfwTerminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 回调函数</span>
<span class="token keyword keyword-void">void</span> <span class="token function">processInput</span><span class="token punctuation">(</span>GLFWwindow <span class="token operator">*</span>window<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">glfwGetKey</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> GLFW_KEY_ESCAPE<span class="token punctuation">)</span> <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span>
        <span class="token function">glfwSetWindowShouldClose</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">glfwGetKey</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> GLFW_KEY_W<span class="token punctuation">)</span> <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span>
        camera<span class="token punctuation">.</span><span class="token function">ProcessKeyboard</span><span class="token punctuation">(</span>FORWARD<span class="token punctuation">,</span> deltaTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">glfwGetKey</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> GLFW_KEY_S<span class="token punctuation">)</span> <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span>
        camera<span class="token punctuation">.</span><span class="token function">ProcessKeyboard</span><span class="token punctuation">(</span>BACKWARD<span class="token punctuation">,</span> deltaTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">glfwGetKey</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> GLFW_KEY_A<span class="token punctuation">)</span> <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span>
        camera<span class="token punctuation">.</span><span class="token function">ProcessKeyboard</span><span class="token punctuation">(</span>LEFT<span class="token punctuation">,</span> deltaTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">glfwGetKey</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> GLFW_KEY_D<span class="token punctuation">)</span> <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span>
        camera<span class="token punctuation">.</span><span class="token function">ProcessKeyboard</span><span class="token punctuation">(</span>RIGHT<span class="token punctuation">,</span> deltaTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">framebuffer_size_callback</span><span class="token punctuation">(</span>GLFWwindow<span class="token operator">*</span> window<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> width<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> height<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">glViewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">mouse_callback</span><span class="token punctuation">(</span>GLFWwindow<span class="token operator">*</span> window<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> xposIn<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> yposIn<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-float">float</span> xpos <span class="token operator">=</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>xposIn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> ypos <span class="token operator">=</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>yposIn<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>firstMouse<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        lastX <span class="token operator">=</span> xpos<span class="token punctuation">;</span>
        lastY <span class="token operator">=</span> ypos<span class="token punctuation">;</span>
        firstMouse <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-float">float</span> xoffset <span class="token operator">=</span> xpos <span class="token operator">-</span> lastX<span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> yoffset <span class="token operator">=</span> lastY <span class="token operator">-</span> ypos<span class="token punctuation">;</span> 

    lastX <span class="token operator">=</span> xpos<span class="token punctuation">;</span>
    lastY <span class="token operator">=</span> ypos<span class="token punctuation">;</span>

    camera<span class="token punctuation">.</span><span class="token function">ProcessMouseMovement</span><span class="token punctuation">(</span>xoffset<span class="token punctuation">,</span> yoffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">scroll_callback</span><span class="token punctuation">(</span>GLFWwindow<span class="token operator">*</span> window<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> xoffset<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> yoffset<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    camera<span class="token punctuation">.</span><span class="token function">ProcessMouseScroll</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>yoffset<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></details>
<details>
<summary>model.vs</summary>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">330</span> core</span></span>
<span class="token function">layout</span> <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> in vec3 aPos<span class="token punctuation">;</span>
<span class="token function">layout</span> <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> in vec3 aNormal<span class="token punctuation">;</span>
<span class="token function">layout</span> <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span> in vec2 aTexCoords<span class="token punctuation">;</span>

out vec2 TexCoords<span class="token punctuation">;</span>
out vec3 Normal<span class="token punctuation">;</span>
out vec3 FragPos<span class="token punctuation">;</span>

uniform mat3 Nmodel<span class="token punctuation">;</span>

uniform mat4 model<span class="token punctuation">;</span>
uniform mat4 view<span class="token punctuation">;</span>
uniform mat4 projection<span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>   
    FragPos <span class="token operator">=</span> <span class="token function">vec3</span><span class="token punctuation">(</span>model <span class="token operator">*</span> <span class="token function">vec4</span><span class="token punctuation">(</span>aPos<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    TexCoords <span class="token operator">=</span> aTexCoords<span class="token punctuation">;</span>
    Normal <span class="token operator">=</span> Nmodel <span class="token operator">*</span> aNormal<span class="token punctuation">;</span>    
    gl_Position <span class="token operator">=</span> projection <span class="token operator">*</span> view <span class="token operator">*</span> <span class="token function">vec4</span><span class="token punctuation">(</span>FragPos<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></details>
<details>
<summary>model.fs</summary>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">330</span> core</span></span>
out vec4 FragColor<span class="token punctuation">;</span>

uniform sampler2D diffuse1<span class="token punctuation">;</span>
uniform sampler2D specular1<span class="token punctuation">;</span>
uniform <span class="token keyword keyword-float">float</span> shininess<span class="token punctuation">;</span>

<span class="token comment">// 平行光</span>
<span class="token keyword keyword-struct">struct</span> <span class="token class-name">DirLight</span> <span class="token punctuation">{</span>
    vec3 direction<span class="token punctuation">;</span>
	
    vec3 ambient<span class="token punctuation">;</span>
    vec3 diffuse<span class="token punctuation">;</span>
    vec3 specular<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 点光源</span>
<span class="token keyword keyword-struct">struct</span> <span class="token class-name">PointLight</span> <span class="token punctuation">{</span>
    vec3 position<span class="token punctuation">;</span>
    
    <span class="token keyword keyword-float">float</span> constant<span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> linear<span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> quadratic<span class="token punctuation">;</span>
	
    vec3 ambient<span class="token punctuation">;</span>
    vec3 diffuse<span class="token punctuation">;</span>
    vec3 specular<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 汇聚光</span>
<span class="token keyword keyword-struct">struct</span> <span class="token class-name">SpotLight</span> <span class="token punctuation">{</span>
    vec3 position<span class="token punctuation">;</span>
    vec3 direction<span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> cutOff<span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> outercutOff<span class="token punctuation">;</span>
  
    <span class="token keyword keyword-float">float</span> constant<span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> linear<span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> quadratic<span class="token punctuation">;</span>
  
    vec3 ambient<span class="token punctuation">;</span>
    vec3 diffuse<span class="token punctuation">;</span>
    vec3 specular<span class="token punctuation">;</span>       
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">NR_POINT_LIGHTS</span> <span class="token expression"><span class="token number">2</span></span></span>

in vec3 FragPos<span class="token punctuation">;</span>
in vec3 Normal<span class="token punctuation">;</span>
in vec2 TexCoords<span class="token punctuation">;</span>

uniform vec3 viewPos<span class="token punctuation">;</span>
uniform DirLight dirLight<span class="token punctuation">;</span>
uniform PointLight pointLights<span class="token punctuation">[</span>NR_POINT_LIGHTS<span class="token punctuation">]</span><span class="token punctuation">;</span>
uniform SpotLight spotLight<span class="token punctuation">;</span>

<span class="token comment">// 计算光照贡献的函数</span>
vec3 <span class="token function">CalcDirLight</span><span class="token punctuation">(</span>DirLight light<span class="token punctuation">,</span> vec3 normal<span class="token punctuation">,</span> vec3 viewDir<span class="token punctuation">)</span><span class="token punctuation">;</span>
vec3 <span class="token function">CalcPointLight</span><span class="token punctuation">(</span>PointLight light<span class="token punctuation">,</span> vec3 normal<span class="token punctuation">,</span> vec3 fragPos<span class="token punctuation">,</span> vec3 viewDir<span class="token punctuation">)</span><span class="token punctuation">;</span>
vec3 <span class="token function">CalcSpotLight</span><span class="token punctuation">(</span>SpotLight light<span class="token punctuation">,</span> vec3 normal<span class="token punctuation">,</span> vec3 fragPos<span class="token punctuation">,</span> vec3 viewDir<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>    
    vec3 norm <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>Normal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    vec3 viewDir <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>viewPos <span class="token operator">-</span> FragPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 平行光贡献</span>
    vec3 result <span class="token operator">=</span> <span class="token function">CalcDirLight</span><span class="token punctuation">(</span>dirLight<span class="token punctuation">,</span> norm<span class="token punctuation">,</span> viewDir<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// vec3 result = vec3(0.0);</span>
    
    <span class="token comment">// 点光源贡献</span>
    <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> NR_POINT_LIGHTS<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        result <span class="token operator">+=</span> <span class="token function">CalcPointLight</span><span class="token punctuation">(</span>pointLights<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> norm<span class="token punctuation">,</span> FragPos<span class="token punctuation">,</span> viewDir<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    
    <span class="token comment">// 汇聚光（手电筒）贡献</span>
    result <span class="token operator">+=</span> <span class="token function">CalcSpotLight</span><span class="token punctuation">(</span>spotLight<span class="token punctuation">,</span> norm<span class="token punctuation">,</span> FragPos<span class="token punctuation">,</span> viewDir<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    
    FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


vec3 <span class="token function">CalcDirLight</span><span class="token punctuation">(</span>DirLight light<span class="token punctuation">,</span> vec3 normal<span class="token punctuation">,</span> vec3 viewDir<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    vec3 lightDir <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span><span class="token operator">-</span>light<span class="token punctuation">.</span>direction<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword keyword-float">float</span> diff <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span> lightDir<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    vec3 reflectDir <span class="token operator">=</span> <span class="token function">reflect</span><span class="token punctuation">(</span><span class="token operator">-</span>lightDir<span class="token punctuation">,</span> normal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> spec <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>viewDir<span class="token punctuation">,</span> reflectDir<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> shininess<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    vec3 ambient <span class="token operator">=</span> light<span class="token punctuation">.</span>ambient <span class="token operator">*</span> <span class="token function">vec3</span><span class="token punctuation">(</span><span class="token function">texture</span><span class="token punctuation">(</span>diffuse1<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vec3 diffuse <span class="token operator">=</span> light<span class="token punctuation">.</span>diffuse <span class="token operator">*</span> diff <span class="token operator">*</span> <span class="token function">vec3</span><span class="token punctuation">(</span><span class="token function">texture</span><span class="token punctuation">(</span>diffuse1<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vec3 specular <span class="token operator">=</span> light<span class="token punctuation">.</span>specular <span class="token operator">*</span> spec <span class="token operator">*</span> <span class="token function">vec3</span><span class="token punctuation">(</span><span class="token function">texture</span><span class="token punctuation">(</span>specular1<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>ambient <span class="token operator">+</span> diffuse <span class="token operator">+</span> specular<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


vec3 <span class="token function">CalcPointLight</span><span class="token punctuation">(</span>PointLight light<span class="token punctuation">,</span> vec3 normal<span class="token punctuation">,</span> vec3 fragPos<span class="token punctuation">,</span> vec3 viewDir<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    vec3 lightDir <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>light<span class="token punctuation">.</span>position <span class="token operator">-</span> fragPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword keyword-float">float</span> diff <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span> lightDir<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    vec3 reflectDir <span class="token operator">=</span> <span class="token function">reflect</span><span class="token punctuation">(</span><span class="token operator">-</span>lightDir<span class="token punctuation">,</span> normal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> spec <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>viewDir<span class="token punctuation">,</span> reflectDir<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> shininess<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword keyword-float">float</span> distance <span class="token operator">=</span> <span class="token function">length</span><span class="token punctuation">(</span>light<span class="token punctuation">.</span>position <span class="token operator">-</span> fragPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> attenuation <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">/</span> <span class="token punctuation">(</span>light<span class="token punctuation">.</span>constant <span class="token operator">+</span> light<span class="token punctuation">.</span>linear <span class="token operator">*</span> distance <span class="token operator">+</span> light<span class="token punctuation">.</span>quadratic <span class="token operator">*</span> <span class="token punctuation">(</span>distance <span class="token operator">*</span> distance<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    
    vec3 ambient <span class="token operator">=</span> light<span class="token punctuation">.</span>ambient <span class="token operator">*</span> <span class="token function">vec3</span><span class="token punctuation">(</span><span class="token function">texture</span><span class="token punctuation">(</span>diffuse1<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vec3 diffuse <span class="token operator">=</span> light<span class="token punctuation">.</span>diffuse <span class="token operator">*</span> diff <span class="token operator">*</span> <span class="token function">vec3</span><span class="token punctuation">(</span><span class="token function">texture</span><span class="token punctuation">(</span>diffuse1<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vec3 specular <span class="token operator">=</span> light<span class="token punctuation">.</span>specular <span class="token operator">*</span> spec <span class="token operator">*</span> <span class="token function">vec3</span><span class="token punctuation">(</span><span class="token function">texture</span><span class="token punctuation">(</span>specular1<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ambient <span class="token operator">*=</span> attenuation<span class="token punctuation">;</span>
    diffuse <span class="token operator">*=</span> attenuation<span class="token punctuation">;</span>
    specular <span class="token operator">*=</span> attenuation<span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>ambient <span class="token operator">+</span> diffuse <span class="token operator">+</span> specular<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


vec3 <span class="token function">CalcSpotLight</span><span class="token punctuation">(</span>SpotLight light<span class="token punctuation">,</span> vec3 normal<span class="token punctuation">,</span> vec3 fragPos<span class="token punctuation">,</span> vec3 viewDir<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    vec3 lightDir <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>light<span class="token punctuation">.</span>position <span class="token operator">-</span> fragPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword keyword-float">float</span> diff <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span> lightDir<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    vec3 reflectDir <span class="token operator">=</span> <span class="token function">reflect</span><span class="token punctuation">(</span><span class="token operator">-</span>lightDir<span class="token punctuation">,</span> normal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> spec <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>viewDir<span class="token punctuation">,</span> reflectDir<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> shininess<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword keyword-float">float</span> distance <span class="token operator">=</span> <span class="token function">length</span><span class="token punctuation">(</span>light<span class="token punctuation">.</span>position <span class="token operator">-</span> fragPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> attenuation <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">/</span> <span class="token punctuation">(</span>light<span class="token punctuation">.</span>constant <span class="token operator">+</span> light<span class="token punctuation">.</span>linear <span class="token operator">*</span> distance <span class="token operator">+</span> light<span class="token punctuation">.</span>quadratic <span class="token operator">*</span> <span class="token punctuation">(</span>distance <span class="token operator">*</span> distance<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    
    <span class="token keyword keyword-float">float</span> theta <span class="token operator">=</span> <span class="token function">dot</span><span class="token punctuation">(</span>lightDir<span class="token punctuation">,</span> <span class="token function">normalize</span><span class="token punctuation">(</span><span class="token operator">-</span>light<span class="token punctuation">.</span>direction<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword keyword-float">float</span> epsilon <span class="token operator">=</span> light<span class="token punctuation">.</span>cutOff <span class="token operator">-</span> light<span class="token punctuation">.</span>outercutOff<span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> intensity <span class="token operator">=</span> <span class="token function">clamp</span><span class="token punctuation">(</span><span class="token punctuation">(</span>theta <span class="token operator">-</span> light<span class="token punctuation">.</span>outercutOff<span class="token punctuation">)</span> <span class="token operator">/</span> epsilon<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    vec3 ambient <span class="token operator">=</span> light<span class="token punctuation">.</span>ambient <span class="token operator">*</span> <span class="token function">vec3</span><span class="token punctuation">(</span><span class="token function">texture</span><span class="token punctuation">(</span>diffuse1<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vec3 diffuse <span class="token operator">=</span> light<span class="token punctuation">.</span>diffuse <span class="token operator">*</span> diff <span class="token operator">*</span> <span class="token function">vec3</span><span class="token punctuation">(</span><span class="token function">texture</span><span class="token punctuation">(</span>diffuse1<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vec3 specular <span class="token operator">=</span> light<span class="token punctuation">.</span>specular <span class="token operator">*</span> spec <span class="token operator">*</span> <span class="token function">vec3</span><span class="token punctuation">(</span><span class="token function">texture</span><span class="token punctuation">(</span>specular1<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ambient <span class="token operator">*=</span> attenuation <span class="token operator">*</span> intensity<span class="token punctuation">;</span>
    diffuse <span class="token operator">*=</span> attenuation <span class="token operator">*</span> intensity<span class="token punctuation">;</span>
    specular <span class="token operator">*=</span> attenuation <span class="token operator">*</span> intensity<span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>ambient <span class="token operator">+</span> diffuse <span class="token operator">+</span> specular<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></details>
<p>效果如下所示：<br>
<video src="..\assets\images\learning opengl\model.mp4" controls="" width="800" height="450"><br>
您的浏览器不支持video标签，请更新浏览器。 <!-- 浏览器不兼容时的提示文字 --><br>
</video></p>
<h1 id="高级opengl">高级OpenGL </h1>
<h2 id="深度测试">深度测试 </h2>
<p>深度测试需要维护一个深度缓冲数组，也就是为屏幕空间每个像素存储一个深度值；<br>
对于每个片段，他都有一个对应的深度(来自顶点着色器)；<br>
如果当前片段的深度能够通过深度测试，即在当前屏幕像素的前面，能被看到；<br>
则更新当前像素的颜色，并把深度缓冲更新为当前片段的深度；</p>
<p>因此我们需要在渲染循环前开启深度测试：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token function">glEnable</span><span class="token punctuation">(</span>GL_DEPTH_TEST<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>在每次渲染循环中，先清楚上一次渲染的深度值：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token function">glClear</span><span class="token punctuation">(</span>GL_COLOR_BUFFER_BIT <span class="token operator">|</span> GL_DEPTH_BUFFER_BIT<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>有些时候深度缓冲是只读的，即只比较，但不更新：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token function">glDepthMask</span><span class="token punctuation">(</span>GL_FALSE<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>这个主要用在画半透明物体的时候，比如烟雾等；<br>
先画后方的不透明物体，再画前方的烟雾；<br>
此时烟雾可以呈现在屏幕上，同时不影响深度值，也就是说挡不住在它之后的物体，但可以被在烟雾之前的物体挡住；</p>
<p>深度测试通过一般是小于当前深度缓冲则通过；<br>
但是也可以进行修改，不过不太知道这有什么用；</p>
<p>注意到深度值并不是正比于真实的深度(也就是离相机的距离z)；<br>
而是正比于<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>−</mo><mfrac><mi>B</mi><mi>z</mi></mfrac></mrow><annotation encoding="application/x-tex">A - \frac{B}{z}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.2173em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.04398em;">z</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>；<br>
单调性同样是保证的，关键在于非线性；</p>
<p>这里用非线性函数的主要原因在于精度，也就是我们计算的真实深度z可能不准确；<br>
因此需要对近处和远处的物体的深度精度进行保证；<br>
距离而言，离你很近的水杯的正面和侧面的深度差异影响远远大于离你很远的群山的前后关系；</p>
<p>深度冲突：<br>
当两个物体的靠的很近，深度值接近，会在每一帧不断竞争哪个在前，哪个在后；<br>
避免的方式是首先不要安排太过接近的物体；<br>
其次，让近平面远一些，因为靠近近平面的深度精度高；<br>
再者，把深度缓冲的精度从默认的24位提升到32位；</p>
<h2 id="模板测试">模板测试 </h2>
<p>模板测试可以理解为在最终要画的屏幕上蒙了一层滤光片，具体的效果如下：<br>
<img src="..\assets\images\learning opengl\image-16.png" alt="alt text"><br>
模板缓冲是一个8位数；</p>
<p>调用模板测试的代码如下：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token function">glEnable</span><span class="token punctuation">(</span>GL_STENCIL_TEST<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glClear</span><span class="token punctuation">(</span>GL_COLOR_BUFFER_BIT <span class="token operator">|</span> GL_DEPTH_BUFFER_BIT <span class="token operator">|</span> GL_STENCIL_BUFFER_BIT<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 是否写入通过掩码控制</span>
<span class="token comment">// 每一位在写入之前先和掩码做与运算</span>

<span class="token function">glStencilMask</span><span class="token punctuation">(</span><span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 完全写入</span>
<span class="token function">glStencilMask</span><span class="token punctuation">(</span><span class="token number">0x00</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//（禁用写入）</span>
</code></pre><p>调整模板测试用一下函数：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">// 只在等于1的时候通过测试，且不写入</span>
<span class="token function">glStencilFunc</span><span class="token punctuation">(</span>GL_EQUAL<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 三个参数分别表示</span>
<span class="token comment">// 模板测试失败；模板测试通过，深度测试失败；都通过时对于缓冲的更新情况</span>
<span class="token comment">// 默认不更新，即GL_KEEP</span>
<span class="token comment">// 更新可以使用GL_REPLACE</span>
<span class="token function">glStencilOp</span><span class="token punctuation">(</span>GLenum sfail<span class="token punctuation">,</span> GLenum dpfail<span class="token punctuation">,</span> GLenum dppass<span class="token punctuation">)</span>
</code></pre><p>不过上面提到的模板测试听起来好像没什么用；<br>
一个有用的例子是，为选中物体绘制边框；</p>
<p>流程如下：<br>
绘制两遍，第一遍时启用模板写入，对于渲染的片段，模板缓冲更新为1；<br>
然后禁用模板写入和深度测试，进行第二次绘制；<br>
第二次绘制用的是边框的片段着色器，同时它负责画的是略大一圈的物体；<br>
只有当模板值不为1时才能通过模板测试，也就是只能画外围的那一圈(其他地方都没有片段);<br>
最后在恢复模板写入和深度测试；</p>
<p>总而言之，模板缓冲提供了一种后处理的可能；</p>
<h2 id="混合">混合 </h2>
<h3 id="透明度">透明度 </h3>
<p>物体的透明度由颜色的第四个分量alpha来决定；<br>
如果透明度为1.0，则最终颜色全部为设定的物体本身颜色；<br>
如果透明度为0.5，则最终颜色只有一半来自物体本身，剩下一半来自背后物体的颜色；</p>
<h3 id="丢弃片段">丢弃片段 </h3>
<p>我们有时想画一些复杂的图案，但是没有模型，只有一个贴图；<br>
幸运的是，这个贴图有透明度通道，即主体部分完全不透明，其余部分完全透明；<br>
比如说这张草的照片：<br>
<img src="..\assets\images\learning opengl\image-17.png" alt="alt text"></p>
<p>此时我们想画出草就变得简单了；<br>
我们只需要画一个矩形，这个矩形本来应该是这张草的图片；<br>
但是我们可以在片段着色器中进行判断，当透明度为0时，就丢弃这个片段；<br>
具体的片段着色器如下：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">330</span> core</span></span>
out vec4 FragColor<span class="token punctuation">;</span>

in vec2 TexCoords<span class="token punctuation">;</span>

uniform sampler2D texture1<span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>             
    vec4 texColor <span class="token operator">=</span> <span class="token function">texture</span><span class="token punctuation">(</span>texture1<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>texColor<span class="token punctuation">.</span>a <span class="token operator">&lt;</span> <span class="token number">0.1</span><span class="token punctuation">)</span>
        discard<span class="token punctuation">;</span>
    FragColor <span class="token operator">=</span> texColor<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>需要注意几点：<br>
上载图片至纹理时，需要使用RGBA模式；<br>
纹理环绕方式设置为GL_CLAMP_TO_EDGE，否则下方的绿色边可能出现到上方去；</p>
<h3 id="半透明">半透明 </h3>
<p>OpenGL允许通过GL_BEND进行混合；<br>
混合的原理大致是，想把一个RGBA放在一个已经存储到颜色缓冲的R'G'B'A'上；</p>
<p>最后得到的结果为：<br>
(R * A + R' * (1 - A) , G * A + G' * (1 - A) , G * A + G' * (1 - A) , A)；</p>
<p>代码上，用这两条命令实现：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token function">glEnable</span><span class="token punctuation">(</span>GL_BLEND<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 默认透明度为A</span>
<span class="token function">glBlendFunc</span><span class="token punctuation">(</span>GL_SRC_ALPHA<span class="token punctuation">,</span> GL_ONE_MINUS_SRC_ALPHA<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 后两个参数控制最终透明度的权重</span>
<span class="token function">glBlendFuncSeparate</span><span class="token punctuation">(</span>GL_SRC_ALPHA<span class="token punctuation">,</span> GL_ONE_MINUS_SRC_ALPHA<span class="token punctuation">,</span> GL_ONE<span class="token punctuation">,</span> GL_ZERO<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>混合模式甚至可以减，或者取最大最小值等，不过个人感觉没什么用；</p>
<h3 id="半透明纹理">半透明纹理 </h3>
<p>启用混合，再使用如下带透明度的纹理，就能够获得想要的半透明效果：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">330</span> core</span></span>
out vec4 FragColor<span class="token punctuation">;</span>

in vec2 TexCoords<span class="token punctuation">;</span>

uniform sampler2D texture1<span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>             
    FragColor <span class="token operator">=</span> <span class="token function">texture</span><span class="token punctuation">(</span>texture1<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 启用纹理</span>
<span class="token function">glEnable</span><span class="token punctuation">(</span>GL_BLEND<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBlendFunc</span><span class="token punctuation">(</span>GL_SRC_ALPHA<span class="token punctuation">,</span> GL_ONE_MINUS_SRC_ALPHA<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>这样的话，每一次渲染片段，都会按照混合的方式更新颜色缓冲；</p>
<p>但是这里会和深度测试有一些冲突：<br>
比如说先画透明物，再画背后的物体；<br>
深度测试直接导致背后的物体画不上，都轮不到混合处理；</p>
<p>但是如果先画背后的物体，再画透明物；<br>
能画上透明物，并且透明物还会以透明的方式画上去；</p>
<p>这个问题在透明物之后还有透明物时更严重</p>
<p>实际上，Blend的绘制方式，本身就要求要在绘制好后方物体后，再绘制透明物，因此对于有透明物体的场景，绘制顺序是重要的，不能紧紧依靠深度测试解决；<br>
原则上，我们应该：<br>
先绘制不透明物体；<br>
从远至近绘制透明物体；</p>
<h2 id="面剔除">面剔除 </h2>
<p>想象画一个正方体，虽然有六个面，但是实际最多只能看见三个面；<br>
因此渲染6个面再进行深度测试的方法显得很浪费，因为片段着色器是相当耗费时间的；<br>
OpenGL中，使用如下方式可以在进入到片段着色器之前，就能预先知道哪些面看不到；</p>
<p><img src="..\assets\images\learning opengl\image-18.png" alt="alt text"><br>
定义顶点时，我们需要确保三角形的三个顶点的顺序，在能被看到时，是以逆时针排列的；</p>
<p>如上图，眼睛在右侧，右侧面三个顶点123为逆时针，但左侧面123逆时针，所以看不到；<br>
眼睛在左侧，左侧面123为逆时针可以看到，右侧面123为顺时针看不到；</p>
<p>代码实现非常简单，OpenGL为我们完成了所有工作：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token function">glEnable</span><span class="token punctuation">(</span>GL_CULL_FACE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 剔除背面</span>
<span class="token function">glCullFace</span><span class="token punctuation">(</span>GL_BACK<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 正面是逆时针顺序</span>
<span class="token function">glFrontFace</span><span class="token punctuation">(</span>GL_CCW<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h2 id="帧缓冲">帧缓冲 </h2>
<h3 id="创建帧缓冲">创建帧缓冲 </h3>
<p>我们可以认为所有之前的缓冲(颜色、深度等)最终都需要放在一个帧缓冲FBO中，可以把它想象成一个画布；<br>
之前我们的帧缓冲是有glfw帮我们创建的，也就是看到的屏幕窗口；</p>
<p>现在我们打算不直接把画画到屏幕上，而是画在自己定义的画布上；<br>
当然当我们把画布画好之后，还是需要最终画到屏幕上；<br>
代码体现如下：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> fbo<span class="token punctuation">;</span>
<span class="token function">glGenFramebuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>fbo<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">glBindFramebuffer</span><span class="token punctuation">(</span>GL_FRAMEBUFFER<span class="token punctuation">,</span> fbo<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 帧缓冲完整检查</span>
<span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token function">glCheckFramebufferStatus</span><span class="token punctuation">(</span>GL_FRAMEBUFFER<span class="token punctuation">)</span> <span class="token operator">==</span> GL_FRAMEBUFFER_COMPLETE<span class="token punctuation">)</span>

<span class="token comment">// 重新绑定为屏幕</span>
<span class="token function">glBindFramebuffer</span><span class="token punctuation">(</span>GL_FRAMEBUFFER<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 删除帧缓冲对象</span>
<span class="token function">glDeleteFramebuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>fbo<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="纹理附件">纹理附件 </h3>
<p>现在解释一下什么叫做渲染到画布上，即写入帧缓冲；<br>
实际上，就是把渲染的结果变成一张纹理图，然后把这张纹理图附加到帧缓冲上即可；<br>
使用纹理的好处是，后续想要使用这张画布的结果时，可以直接用调用纹理的方式进行；</p>
<p>注意，将颜色缓冲存成纹理是比较好理解的，但是实际上，深度、模板缓冲都能写成纹理，甚至还能把多个缓冲存成纹理；</p>
<p>具体的代码如下：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">// 创建纹理</span>
<span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> texture<span class="token punctuation">;</span>
<span class="token function">glGenTextures</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>texture<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> texture<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 颜色纹理</span>
<span class="token function">glTexImage2D</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GL_RGB<span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GL_RGB<span class="token punctuation">,</span> GL_UNSIGNED_BYTE<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_MIN_FILTER<span class="token punctuation">,</span> GL_LINEAR<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_MAG_FILTER<span class="token punctuation">,</span> GL_LINEAR<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 附加到帧缓冲上</span>
<span class="token function">glFramebufferTexture2D</span><span class="token punctuation">(</span>GL_FRAMEBUFFER<span class="token punctuation">,</span> GL_COLOR_ATTACHMENT0<span class="token punctuation">,</span> GL_TEXTURE_2D<span class="token punctuation">,</span> texture<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 把深度和模板缓冲整合到一张纹理上</span>
<span class="token function">glTexImage2D</span><span class="token punctuation">(</span>
  GL_TEXTURE_2D<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GL_DEPTH24_STENCIL8<span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> 
  GL_DEPTH_STENCIL<span class="token punctuation">,</span> GL_UNSIGNED_INT_24_8<span class="token punctuation">,</span> <span class="token constant">NULL</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">glFramebufferTexture2D</span><span class="token punctuation">(</span>GL_FRAMEBUFFER<span class="token punctuation">,</span> GL_DEPTH_STENCIL_ATTACHMENT<span class="token punctuation">,</span> GL_TEXTURE_2D<span class="token punctuation">,</span> texture<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="rbo附件">RBO附件 </h3>
<p>存成纹理，并成为帧缓冲附件是一种“画到画布”上的方式；<br>
但实际上可以更快，这种方式把渲染得到的缓冲存为RBO；</p>
<p>可以这么理解，着色器中我们能访问到纹理，并进行相应的操作；<br>
但是深度缓冲、模板缓冲在整个渲染环节实际上都是不可被访问的，整个过程在OpenGL内部完成；<br>
这种原生形式的数据通常处理起来更快，但缺点是不能对它进行操作；<br>
因此，通常会把深度和模板缓冲给填到RBO中，而不是像颜色缓冲那样写到一张纹理图中；</p>
<p>代码实现如下：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> rbo<span class="token punctuation">;</span>
<span class="token function">glGenRenderbuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>rbo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glRenderbufferStorage</span><span class="token punctuation">(</span>GL_RENDERBUFFER<span class="token punctuation">,</span> GL_DEPTH24_STENCIL8<span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glFramebufferRenderbuffer</span><span class="token punctuation">(</span>GL_FRAMEBUFFER<span class="token punctuation">,</span> GL_DEPTH_STENCIL_ATTACHMENT<span class="token punctuation">,</span> GL_RENDERBUFFER<span class="token punctuation">,</span> rbo<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>总而言之，RBO是可写不可读的，也就是内部操作过程；<br>
通常把深度和模板缓冲写入其中；</p>
<h3 id="渲染到画布">渲染到画布 </h3>
<p>现在来完整看一看把渲染结果先画到画布上，再画到屏幕上的过程；<br>
总的来说，分成两个大部分：</p>
<p>第一步是进行原先的渲染流程，只不过最终的结果写入到帧缓冲，而非默认的屏幕帧缓冲中；<br>
这里的结果，包括颜色缓冲写到帧缓冲的纹理附件上；<br>
也包括深度缓冲和模板缓冲写到帧缓冲的RBO附件上；</p>
<p>第二步，就是绘制一个窗口屏幕大小的矩形，这个矩形上的贴图是上面的帧缓冲中的纹理附件；</p>
<p>代码如下所示：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">// 创建帧缓冲对象，并添加纹理附件和RBO附件</span>
<span class="token comment">// -------------------------------------------</span>
<span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> framebuffer<span class="token punctuation">;</span>
<span class="token function">glGenFramebuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>framebuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBindFramebuffer</span><span class="token punctuation">(</span>GL_FRAMEBUFFER<span class="token punctuation">,</span> framebuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 生成纹理</span>
<span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> texColorBuffer<span class="token punctuation">;</span>
<span class="token function">glGenTextures</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>texColorBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> texColorBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glTexImage2D</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GL_RGB<span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GL_RGB<span class="token punctuation">,</span> GL_UNSIGNED_BYTE<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_MIN_FILTER<span class="token punctuation">,</span> GL_LINEAR <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_MAG_FILTER<span class="token punctuation">,</span> GL_LINEAR<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 将它附加到当前绑定的帧缓冲对象</span>
<span class="token function">glFramebufferTexture2D</span><span class="token punctuation">(</span>GL_FRAMEBUFFER<span class="token punctuation">,</span> GL_COLOR_ATTACHMENT0<span class="token punctuation">,</span> GL_TEXTURE_2D<span class="token punctuation">,</span> texColorBuffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  

<span class="token comment">// 生成rbo</span>
<span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> rbo<span class="token punctuation">;</span>
<span class="token function">glGenRenderbuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>rbo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBindRenderbuffer</span><span class="token punctuation">(</span>GL_RENDERBUFFER<span class="token punctuation">,</span> rbo<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">glRenderbufferStorage</span><span class="token punctuation">(</span>GL_RENDERBUFFER<span class="token punctuation">,</span> GL_DEPTH24_STENCIL8<span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token function">glBindRenderbuffer</span><span class="token punctuation">(</span>GL_RENDERBUFFER<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 将它附加到当前绑定的帧缓冲对象</span>
<span class="token function">glFramebufferRenderbuffer</span><span class="token punctuation">(</span>GL_FRAMEBUFFER<span class="token punctuation">,</span> GL_DEPTH_STENCIL_ATTACHMENT<span class="token punctuation">,</span> GL_RENDERBUFFER<span class="token punctuation">,</span> rbo<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token function">glCheckFramebufferStatus</span><span class="token punctuation">(</span>GL_FRAMEBUFFER<span class="token punctuation">)</span> <span class="token operator">!=</span> GL_FRAMEBUFFER_COMPLETE<span class="token punctuation">)</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"ERROR::FRAMEBUFFER:: Framebuffer is not complete!"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
<span class="token function">glBindFramebuffer</span><span class="token punctuation">(</span>GL_FRAMEBUFFER<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 渲染环节：先画到帧缓冲，再画到屏幕</span>
<span class="token comment">// ----------------------------------------</span>
<span class="token comment">// 画到帧缓冲</span>
<span class="token function">glBindFramebuffer</span><span class="token punctuation">(</span>GL_FRAMEBUFFER<span class="token punctuation">,</span> framebuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glClearColor</span><span class="token punctuation">(</span><span class="token number">0.1f</span><span class="token punctuation">,</span> <span class="token number">0.1f</span><span class="token punctuation">,</span> <span class="token number">0.1f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glClear</span><span class="token punctuation">(</span>GL_COLOR_BUFFER_BIT <span class="token operator">|</span> GL_DEPTH_BUFFER_BIT<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 我们现在不使用模板缓冲</span>
<span class="token function">glEnable</span><span class="token punctuation">(</span>GL_DEPTH_TEST<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">DrawScene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    

<span class="token comment">// 画到屏幕</span>
<span class="token function">glBindFramebuffer</span><span class="token punctuation">(</span>GL_FRAMEBUFFER<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 默认帧缓冲，即屏幕</span>
<span class="token function">glClearColor</span><span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">glClear</span><span class="token punctuation">(</span>GL_COLOR_BUFFER_BIT<span class="token punctuation">)</span><span class="token punctuation">;</span>

screenShader<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>quadVAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glDisable</span><span class="token punctuation">(</span>GL_DEPTH_TEST<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> textureColorbuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glDrawArrays</span><span class="token punctuation">(</span>GL_TRIANGLES<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  

<span class="token comment">// 着色器：从帧缓冲画到屏幕的着色器异常简单，因为只需要画矩形</span>
<span class="token comment">// --------------------------------------</span>
<span class="token comment">// 顶点着色器</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">330</span> core</span></span>
<span class="token function">layout</span> <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> in vec2 aPos<span class="token punctuation">;</span>
<span class="token function">layout</span> <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> in vec2 aTexCoords<span class="token punctuation">;</span>

out vec2 TexCoords<span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>aPos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> aPos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    TexCoords <span class="token operator">=</span> aTexCoords<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 片段着色器</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">330</span> core</span></span>
out vec4 FragColor<span class="token punctuation">;</span>

in vec2 TexCoords<span class="token punctuation">;</span>

uniform sampler2D screenTexture<span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span> 
    FragColor <span class="token operator">=</span> <span class="token function">texture</span><span class="token punctuation">(</span>screenTexture<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="后期处理">后期处理 </h3>
<p>可能会好奇以上这么做的目的是什么；<br>
实际上，我们把要呈现到屏幕上的结果变成了一张纹理图；<br>
而对纹理图进行一些操作，可以实现绘制完成后进行后期处理的效果；<br>
可以理解为为画好的图片加上一些滤镜效果；</p>
<p>最简单的，可以进行颜色反向，只需修改绘制矩形时的片段着色器即可：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">-</span> <span class="token function">texture</span><span class="token punctuation">(</span>screenTexture<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>也可以把图像变成灰度图，即每个通道相同：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>FragColor <span class="token operator">=</span> <span class="token function">texture</span><span class="token punctuation">(</span>screenTexture<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 加权是因为人眼对不同颜色的敏感程度不同</span>
<span class="token keyword keyword-float">float</span> average <span class="token operator">=</span> <span class="token number">0.2126</span> <span class="token operator">*</span> FragColor<span class="token punctuation">.</span>r <span class="token operator">+</span> <span class="token number">0.7152</span> <span class="token operator">*</span> FragColor<span class="token punctuation">.</span>g <span class="token operator">+</span> <span class="token number">0.0722</span> <span class="token operator">*</span> FragColor<span class="token punctuation">.</span>b<span class="token punctuation">;</span>
FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>average<span class="token punctuation">,</span> average<span class="token punctuation">,</span> average<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>卷积操作，也就是在图像上作用不同的卷积核，以达到特定的图片效果：</p>
<p>锐化核：<br>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>9</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn><mtext>&nbsp;</mtext></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><annotation encoding="application/x-tex">\left[\begin{array}{ccc}
    -1 &amp; -1 &amp;-1\\
    -1 &amp; 9 &amp;-1\\
    -1 &amp; -1 &amp;-1\
    \end{array}\right]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewBox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84
H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">9</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span><span class="mspace">&nbsp;</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewBox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z
M347 1759 V0 H263 V1759 v0 v1759 h84z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span></span></span></span></span><br>
不改变总体亮度，对于均匀区域，无影响；<br>
对于明暗交界区域，亮的更亮，暗的更暗，显得锐利；</p>
<p>边缘核：<br>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>8</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn><mtext>&nbsp;</mtext></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><annotation encoding="application/x-tex">\left[\begin{array}{ccc}
    -1 &amp; -1 &amp;-1\\
    -1 &amp; 8 &amp;-1\\
    -1 &amp; -1 &amp;-1\
    \end{array}\right]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewBox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84
H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">8</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span><span class="mspace">&nbsp;</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewBox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z
M347 1759 V0 H263 V1759 v0 v1759 h84z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span></span></span></span></span><br>
捕捉边缘，在均匀区域显示黑色，因为周围和中心抵消；<br>
仅在边缘区域会有颜色出现；</p>
<p>模糊核：<br>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>2</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>2</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>4</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>2</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>2</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn><mtext>&nbsp;</mtext></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mi mathvariant="normal">/</mi><mn>16</mn></mrow><annotation encoding="application/x-tex">\left[\begin{array}{ccc}
    1 &amp; 2 &amp;1\\
    2 &amp; 4 &amp;2\\
    1 &amp; 2 &amp;1\
    \end{array}\right] /16</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewBox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84
H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">4</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace">&nbsp;</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewBox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z
M347 1759 V0 H263 V1759 v0 v1759 h84z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">/16</span></span></span></span></span><br>
不改变整体亮度，但是变模糊，因为被加权平均了；</p>
<p>处理卷积效果的片段着色器代码如下所示：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-float">float</span> offset <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">/</span> <span class="token number">300.0</span><span class="token punctuation">;</span>  

<span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    vec2 offsets<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span> <span class="token operator">=</span> vec2<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>
        <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token operator">-</span>offset<span class="token punctuation">,</span>  offset<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 左上</span>
        <span class="token function">vec2</span><span class="token punctuation">(</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>    offset<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 正上</span>
        <span class="token function">vec2</span><span class="token punctuation">(</span> offset<span class="token punctuation">,</span>  offset<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 右上</span>
        <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token operator">-</span>offset<span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   <span class="token comment">// 左</span>
        <span class="token function">vec2</span><span class="token punctuation">(</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>    <span class="token number">0.0f</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   <span class="token comment">// 中</span>
        <span class="token function">vec2</span><span class="token punctuation">(</span> offset<span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   <span class="token comment">// 右</span>
        <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token operator">-</span>offset<span class="token punctuation">,</span> <span class="token operator">-</span>offset<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 左下</span>
        <span class="token function">vec2</span><span class="token punctuation">(</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>   <span class="token operator">-</span>offset<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 正下</span>
        <span class="token function">vec2</span><span class="token punctuation">(</span> offset<span class="token punctuation">,</span> <span class="token operator">-</span>offset<span class="token punctuation">)</span>  <span class="token comment">// 右下</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-float">float</span> kernel<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword keyword-float">float</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>
        <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    vec3 sampleTex<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">9</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        sampleTex<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">vec3</span><span class="token punctuation">(</span><span class="token function">texture</span><span class="token punctuation">(</span>screenTexture<span class="token punctuation">,</span> TexCoords<span class="token punctuation">.</span>st <span class="token operator">+</span> offsets<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    vec3 col <span class="token operator">=</span> <span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">9</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        col <span class="token operator">+=</span> sampleTex<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> kernel<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>

    FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>col<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h2 id="立方体贴图">立方体贴图 </h2>
<h3 id="立方体贴图-1">立方体贴图 </h3>
<p>现在来看一类新的贴图，称为立方体贴图；<br>
也就是说它有6个面，每个面是一个我们之前熟知的2D贴图；<br>
它们共同组成一个立方体；</p>
<p>它的采样依靠一个方向向量r，采样到的点就是立方体中心沿着方向向量打到立方体表面对应的那个纹理值；<br>
这个方向向量，实际上也可以理解为立方体贴图的纹理坐标；</p>
<p>OpenGL中已经做好了相当程度的封装，我们只需要如下很简单的代码就可以进行使用：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">// 创建并绑定立方体贴图</span>
<span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> textureID<span class="token punctuation">;</span>
<span class="token function">glGenTextures</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>textureID<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_CUBE_MAP<span class="token punctuation">,</span> textureID<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 分别加载6个面的贴图并完成绑定</span>
<span class="token keyword keyword-int">int</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> nrChannels<span class="token punctuation">;</span>
<span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-char">char</span> <span class="token operator">*</span>data<span class="token punctuation">;</span>  
<span class="token keyword keyword-for">for</span><span class="token punctuation">(</span><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> textures_faces<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    data <span class="token operator">=</span> <span class="token function">stbi_load</span><span class="token punctuation">(</span>textures_faces<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>width<span class="token punctuation">,</span> <span class="token operator">&amp;</span>height<span class="token punctuation">,</span> <span class="token operator">&amp;</span>nrChannels<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glTexImage2D</span><span class="token punctuation">(</span>
        GL_TEXTURE_CUBE_MAP_POSITIVE_X <span class="token operator">+</span> i<span class="token punctuation">,</span> 
        <span class="token number">0</span><span class="token punctuation">,</span> GL_RGB<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GL_RGB<span class="token punctuation">,</span> GL_UNSIGNED_BYTE<span class="token punctuation">,</span> data
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 设置环绕样式</span>
<span class="token comment">// 后三个设置主要是避免方向向量刚好击中棱或者顶点时，有一致的取值</span>
<span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_CUBE_MAP<span class="token punctuation">,</span> GL_TEXTURE_MAG_FILTER<span class="token punctuation">,</span> GL_LINEAR<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_CUBE_MAP<span class="token punctuation">,</span> GL_TEXTURE_MIN_FILTER<span class="token punctuation">,</span> GL_LINEAR<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_CUBE_MAP<span class="token punctuation">,</span> GL_TEXTURE_WRAP_S<span class="token punctuation">,</span> GL_CLAMP_TO_EDGE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_CUBE_MAP<span class="token punctuation">,</span> GL_TEXTURE_WRAP_T<span class="token punctuation">,</span> GL_CLAMP_TO_EDGE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_CUBE_MAP<span class="token punctuation">,</span> GL_TEXTURE_WRAP_R<span class="token punctuation">,</span> GL_CLAMP_TO_EDGE<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 片段着色器</span>
in vec3 textureDir<span class="token punctuation">;</span> <span class="token comment">// 代表3D纹理坐标的方向向量</span>
uniform samplerCube cubemap<span class="token punctuation">;</span> <span class="token comment">// 立方体贴图的纹理采样器</span>

<span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>             
    FragColor <span class="token operator">=</span> <span class="token function">texture</span><span class="token punctuation">(</span>cubemap<span class="token punctuation">,</span> textureDir<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="天空盒">天空盒 </h3>
<p>立方体贴图的作用是相当强大的；<br>
它的一个主要应用就是在于背景的绘制；</p>
<p>我们想要实现遥远的背景，并且无论我们的视角如何变换，背景依然存在；<br>
一个有意思的做法是，在空间中绘制一个很大的立方体；<br>
这里的大，值得是在标准化坐标中，顶点坐标绝对值为1；<br>
实际上我们不需要model矩阵，因为天空盒在世界空间中是不动的；<br>
在这个立方体表面贴上我们准备好的立方体贴图；<br>
并且这个立方体的中心始终是我们的相机位置；<br>
这样不论我们的视角如何移动，都能看到远方的背景几乎不变；</p>
<p>说明如下几个问题：</p>
<p><strong>天空盒所需要的纹理坐标是什么？</strong><br>
实际上很简单，纹理坐标由顶点着色器传出，但我们并不需要专门输入纹理坐标，因为对于我们的立方体绘制而言，纹理坐标实际上就是局部坐标，因为原点就在立方体中心；</p>
<p><strong>渲染顺序？</strong><br>
我们总是希望天空背景在最后，因此需要最先绘制天空盒；<br>
同时为了避免绘制物体被背景挡住，在绘制天空盒时，需要禁用深度写入；</p>
<p>这么做虽然很直观，但是效率上却并不高；<br>
因为天空盒被物体挡住的那部分，本身可以不用画，现在却花了时间去画，显得比较浪费；<br>
因此我们还是需要深度测试来帮我们节省开销；<br>
并且让深度测试判断天空盒的深度是最远深度值1；<br>
同时我们得先绘制物体再绘制天空盒，才能让被挡住的部分没有花时间去画；<br>
注意到，用于深度测试的深度值，实际上是顶点着色器中收到的gl_Position的z分量除以w分量，因此我们只需要改一改这里的z分量和w分量相同即可：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    TexCoords <span class="token operator">=</span> aPos<span class="token punctuation">;</span>
    vec4 pos <span class="token operator">=</span> projection <span class="token operator">*</span> view <span class="token operator">*</span> <span class="token function">vec4</span><span class="token punctuation">(</span>aPos<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl_Position <span class="token operator">=</span> pos<span class="token punctuation">.</span>xyww<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>需要注意，绘制天空盒时的深度测试要设置成GL_LEQUAL模式，因为没有被绘制的片段的默认深度为1，天空盒的深度也为1，必须覆盖掉；</p>
<p><strong>如何保持中心不变？</strong><br>
回想一下，看到的屏幕效果随着视角移动变化，其核心作用体现在view矩阵；<br>
而我们知道，view矩阵的左上角的3 x 3矩阵是用来表达方向的，其他分量是用来表达位移的，因此可以使用如下方式来得到想要的view矩阵：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>glm<span class="token operator">::</span>mat4 view <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">mat4</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">mat3</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span><span class="token function">GetViewMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>完整的代码如下所示：</p>
<details>
<summary>main.cpp</summary></details>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;glad/glad.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;GLFW/glfw3.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stb_image.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;glm/glm.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;glm/gtc/matrix_transform.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;glm/gtc/type_ptr.hpp&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;shader.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;camera.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;model.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

<span class="token keyword keyword-void">void</span> <span class="token function">framebuffer_size_callback</span><span class="token punctuation">(</span>GLFWwindow<span class="token operator">*</span> window<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> width<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-void">void</span> <span class="token function">mouse_callback</span><span class="token punctuation">(</span>GLFWwindow<span class="token operator">*</span> window<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> xpos<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> ypos<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-void">void</span> <span class="token function">scroll_callback</span><span class="token punctuation">(</span>GLFWwindow<span class="token operator">*</span> window<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> xoffset<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> yoffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-void">void</span> <span class="token function">processInput</span><span class="token punctuation">(</span>GLFWwindow <span class="token operator">*</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> <span class="token function">loadTexture</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-char">char</span> <span class="token operator">*</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> <span class="token function">loadCubemap</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>std<span class="token operator">::</span>string<span class="token operator">&gt;</span> faces<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> SCR_WIDTH <span class="token operator">=</span> <span class="token number">800</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> SCR_HEIGHT <span class="token operator">=</span> <span class="token number">600</span><span class="token punctuation">;</span>

Camera <span class="token function">camera</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">3.0f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-float">float</span> lastX <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span>SCR_WIDTH <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">;</span>
<span class="token keyword keyword-float">float</span> lastY <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span>SCR_HEIGHT <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">;</span>
bool firstMouse <span class="token operator">=</span> true<span class="token punctuation">;</span>

<span class="token keyword keyword-float">float</span> deltaTime <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
<span class="token keyword keyword-float">float</span> lastFrame <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">glfwInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwWindowHint</span><span class="token punctuation">(</span>GLFW_CONTEXT_VERSION_MAJOR<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwWindowHint</span><span class="token punctuation">(</span>GLFW_CONTEXT_VERSION_MINOR<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwWindowHint</span><span class="token punctuation">(</span>GLFW_OPENGL_PROFILE<span class="token punctuation">,</span> GLFW_OPENGL_CORE_PROFILE<span class="token punctuation">)</span><span class="token punctuation">;</span>

    GLFWwindow<span class="token operator">*</span> window <span class="token operator">=</span> <span class="token function">glfwCreateWindow</span><span class="token punctuation">(</span>SCR_WIDTH<span class="token punctuation">,</span> SCR_HEIGHT<span class="token punctuation">,</span> <span class="token string">"Hello env"</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>window <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Failed to create GLFW window"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
        <span class="token function">glfwTerminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">glfwMakeContextCurrent</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwSetFramebufferSizeCallback</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> framebuffer_size_callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwSetCursorPosCallback</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> mouse_callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glfwSetScrollCallback</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> scroll_callback<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">glfwSetInputMode</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> GLFW_CURSOR<span class="token punctuation">,</span> GLFW_CURSOR_DISABLED<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">gladLoadGLLoader</span><span class="token punctuation">(</span><span class="token punctuation">(</span>GLADloadproc<span class="token punctuation">)</span>glfwGetProcAddress<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Failed to initialize GLAD"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">glEnable</span><span class="token punctuation">(</span>GL_DEPTH_TEST<span class="token punctuation">)</span><span class="token punctuation">;</span>

    Shader <span class="token function">shader</span><span class="token punctuation">(</span><span class="token string">"../src/cube.vs"</span><span class="token punctuation">,</span> <span class="token string">"../src/cube.fs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Shader <span class="token function">skyboxShader</span><span class="token punctuation">(</span><span class="token string">"../src/skybox.vs"</span><span class="token punctuation">,</span> <span class="token string">"../src/skybox.fs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">pragma</span> <span class="token expression">region 顶点数据载入</span></span>
    <span class="token comment">// 立方体数据</span>
    <span class="token keyword keyword-float">float</span> cubeVertices<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token comment">// 坐标          // 纹理</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>

        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>

        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>

         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>

        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>

        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 天空盒数据</span>
    <span class="token keyword keyword-float">float</span> skyboxVertices<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token comment">// 坐标          </span>
        <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>

        <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>

         <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>

        <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>

        <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>

        <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span><span class="token punctuation">,</span>
         <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">1.0f</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// 立方体VAO</span>
    <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> cubeVAO<span class="token punctuation">,</span> cubeVBO<span class="token punctuation">;</span>
    <span class="token function">glGenVertexArrays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>cubeVAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glGenBuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>cubeVBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>cubeVAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> cubeVBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBufferData</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>cubeVertices<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>cubeVertices<span class="token punctuation">,</span> GL_STATIC_DRAW<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 天空盒 VAO</span>
    <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> skyboxVAO<span class="token punctuation">,</span> skyboxVBO<span class="token punctuation">;</span>
    <span class="token function">glGenVertexArrays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>skyboxVAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glGenBuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>skyboxVBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>skyboxVAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> skyboxVBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBufferData</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>skyboxVertices<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>skyboxVertices<span class="token punctuation">,</span> GL_STATIC_DRAW<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token number">3</span> <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">pragma</span> <span class="token expression">endregion</span></span>

    <span class="token comment">// 贴图绑定与使用</span>
    <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> cubeTexture <span class="token operator">=</span> <span class="token function">loadTexture</span><span class="token punctuation">(</span><span class="token string">"../resources/textures/container.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    vector<span class="token operator">&lt;</span>std<span class="token operator">::</span>string<span class="token operator">&gt;</span> faces
    <span class="token punctuation">{</span>
        <span class="token string">"../resources/textures/skybox/right.jpg"</span><span class="token punctuation">,</span>
        <span class="token string">"../resources/textures/skybox/left.jpg"</span><span class="token punctuation">,</span>
        <span class="token string">"../resources/textures/skybox/top.jpg"</span><span class="token punctuation">,</span>
        <span class="token string">"../resources/textures/skybox/bottom.jpg"</span><span class="token punctuation">,</span>
        <span class="token string">"../resources/textures/skybox/front.jpg"</span><span class="token punctuation">,</span>
        <span class="token string">"../resources/textures/skybox/back.jpg"</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> cubemapTexture <span class="token operator">=</span> <span class="token function">loadCubemap</span><span class="token punctuation">(</span>faces<span class="token punctuation">)</span><span class="token punctuation">;</span>

    shader<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    shader<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token string">"texture1"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    skyboxShader<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    skyboxShader<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token string">"skybox"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 渲染循环</span>
    <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">glfwWindowShouldClose</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-float">float</span> currentFrame <span class="token operator">=</span> static_cast<span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token function">glfwGetTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        deltaTime <span class="token operator">=</span> currentFrame <span class="token operator">-</span> lastFrame<span class="token punctuation">;</span>
        lastFrame <span class="token operator">=</span> currentFrame<span class="token punctuation">;</span>

        <span class="token function">processInput</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">glClearColor</span><span class="token punctuation">(</span><span class="token number">0.1f</span><span class="token punctuation">,</span> <span class="token number">0.1f</span><span class="token punctuation">,</span> <span class="token number">0.1f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glClear</span><span class="token punctuation">(</span>GL_COLOR_BUFFER_BIT <span class="token operator">|</span> GL_DEPTH_BUFFER_BIT<span class="token punctuation">)</span><span class="token punctuation">;</span>

        shader<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        glm<span class="token operator">::</span>mat4 model <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">mat4</span><span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        glm<span class="token operator">::</span>mat4 view <span class="token operator">=</span> camera<span class="token punctuation">.</span><span class="token function">GetViewMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        glm<span class="token operator">::</span>mat4 projection <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">perspective</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">radians</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>Zoom<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span>SCR_WIDTH <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span>SCR_HEIGHT<span class="token punctuation">,</span> <span class="token number">0.1f</span><span class="token punctuation">,</span> <span class="token number">100.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        shader<span class="token punctuation">.</span><span class="token function">setMat4</span><span class="token punctuation">(</span><span class="token string">"model"</span><span class="token punctuation">,</span> model<span class="token punctuation">)</span><span class="token punctuation">;</span>
        shader<span class="token punctuation">.</span><span class="token function">setMat4</span><span class="token punctuation">(</span><span class="token string">"view"</span><span class="token punctuation">,</span> view<span class="token punctuation">)</span><span class="token punctuation">;</span>
        shader<span class="token punctuation">.</span><span class="token function">setMat4</span><span class="token punctuation">(</span><span class="token string">"projection"</span><span class="token punctuation">,</span> projection<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 先绘制立方体盒子</span>
        <span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>cubeVAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glActiveTexture</span><span class="token punctuation">(</span>GL_TEXTURE0<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> cubeTexture<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glDrawArrays</span><span class="token punctuation">(</span>GL_TRIANGLES<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glBindVertexArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 最后画天空盒</span>
        <span class="token function">glDepthFunc</span><span class="token punctuation">(</span>GL_LEQUAL<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 切换深度设置模式</span>
        skyboxShader<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 确保立方体盒子的中心跟随相机</span>
        view <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">mat4</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">mat3</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span><span class="token function">GetViewMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        skyboxShader<span class="token punctuation">.</span><span class="token function">setMat4</span><span class="token punctuation">(</span><span class="token string">"view"</span><span class="token punctuation">,</span> view<span class="token punctuation">)</span><span class="token punctuation">;</span>
        skyboxShader<span class="token punctuation">.</span><span class="token function">setMat4</span><span class="token punctuation">(</span><span class="token string">"projection"</span><span class="token punctuation">,</span> projection<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>skyboxVAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glActiveTexture</span><span class="token punctuation">(</span>GL_TEXTURE0<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_CUBE_MAP<span class="token punctuation">,</span> cubemapTexture<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glDrawArrays</span><span class="token punctuation">(</span>GL_TRIANGLES<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glBindVertexArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glDepthFunc</span><span class="token punctuation">(</span>GL_LESS<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 重新恢复深度测试模式</span>

        <span class="token function">glfwSwapBuffers</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glfwPollEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">glDeleteVertexArrays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>cubeVAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glDeleteVertexArrays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>skyboxVAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glDeleteBuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>cubeVBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glDeleteBuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>skyboxVBO<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">glfwTerminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 回调函数设置</span>
<span class="token comment">// --------------------------------------------------</span>
<span class="token keyword keyword-void">void</span> <span class="token function">processInput</span><span class="token punctuation">(</span>GLFWwindow <span class="token operator">*</span>window<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">glfwGetKey</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> GLFW_KEY_ESCAPE<span class="token punctuation">)</span> <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span>
        <span class="token function">glfwSetWindowShouldClose</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> true<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">glfwGetKey</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> GLFW_KEY_W<span class="token punctuation">)</span> <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span>
        camera<span class="token punctuation">.</span><span class="token function">ProcessKeyboard</span><span class="token punctuation">(</span>FORWARD<span class="token punctuation">,</span> deltaTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">glfwGetKey</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> GLFW_KEY_S<span class="token punctuation">)</span> <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span>
        camera<span class="token punctuation">.</span><span class="token function">ProcessKeyboard</span><span class="token punctuation">(</span>BACKWARD<span class="token punctuation">,</span> deltaTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">glfwGetKey</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> GLFW_KEY_A<span class="token punctuation">)</span> <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span>
        camera<span class="token punctuation">.</span><span class="token function">ProcessKeyboard</span><span class="token punctuation">(</span>LEFT<span class="token punctuation">,</span> deltaTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">glfwGetKey</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> GLFW_KEY_D<span class="token punctuation">)</span> <span class="token operator">==</span> GLFW_PRESS<span class="token punctuation">)</span>
        camera<span class="token punctuation">.</span><span class="token function">ProcessKeyboard</span><span class="token punctuation">(</span>RIGHT<span class="token punctuation">,</span> deltaTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">framebuffer_size_callback</span><span class="token punctuation">(</span>GLFWwindow<span class="token operator">*</span> window<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> width<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> height<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">glViewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">mouse_callback</span><span class="token punctuation">(</span>GLFWwindow<span class="token operator">*</span> window<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> xposIn<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> yposIn<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-float">float</span> xpos <span class="token operator">=</span> static_cast<span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>xposIn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> ypos <span class="token operator">=</span> static_cast<span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>yposIn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>firstMouse<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        lastX <span class="token operator">=</span> xpos<span class="token punctuation">;</span>
        lastY <span class="token operator">=</span> ypos<span class="token punctuation">;</span>
        firstMouse <span class="token operator">=</span> false<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-float">float</span> xoffset <span class="token operator">=</span> xpos <span class="token operator">-</span> lastX<span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> yoffset <span class="token operator">=</span> lastY <span class="token operator">-</span> ypos<span class="token punctuation">;</span> 
    lastX <span class="token operator">=</span> xpos<span class="token punctuation">;</span>
    lastY <span class="token operator">=</span> ypos<span class="token punctuation">;</span>

    camera<span class="token punctuation">.</span><span class="token function">ProcessMouseMovement</span><span class="token punctuation">(</span>xoffset<span class="token punctuation">,</span> yoffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">scroll_callback</span><span class="token punctuation">(</span>GLFWwindow<span class="token operator">*</span> window<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> xoffset<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> yoffset<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    camera<span class="token punctuation">.</span><span class="token function">ProcessMouseScroll</span><span class="token punctuation">(</span>static_cast<span class="token operator">&lt;</span><span class="token keyword keyword-float">float</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>yoffset<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// ------------------------------------------------------------</span>

<span class="token comment">// 贴图读取</span>
<span class="token comment">// ------------------------------------------------------------</span>
<span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> <span class="token function">loadTexture</span><span class="token punctuation">(</span><span class="token keyword keyword-char">char</span> <span class="token keyword keyword-const">const</span> <span class="token operator">*</span> path<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> textureID<span class="token punctuation">;</span>
    <span class="token function">glGenTextures</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>textureID<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-int">int</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> nrComponents<span class="token punctuation">;</span>
    <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-char">char</span> <span class="token operator">*</span>data <span class="token operator">=</span> <span class="token function">stbi_load</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token operator">&amp;</span>width<span class="token punctuation">,</span> <span class="token operator">&amp;</span>height<span class="token punctuation">,</span> <span class="token operator">&amp;</span>nrComponents<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        GLenum format<span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>nrComponents <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
            format <span class="token operator">=</span> GL_RED<span class="token punctuation">;</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>nrComponents <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span>
            format <span class="token operator">=</span> GL_RGB<span class="token punctuation">;</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>nrComponents <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span>
            format <span class="token operator">=</span> GL_RGBA<span class="token punctuation">;</span>

        <span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> textureID<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glTexImage2D</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> format<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> format<span class="token punctuation">,</span> GL_UNSIGNED_BYTE<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glGenerateMipmap</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_WRAP_S<span class="token punctuation">,</span> GL_REPEAT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_WRAP_T<span class="token punctuation">,</span> GL_REPEAT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_MIN_FILTER<span class="token punctuation">,</span> GL_LINEAR_MIPMAP_LINEAR<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_MAG_FILTER<span class="token punctuation">,</span> GL_LINEAR<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">stbi_image_free</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-else">else</span>
    <span class="token punctuation">{</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Texture failed to load at path: "</span> <span class="token operator">&lt;&lt;</span> path <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
        <span class="token function">stbi_image_free</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-return">return</span> textureID<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> <span class="token function">loadCubemap</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>std<span class="token operator">::</span>string<span class="token operator">&gt;</span> faces<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> textureID<span class="token punctuation">;</span>
    <span class="token function">glGenTextures</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>textureID<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_CUBE_MAP<span class="token punctuation">,</span> textureID<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-int">int</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> nrChannels<span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> faces<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-char">char</span> <span class="token operator">*</span>data <span class="token operator">=</span> <span class="token function">stbi_load</span><span class="token punctuation">(</span>faces<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>width<span class="token punctuation">,</span> <span class="token operator">&amp;</span>height<span class="token punctuation">,</span> <span class="token operator">&amp;</span>nrChannels<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">glTexImage2D</span><span class="token punctuation">(</span>GL_TEXTURE_CUBE_MAP_POSITIVE_X <span class="token operator">+</span> i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GL_RGB<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GL_RGB<span class="token punctuation">,</span> GL_UNSIGNED_BYTE<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">stbi_image_free</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-else">else</span>
        <span class="token punctuation">{</span>
            std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Cubemap texture failed to load at path: "</span> <span class="token operator">&lt;&lt;</span> faces<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
            <span class="token function">stbi_image_free</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_CUBE_MAP<span class="token punctuation">,</span> GL_TEXTURE_MIN_FILTER<span class="token punctuation">,</span> GL_LINEAR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_CUBE_MAP<span class="token punctuation">,</span> GL_TEXTURE_MAG_FILTER<span class="token punctuation">,</span> GL_LINEAR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_CUBE_MAP<span class="token punctuation">,</span> GL_TEXTURE_WRAP_S<span class="token punctuation">,</span> GL_CLAMP_TO_EDGE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_CUBE_MAP<span class="token punctuation">,</span> GL_TEXTURE_WRAP_T<span class="token punctuation">,</span> GL_CLAMP_TO_EDGE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_CUBE_MAP<span class="token punctuation">,</span> GL_TEXTURE_WRAP_R<span class="token punctuation">,</span> GL_CLAMP_TO_EDGE<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-return">return</span> textureID<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="环境映射">环境映射 </h3>
<h4 id="反射">反射 </h4>
<p><img src="..\assets\images\learning opengl\image-19.png" alt="alt text"><br>
如果物体带有反射性质，它的片段着色器需要考虑环境的立方体贴图的值；<br>
图中的R向量就是用来在立方体贴图中进行采样的方向向量；</p>
<p>实现起来并不困难，只需要修改一下箱子的片段着色器和顶点着色器即可；</p>
<details>
<summary>cube.vs</summary>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">330</span> core</span></span>
<span class="token function">layout</span> <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> in vec3 aPos<span class="token punctuation">;</span>
<span class="token function">layout</span> <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> in vec3 aNormal<span class="token punctuation">;</span>

out vec3 Normal<span class="token punctuation">;</span>
out vec3 Position<span class="token punctuation">;</span>

uniform mat4 model<span class="token punctuation">;</span>
uniform mat4 view<span class="token punctuation">;</span>
uniform mat4 projection<span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Normal <span class="token operator">=</span> <span class="token function">mat3</span><span class="token punctuation">(</span><span class="token function">transpose</span><span class="token punctuation">(</span><span class="token function">inverse</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> aNormal<span class="token punctuation">;</span>
    Position <span class="token operator">=</span> <span class="token function">vec3</span><span class="token punctuation">(</span>model <span class="token operator">*</span> <span class="token function">vec4</span><span class="token punctuation">(</span>aPos<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl_Position <span class="token operator">=</span> projection <span class="token operator">*</span> view <span class="token operator">*</span> model <span class="token operator">*</span> <span class="token function">vec4</span><span class="token punctuation">(</span>aPos<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></details>
<details>
<summary>cube.fs</summary>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">330</span> core</span></span>
out vec4 FragColor<span class="token punctuation">;</span>

in vec3 Normal<span class="token punctuation">;</span>
in vec3 Position<span class="token punctuation">;</span>

uniform vec3 cameraPos<span class="token punctuation">;</span>
uniform samplerCube skybox<span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>             
    vec3 I <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>Position <span class="token operator">-</span> cameraPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    vec3 R <span class="token operator">=</span> <span class="token function">reflect</span><span class="token punctuation">(</span>I<span class="token punctuation">,</span> <span class="token function">normalize</span><span class="token punctuation">(</span>Normal<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token function">texture</span><span class="token punctuation">(</span>skybox<span class="token punctuation">,</span> R<span class="token punctuation">)</span><span class="token punctuation">.</span>rgb<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></details>
<h4 id="折射">折射 </h4>
<p><img src="..\assets\images\learning opengl\image-20.png" alt="alt text"><br>
折射和反射差不多，只不过需要另一种方式计算R向量；<br>
这其实和物理中的折射定律是一致的；<br>
不过GLSL中封装好了相应的函数：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-float">float</span> ratio <span class="token operator">=</span> <span class="token number">1.00</span> <span class="token operator">/</span> <span class="token number">1.52</span><span class="token punctuation">;</span>
vec3 R <span class="token operator">=</span> <span class="token function">refract</span><span class="token punctuation">(</span>I<span class="token punctuation">,</span> <span class="token function">normalize</span><span class="token punctuation">(</span>Normal<span class="token punctuation">)</span><span class="token punctuation">,</span> ratio<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>效果如下所示：<br>
<video src="..\assets\images\learning opengl\env.mp4" controls="" width="800" height="450"><br>
您的浏览器不支持video标签，请更新浏览器。 <!-- 浏览器不兼容时的提示文字 --><br>
</video></p>
<h2 id="高级数据">高级数据 </h2>
<p>之前我们填写缓冲数据的时候，总是一个顶点一个顶点的填写，每一个顶点包含各种属性；<br>
这么做的好处在于顶点着色器中用到的内存是很紧凑的，速度快，效率高；</p>
<p>实际上我们也可以先填完一个属性的所有顶点，再填另一个属性的所有顶点；<br>
不过这需要我们在为填充缓冲(glBufferData)的时候能够从指定位置开始预留:</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-float">float</span> positions<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword keyword-float">float</span> normals<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword keyword-float">float</span> tex<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 填充缓冲，从指定位置开始</span>
<span class="token function">glBufferSubData</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>positions<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>positions<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBufferSubData</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>positions<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>normals<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>normals<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBufferSubData</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>positions<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>normals<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>tex<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>tex<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token number">3</span> <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token number">3</span> <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>positions<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span>
  <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>positions<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>normals<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>此外，我们可以通过glCopyBufferSubData来从一个缓冲中复制数据到另一个缓冲:</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">// OpenGL内置函数</span>
<span class="token keyword keyword-void">void</span> <span class="token function">glCopyBufferSubData</span><span class="token punctuation">(</span>GLenum readtarget<span class="token punctuation">,</span> GLenum writetarget<span class="token punctuation">,</span> GLintptr readoffset<span class="token punctuation">,</span>
                         GLintptr writeoffset<span class="token punctuation">,</span> GLsizeiptr size<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_COPY_READ_BUFFER<span class="token punctuation">,</span> vbo1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_COPY_WRITE_BUFFER<span class="token punctuation">,</span> vbo2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glCopyBufferSubData</span><span class="token punctuation">(</span>GL_COPY_READ_BUFFER<span class="token punctuation">,</span> GL_COPY_WRITE_BUFFER<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>vertexData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h2 id="高级glsl">高级GLSL </h2>
<h3 id="内置gl_">内置gl_ </h3>
<p>一些可能有用的着色器内置变量：<br>
gl_PointSize : 绘制图元为顶点时，修改顶点大小；<br>
gl_VertexID : 顶点的索引；<br>
gl_FragCoord : 片段在屏幕上的位置，原点为左下角；<br>
gl_FrontFacing : bool变量，表明片段是否正面对这当前视角；</p>
<h3 id="接口块">接口块 </h3>
<p>我们可以把要在着色器之间传输的数据，打包到一个块中：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">// vs</span>
out VS_OUT
<span class="token punctuation">{</span>
    vec2 TexCoords<span class="token punctuation">;</span>
<span class="token punctuation">}</span> vs_out<span class="token punctuation">;</span>
<span class="token comment">// fs</span>
in VS_OUT
<span class="token punctuation">{</span>
    vec2 TexCoords<span class="token punctuation">;</span>
<span class="token punctuation">}</span> fs_in<span class="token punctuation">;</span>
</code></pre><h3 id="uniform块">Uniform块 </h3>
<p>如果有多个着色器程序，它们之间共用一些uniform，但是按照之前的做法，需要多次传入uniform的值；<br>
为此，我们可以使用uniform块来解决；<br>
在代码中可以按如下方式定义uniform块：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token function">layout</span> <span class="token punctuation">(</span>std140<span class="token punctuation">)</span> uniform ExampleBlock
<span class="token punctuation">{</span>
    <span class="token keyword keyword-float">float</span> value<span class="token punctuation">;</span>
    vec3  vector<span class="token punctuation">;</span>
    mat4  matrix<span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> values<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    bool  boolean<span class="token punctuation">;</span>
    <span class="token keyword keyword-int">int</span>   integer<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 在着色器程序中使用其中的变量，无需指定uniform块的名称</span>
vecout <span class="token operator">=</span> model <span class="token operator">*</span> vector<span class="token punctuation">;</span> 
</code></pre><p>解释一下这里的std140；<br>
可以认为是一种存储内存时的规范；<br>
因为定义uniform块的时候，里面可以放入各种数据；<br>
但是GPU需要知道这个数据在我们存储的uniform块中的第几个字节，因此对于每种变量类型占据几个字节有严格的规定；</p>
<p>绑定并分配uniform块内存的方式如下：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> uboExampleBlock<span class="token punctuation">;</span>
<span class="token function">glGenBuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>uboExampleBlock<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_UNIFORM_BUFFER<span class="token punctuation">,</span> uboExampleBlock<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBufferData</span><span class="token punctuation">(</span>GL_UNIFORM_BUFFER<span class="token punctuation">,</span> <span class="token number">152</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> GL_STATIC_DRAW<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 分配152字节的内存</span>
<span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_UNIFORM_BUFFER<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>绑定点，就是各个uniform块的一个统一的编号，需要我们手动确定，并对每个着色器进行绑定;<br>
<img src="..\assets\images\learning opengl\image-21.png" alt="alt text"></p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> lights_index <span class="token operator">=</span> <span class="token function">glGetUniformBlockIndex</span><span class="token punctuation">(</span>shaderA<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> <span class="token string">"Lights"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
<span class="token function">glUniformBlockBinding</span><span class="token punctuation">(</span>shaderA<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> lights_index<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">glBindBufferBase</span><span class="token punctuation">(</span>GL_UNIFORM_BUFFER<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> uboExampleBlock<span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre><p>填充uniform缓冲的示例如下：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_UNIFORM_BUFFER<span class="token punctuation">,</span> uboExampleBlock<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-int">int</span> b <span class="token operator">=</span> true<span class="token punctuation">;</span> <span class="token comment">// GLSL中的bool是4字节的，所以我们将它存为一个integer</span>
<span class="token function">glBufferSubData</span><span class="token punctuation">(</span>GL_UNIFORM_BUFFER<span class="token punctuation">,</span> <span class="token number">144</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_UNIFORM_BUFFER<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h2 id="几何着色器">几何着色器 </h2>
<h3 id="示例">示例 </h3>
<p>几何着色器是一个可以选择的着色器，在顶点着色器和片段着色器之间；<br>
接受顶点着色器的一个图元数据(包含所有顶点)；<br>
输出为新的图元(不一定只有一个)，并传递给片段着色器；</p>
<p>下面是一个把顶点变成水平线段的几何着色器：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">330</span> core</span></span>
<span class="token comment">// 输入图元，指定类型points</span>
<span class="token comment">// 还可以选择lines , lines_adjacency , triangles , triangles_adjacency</span>
<span class="token function">layout</span> <span class="token punctuation">(</span>points<span class="token punctuation">)</span> in<span class="token punctuation">;</span>

<span class="token comment">// 输出图元，指定输出为线段</span>
<span class="token comment">// 还可以选择points , triangle_strip</span>
<span class="token function">layout</span> <span class="token punctuation">(</span>line_strip<span class="token punctuation">,</span> max_vertices <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span> out<span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 每生成一个顶点，EmitVertex一下</span>
    <span class="token comment">// EndPrimitive会把刚刚发射的顶点变成图元，并填到输出中</span>

    <span class="token comment">// 内置的gl_in数组存了输入图元的顶点数据数组</span>

    gl_Position <span class="token operator">=</span> gl_in<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>gl_Position <span class="token operator">+</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token function">EmitVertex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    gl_Position <span class="token operator">=</span> gl_in<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>gl_Position <span class="token operator">+</span> <span class="token function">vec4</span><span class="token punctuation">(</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">EmitVertex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">EndPrimitive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="triangle_strip">triangle_strip </h3>
<p><img src="..\assets\images\learning opengl\image-22.png" alt="alt text"><br>
三角形带指的是每三个连续顶点之间绘制一个三角形；<br>
因此我们指定输出类型为triangle_strip之后；<br>
依次EmitVertex()5个顶点之后，再使用EndPrinmitive()；<br>
就可以把原先的顶点拓展为一个房子；</p>
<p>从以上例子中可以看出，使用几何着色器可以很好地把简单的订单数据进行拓展，而不需要非常麻烦地定义缓冲数据；</p>
<h3 id="爆破物体">爆破物体 </h3>
<p>几何着色器的作用可以很强大，比如我们能够实现物体的爆破效果；<br>
实现起来挺简单，只需要在几何着色器中按照图元的法线方向走出一定距离；<br>
具体的几何着色器实现如下:</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">330</span> core</span></span>
<span class="token function">layout</span> <span class="token punctuation">(</span>triangles<span class="token punctuation">)</span> in<span class="token punctuation">;</span>
<span class="token function">layout</span> <span class="token punctuation">(</span>triangle_strip<span class="token punctuation">,</span> max_vertices <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span> out<span class="token punctuation">;</span>

in VS_OUT <span class="token punctuation">{</span>
    vec2 texCoords<span class="token punctuation">;</span>
<span class="token punctuation">}</span> gs_in<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

out vec2 TexCoords<span class="token punctuation">;</span> 

uniform <span class="token keyword keyword-float">float</span> time<span class="token punctuation">;</span>

<span class="token comment">// 获取法向的方法</span>
<span class="token comment">// 边向量叉乘即可</span>
vec3 <span class="token function">GetNormal</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
   vec3 a <span class="token operator">=</span> <span class="token function">vec3</span><span class="token punctuation">(</span>gl_in<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>gl_Position<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">vec3</span><span class="token punctuation">(</span>gl_in<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>gl_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>
   vec3 b <span class="token operator">=</span> <span class="token function">vec3</span><span class="token punctuation">(</span>gl_in<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>gl_Position<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">vec3</span><span class="token punctuation">(</span>gl_in<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>gl_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword keyword-return">return</span> <span class="token function">normalize</span><span class="token punctuation">(</span><span class="token function">cross</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

vec4 <span class="token function">explode</span><span class="token punctuation">(</span>vec4 position<span class="token punctuation">,</span> vec3 normal<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-float">float</span> magnitude <span class="token operator">=</span> <span class="token number">2.0</span><span class="token punctuation">;</span>
    vec3 direction <span class="token operator">=</span> normal <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">sin</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span> <span class="token operator">*</span> magnitude<span class="token punctuation">;</span> 
    <span class="token keyword keyword-return">return</span> position <span class="token operator">+</span> <span class="token function">vec4</span><span class="token punctuation">(</span>direction<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
    vec3 normal <span class="token operator">=</span> <span class="token function">GetNormal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    gl_Position <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span>gl_in<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>gl_Position<span class="token punctuation">,</span> normal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    TexCoords <span class="token operator">=</span> gs_in<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>texCoords<span class="token punctuation">;</span>
    <span class="token function">EmitVertex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl_Position <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span>gl_in<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>gl_Position<span class="token punctuation">,</span> normal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    TexCoords <span class="token operator">=</span> gs_in<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>texCoords<span class="token punctuation">;</span>
    <span class="token function">EmitVertex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl_Position <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span>gl_in<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>gl_Position<span class="token punctuation">,</span> normal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    TexCoords <span class="token operator">=</span> gs_in<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>texCoords<span class="token punctuation">;</span>
    <span class="token function">EmitVertex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">EndPrimitive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>需要特别注意的是，几何着色器介于顶点着色器和片段着色器之间；<br>
也就是说顶点着色器中out的变量会传递到几何着色器中的in；<br>
几何着色器中的out变量会传递到片段着色器中的in；</p>
<p>可以看到如下的爆炸效果：<br>
<video src="..\assets\images\learning opengl\explode.mp4" controls="" width="800" height="450"><br>
您的浏览器不支持video标签，请更新浏览器。 <!-- 浏览器不兼容时的提示文字 --><br>
</video></p>
<p>利用几何着色器还可以做出其他的一些效果，比如绘制法向等，不过个人感觉视觉效果不佳，不做展示；</p>
<h2 id="实例化">实例化 </h2>
<h3 id="gl_instance">gl_Instance </h3>
<p>考虑画很多相似的物体，比如说绘制很多草；<br>
如果对每一根草都调用一次glDrawArrays，将会非常浪费；<br>
因为每一次绘制都涉及到大量的准备工作，把资源从CPU移动到GPU中；</p>
<p>使用实例化方法可以大大较少开销，只需要一渲染调用就能绘制多个物体；</p>
<p>具体的代码示例如下：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">// 顶点着色器</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">330</span> core</span></span>
<span class="token function">layout</span> <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> in vec2 aPos<span class="token punctuation">;</span>
<span class="token function">layout</span> <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> in vec3 aColor<span class="token punctuation">;</span>

out vec3 fColor<span class="token punctuation">;</span>

uniform vec2 offsets<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// gl_InstanceID是内置变量，表示现在正在绘制的实例编号</span>
    vec2 offset <span class="token operator">=</span> offsets<span class="token punctuation">[</span>gl_InstanceID<span class="token punctuation">]</span><span class="token punctuation">;</span>
    gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>aPos <span class="token operator">+</span> offset<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fColor <span class="token operator">=</span> aColor<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 设置uniform变量offsets[]</span>
glm<span class="token operator">::</span>vec2 translations<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword keyword-int">int</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword keyword-float">float</span> offset <span class="token operator">=</span> <span class="token number">0.1f</span><span class="token punctuation">;</span>
<span class="token keyword keyword-for">for</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> y <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">;</span> y <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> y <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> x <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> x <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        glm<span class="token operator">::</span>vec2 translation<span class="token punctuation">;</span>
        translation<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span>x <span class="token operator">/</span> <span class="token number">10.0f</span> <span class="token operator">+</span> offset<span class="token punctuation">;</span>
        translation<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span>y <span class="token operator">/</span> <span class="token number">10.0f</span> <span class="token operator">+</span> offset<span class="token punctuation">;</span>
        translations<span class="token punctuation">[</span>index<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> translation<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

shader<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-for">for</span><span class="token punctuation">(</span><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    shader<span class="token punctuation">.</span><span class="token function">setVec2</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"offsets["</span> <span class="token operator">+</span> std<span class="token operator">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> translations<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 渲染调用</span>
<span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>quadVAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 第四个参数表示100个实例，每个实例只画6个顶点</span>
<span class="token function">glDrawArraysInstanced</span><span class="token punctuation">(</span>GL_TRIANGLES<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="实例化数组">实例化数组 </h3>
<p>上面的方式会受到限制，因为能传递给GPU的uniform数量是有限的；<br>
想要绘制更多的，物体，我们必须把偏移量纳入到顶点属性中，而不是通过uniform的方式来传递；</p>
<p>因此顶点着色器变成了这样：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">330</span> core</span></span>
<span class="token function">layout</span> <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> in vec2 aPos<span class="token punctuation">;</span>
<span class="token function">layout</span> <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> in vec3 aColor<span class="token punctuation">;</span>
<span class="token function">layout</span> <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span> in vec2 aOffset<span class="token punctuation">;</span>

out vec3 fColor<span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>aPos <span class="token operator">+</span> aOffset<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fColor <span class="token operator">=</span> aColor<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>添加2号顶点属性(窗口2)的时候和之前略有不同，我们不把它放在顶点的那个VBO中，而是单独存放：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> instanceVBO<span class="token punctuation">;</span>
<span class="token function">glGenBuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>instanceVBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> instanceVBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBufferData</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>glm<span class="token operator">::</span>vec2<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>translations<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> GL_STATIC_DRAW<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> instanceVBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
<span class="token function">glVertexAttribDivisor</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 最后一行表示，每绘制一个新的实例，才会使用下一个instanceVBO中的数据</span>
<span class="token comment">// 在这里，也就是画完4个顶点，才使用新的offset</span>
</code></pre><p>此时，绘制仍然调用：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token function">glDrawArraysInstanced</span><span class="token punctuation">(</span>GL_TRIANGLES<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 在绘制每个实例时，会反复调用存入的6个顶点</span>
<span class="token comment">// 并调用下一个offset</span>
</code></pre><h3 id="实际应用">实际应用 </h3>
<p>在更实际的应用中，我们可能需要传入给顶点着色器的，是每个实例的model矩阵；<br>
注意此时model矩阵相当于4个vec4向量，因此在绑定时需要预留4个窗口，但是在顶点着色器中，可以直接使用矩阵变量：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> buffer<span class="token punctuation">;</span>
<span class="token function">glGenBuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBufferData</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> amount <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>glm<span class="token operator">::</span>mat4<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>modelMatrices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> GL_STATIC_DRAW<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>VAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
GLsizei vec4Size <span class="token operator">=</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>glm<span class="token operator">::</span>vec4<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token number">4</span> <span class="token operator">*</span> vec4Size<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token number">4</span> <span class="token operator">*</span> vec4Size<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">*</span> vec4Size<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token number">4</span> <span class="token operator">*</span> vec4Size<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> vec4Size<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token number">4</span> <span class="token operator">*</span> vec4Size<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> vec4Size<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">glVertexAttribDivisor</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glVertexAttribDivisor</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glVertexAttribDivisor</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glVertexAttribDivisor</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">glBindVertexArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 顶点着色器</span>
<span class="token comment">// 会自动解析为连续的4个通道</span>
<span class="token comment">// 因为OpenGL限制了每个通道最多传递vec4</span>
<span class="token function">layout</span> <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span> in mat4 instanceMatrix<span class="token punctuation">;</span>

gl_Position <span class="token operator">=</span> projection <span class="token operator">*</span> view <span class="token operator">*</span> instanceMatrix <span class="token operator">*</span> <span class="token function">vec4</span><span class="token punctuation">(</span>aPos<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre><h2 id="抗锯齿">抗锯齿 </h2>
<h3 id="msaa">MSAA </h3>
<p>首先来看抗锯齿的基本原理：</p>
<div style="display: flex; gap: 10px; ">
  <div style="flex: 1; ">
    <img src="..\assets\images\learning opengl\image-23.png" alt="正常" style="width: 100%; ">
  </div>
  <div style="flex: 1;">
    <img src="..\assets\images\learning opengl\image-24.png" alt="超采样" style="width: 100%;">
  </div>
</div>
<p>核心就是要让光栅化阶段，图案边缘不要是非黑即白的，而是能够根据三角形对像素的覆盖比例混合颜色；</p>
<p>现在的问题是如何根据三角形对像素的覆盖比例进行颜色计算；</p>
<p>一种直观的想法是进行超采样SSAA；<br>
也就是说原先我们的采样点(代表这个像素的点)选在像素正中心；<br>
根据正中心点的情况进行颜色计算(在三角形内部才有颜色)；<br>
现在我们在一个像素内多放几个点，每个点都当作一个片段着色器计算一遍颜色，最终像素的颜色为像素内采样点颜色的平均；</p>
<p>这么做的缺点在于需要调用几倍于原先次数的片段着色器，非常耗时；<br>
为了避免多次调用片段着色器，使用MSAA方法；</p>
<p>MSAA只调用一次片段着色器，他选择的采样点仍然是像素中心；<br>
但他同样有超采样过程，只不过这些超采样点并不用来计算颜色，而是只用来判断；<br>
这里的判断包括深度测试和模板测试，由此我们可以得到一个像素内的采样点有多少是可见的，由此就能得到之前所谓而对覆盖比例；<br>
最后再利用这个覆盖比例和中心点对应的颜色值来得到该像素最终的颜色；</p>
<p>在OpenGL中，这些已经被内置实现好了；<br>
我们只需要如下两行代码就可以完成抗锯齿效果：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">// 声明一个像素内的采样点</span>
<span class="token function">glfwWindowHint</span><span class="token punctuation">(</span>GLFW_SAMPLES<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 启用MSAA</span>
<span class="token function">glEnable</span><span class="token punctuation">(</span>GL_MULTISAMPLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="离屏msaa">离屏MSAA </h3>
<p>之前的代码中,超采样步骤是由glfw帮我们完成的；<br>
如果想要使用之前提到的帧缓冲技术，先进行离屏渲染，再画到屏幕上，就会更复杂一些；</p>
<p>首先我们需要有多重采样纹理附件，并添加到帧缓冲上：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D_MULTISAMPLE<span class="token punctuation">,</span> tex<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// samples是采样数，最后一个参数表示每个像素内的采样点位置和数量是一样的</span>
<span class="token function">glTexImage2DMultisample</span><span class="token punctuation">(</span>GL_TEXTURE_2D_MULTISAMPLE<span class="token punctuation">,</span> samples<span class="token punctuation">,</span> GL_RGB<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> GL_TRUE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D_MULTISAMPLE<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glFramebufferTexture2D</span><span class="token punctuation">(</span>GL_FRAMEBUFFER<span class="token punctuation">,</span> GL_COLOR_ATTACHMENT0<span class="token punctuation">,</span> GL_TEXTURE_2D_MULTISAMPLE<span class="token punctuation">,</span> tex<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>这个纹理附件是存颜色信息的；</p>
<p>深度和模板信息存在RBO中，和之前相比，只需修改如下语句：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token function">glRenderbufferStorageMultisample</span><span class="token punctuation">(</span>GL_RENDERBUFFER<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> GL_DEPTH24_STENCIL8<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>最后，将画布转移到屏幕所需要的几个命令为：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">// 从multisampledFBO中读信息(深度、颜色等)</span>
<span class="token function">glBindFramebuffer</span><span class="token punctuation">(</span>GL_READ_FRAMEBUFFER<span class="token punctuation">,</span> multisampledFBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 写到默认缓冲，也就是屏幕上去</span>
<span class="token function">glBindFramebuffer</span><span class="token punctuation">(</span>GL_DRAW_FRAMEBUFFER<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 因为多重采样的帧缓冲格式和默认帧缓冲不一样</span>
<span class="token comment">// 因此需要进行之前所说的按比例混合这一步</span>
<span class="token function">glBlitFramebuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> GL_COLOR_BUFFER_BIT<span class="token punctuation">,</span> GL_NEAREST<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>如果要对多重采样帧缓冲进行后处理，会更为麻烦一些；<br>
因为即使片段着色器无法识别多重采样帧缓冲格式，一个纹理像素4个采样点；<br>
因此我们还需要一个中介帧缓冲对象；<br>
先把多重采样帧缓冲画到这个中介画布上，此时也需要使用上面所说的glBlitFrameBuffer；<br>
现在中介帧缓冲对象完全就是正常纹理的形式，可以被片段着色器正常访问，因此在这个阶段进行后处理即可；</p>
<h1 id="高级光照">高级光照 </h1>
<h2 id="blinn-phong">Blinn-Phong </h2>
<p><img src="..\assets\images\learning opengl\image-25.png" alt="alt text"><br>
Phong模型的问题在于，观察方向和镜面反射方向相反时的高光表现；<br>
之前我们会直接为夹角大于90度的高光贡献算作0；<br>
但是这在shininess较小(指数项小，高光范围大)的情况下，会忽略高光贡献，这是有问题的；</p>
<p>解决问题的方式是Blinn-Phong模型；<br>
本质上就是要解决夹角大于90度的问题；<br>
实际上很简单，就是把原来的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span></span></span></span>除以2就行，这样范围就从0 ~ 180下降到了0 ~ 90；</p>
<p>我们也可以找出对应的物理意义：<br>
<img src="..\assets\images\learning opengl\image-26.png" alt="alt text"><br>
新的夹角是半程向量(视线和光的角平分线)与法线的夹角；</p>
<p>虽然说总的而言，可以说是一种直觉上的修改，但是在实际效果上，差异还是蛮大的：<br>
<img src="..\assets\images\learning opengl\image-27.png" alt="alt text"><br>
明显可以看出高光变得柔和了许多；</p>
<h2 id="gamma校正">Gamma校正 </h2>
<h3 id="非线性亮度">非线性亮度 </h3>
<p>之前我们用一个0 ~ 1范围的数表示每个通道的亮度；<br>
物理上来说，我们希望数值翻倍则亮度翻倍；<br>
但是人眼的视觉感受而言，亮度和这个数值并不是线性关系；</p>
<p>举例而言，0.2比0.1的亮度增益会看起来大于0.8比0.4的亮度增益；<br>
显示器为了仍然让数值和看到的感官符合直觉的翻倍关系；<br>
会偷偷地为数值作用2.2次幂再进行输出；</p>
<p>也就是说，你以为的0.5 -&gt; 1.0 的提升；<br>
实际上在真正的物理上，是0.5 ^ 2.2 = 0.218 -&gt; 1.0，翻了四倍；</p>
<h3 id="gamma校正-1">Gamma校正 </h3>
<p>为了让这个数值就是物理数值，我们需要欺骗一下显示器；<br>
也就是把数值作用1 / 2.2的幂次传给显示器；</p>
<p>实现Gamma校正有两种方式：<br>
第一种，直接启用SRGB即可：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token function">glEnable</span><span class="token punctuation">(</span>GL_FRAMEBUFFER_SRGB<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>第二种，在片段着色器中，手动作用：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-float">float</span> gamma <span class="token operator">=</span> <span class="token number">2.2</span><span class="token punctuation">;</span>
fragColor<span class="token punctuation">.</span>rgb <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span>fragColor<span class="token punctuation">.</span>rgb<span class="token punctuation">,</span> <span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token operator">/</span>gamma<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>gamma校正很好地解释了为什么之前的衰减选用的是1 / distance而非物理上正确的1 / (distance * distance);<br>
因为由于我们最终会被渲染到显示器上，实际上的物理亮度是：<br>
(1 / distance) ^ 2.2；<br>
因此非常接近于物理公式，这也就是看起来选用了不正确的衰减系数的原因；</p>
<h2 id="阴影">阴影 </h2>
<p>阴影对于真实感的效果提升毋庸置疑：<br>
<img src="..\assets\images\learning opengl\image-28.png" alt="alt text"><br>
但是实现阴影，尤其是实时阴影并不容易；</p>
<h3 id="阴影映射">阴影映射 </h3>
<p><img src="..\assets\images\learning opengl\image-29.png" alt="alt text"><br>
实现阴影效果最重要的一点是要判断，当前想要绘制的片段是否处于阴影中，或者说对于光源是否可见；</p>
<p>想知道某个片段对于光源是否可见，可以这么做：<br>
从光源的视角进行一遍渲染，利用深度测试来判断；<br>
更具体地，我们存下一张从光源角度看来的深度贴图，也就是每个光源的观察坐标看来的最近深度；<br>
真正渲染场景的时候，我们会查询绘制片段在深度贴图中的值和位置，判断其是否处于阴影之中；</p>
<h3 id="深度贴图">深度贴图 </h3>
<p>按照如下代码准备并绘制深度贴图：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">// 深度帧缓冲设置</span>
<span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> depthMapFBO<span class="token punctuation">;</span>
<span class="token function">glGenFramebuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>depthMapFBO<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> <span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> SHADOW_WIDTH <span class="token operator">=</span> <span class="token number">1024</span><span class="token punctuation">,</span> SHADOW_HEIGHT <span class="token operator">=</span> <span class="token number">1024</span><span class="token punctuation">;</span>

<span class="token comment">// 深度贴图设置</span>
<span class="token keyword keyword-unsigned">unsigned</span> <span class="token keyword keyword-int">int</span> depthMap<span class="token punctuation">;</span>
<span class="token function">glGenTextures</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>depthMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> depthMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glTexImage2D</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GL_DEPTH_COMPONENT<span class="token punctuation">,</span> 
             SHADOW_WIDTH<span class="token punctuation">,</span> SHADOW_HEIGHT<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GL_DEPTH_COMPONENT<span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_MIN_FILTER<span class="token punctuation">,</span> GL_NEAREST<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_MAG_FILTER<span class="token punctuation">,</span> GL_NEAREST<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_WRAP_S<span class="token punctuation">,</span> GL_REPEAT<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_WRAP_T<span class="token punctuation">,</span> GL_REPEAT<span class="token punctuation">)</span><span class="token punctuation">;</span>  

<span class="token comment">// 把生成的深度纹理作为深度帧缓冲的深度缓冲</span>
<span class="token function">glBindFramebuffer</span><span class="token punctuation">(</span>GL_FRAMEBUFFER<span class="token punctuation">,</span> depthMapFBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glFramebufferTexture2D</span><span class="token punctuation">(</span>GL_FRAMEBUFFER<span class="token punctuation">,</span> GL_DEPTH_ATTACHMENT<span class="token punctuation">,</span> GL_TEXTURE_2D<span class="token punctuation">,</span> depthMap<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glDrawBuffer</span><span class="token punctuation">(</span>GL_NONE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glReadBuffer</span><span class="token punctuation">(</span>GL_NONE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBindFramebuffer</span><span class="token punctuation">(</span>GL_FRAMEBUFFER<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 渲染循环中</span>
<span class="token comment">// 先绘制深度贴图</span>
<span class="token function">glViewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> SHADOW_WIDTH<span class="token punctuation">,</span> SHADOW_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBindFramebuffer</span><span class="token punctuation">(</span>GL_FRAMEBUFFER<span class="token punctuation">,</span> depthMapFBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glClear</span><span class="token punctuation">(</span>GL_DEPTH_BUFFER_BIT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">ConfigureShaderAndMatrices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">RenderScene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 进行正常的渲染</span>
<span class="token comment">// 注意要重新设置glViewport，因为深度贴图和屏幕分辨率不同</span>
<span class="token function">glBindFramebuffer</span><span class="token punctuation">(</span>GL_FRAMEBUFFER<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glViewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> SCR_WIDTH<span class="token punctuation">,</span> SCR_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glClear</span><span class="token punctuation">(</span>GL_COLOR_BUFFER_BIT <span class="token operator">|</span> GL_DEPTH_BUFFER_BIT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">ConfigureShaderAndMatrices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> depthMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">RenderScene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>下面来看如何从光源角度进行渲染；<br>
最关键的，就是要知道对应的view , project矩阵是什么；<br>
由于我们的光源用的是平行光，因此使用正交投影矩阵；<br>
此外，透视投影的深度值不线性，会导致较大的深度的精度很低；<br>
但是我们还是需要指定一个位置，这个位置可以自行指定，但是需要注意要保证lookat的方向和平行光方向一致：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-float">float</span> near_plane <span class="token operator">=</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> far_plane <span class="token operator">=</span> <span class="token number">7.5f</span><span class="token punctuation">;</span>
glm<span class="token operator">::</span>mat4 lightProjection <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">ortho</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10.0f</span><span class="token punctuation">,</span> <span class="token number">10.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">10.0f</span><span class="token punctuation">,</span> <span class="token number">10.0f</span><span class="token punctuation">,</span> near_plane<span class="token punctuation">,</span> far_plane<span class="token punctuation">)</span><span class="token punctuation">;</span>

glm<span class="token operator">::</span>mat4 lightView <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">lookAt</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2.0f</span><span class="token punctuation">,</span> <span class="token number">4.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">,</span> glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>  <span class="token number">0.0f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

glm<span class="token operator">::</span>mat4 lightSpaceMatrix <span class="token operator">=</span> lightProjection <span class="token operator">*</span> lightView<span class="token punctuation">;</span>
</code></pre><p>顶点着色器需要应用上面求得的矩阵，而片段着色器什么都不用做，因为我们只对深度信息感兴趣：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">// 顶点着色器</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">330</span> core</span></span>
<span class="token function">layout</span> <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> in vec3 aPos<span class="token punctuation">;</span>

uniform mat4 lightSpaceMatrix<span class="token punctuation">;</span>
uniform mat4 model<span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> lightSpaceMatrix <span class="token operator">*</span> model <span class="token operator">*</span> <span class="token function">vec4</span><span class="token punctuation">(</span>aPos<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>  

<span class="token comment">// 片段着色器</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">330</span> core</span></span>

<span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>             
    
<span class="token punctuation">}</span>
</code></pre><h3 id="阴影渲染">阴影渲染 </h3>
<p>在能够渲染阴影的片段着色器中，我们计算shadow变量；<br>
最终的光线贡献的散射和高光贡献为：<br>
(1 - shadow) * (diffuse + specular)；</p>
<p>也就是说，不处于阴影中时，shadow = 0；<br>
完全处于阴影中时，shadow = 1；</p>
<p>获取shadow变量的方法如下：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-float">float</span> <span class="token function">ShadowCalculation</span><span class="token punctuation">(</span>vec4 fragPosLightSpace<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// 执行透视除法</span>
    vec3 projCoords <span class="token operator">=</span> fragPosLightSpace<span class="token punctuation">.</span>xyz <span class="token operator">/</span> fragPosLightSpace<span class="token punctuation">.</span>w<span class="token punctuation">;</span>

    <span class="token comment">// 变换到[0,1]的范围</span>
    <span class="token comment">// 因为原先的坐标范围是标准范围[-1 , 1]</span>
    <span class="token comment">// 但是在深度贴图上进行采样需要范围是[0 , 1]</span>
    projCoords <span class="token operator">=</span> projCoords <span class="token operator">*</span> <span class="token number">0.5</span> <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">;</span>

    <span class="token comment">// 取得最近点的深度(使用[0,1]范围下的fragPosLight当坐标)</span>
    <span class="token keyword keyword-float">float</span> closestDepth <span class="token operator">=</span> <span class="token function">texture</span><span class="token punctuation">(</span>shadowMap<span class="token punctuation">,</span> projCoords<span class="token punctuation">.</span>xy<span class="token punctuation">)</span><span class="token punctuation">.</span>r<span class="token punctuation">;</span> 
    <span class="token comment">// 取得当前片段在光源视角下的深度</span>
    <span class="token keyword keyword-float">float</span> currentDepth <span class="token operator">=</span> projCoords<span class="token punctuation">.</span>z<span class="token punctuation">;</span>
    <span class="token comment">// 检查当前片段是否在阴影中</span>
    <span class="token keyword keyword-float">float</span> shadow <span class="token operator">=</span> currentDepth <span class="token operator">&gt;</span> closestDepth  <span class="token operator">?</span> <span class="token number">1.0</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-return">return</span> shadow<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="阴影失真">阴影失真 </h3>
<p><img src="..\assets\images\learning opengl\image-30.png" alt="alt text"><br>
虽然确实出现了阴影，但是出现了大量的摩尔纹；<br>
原因如下：<br>
地面相距很近的位置，在相机看来的深度区别很小；<br>
但是由于他们离得很近，因此深度被存在了同一个深度贴图纹素上；<br>
这就导致对应于深度贴图同一个纹素上的这些片段，有些深度小于这个深度贴图存储的值，有些则大于，导致被误判为处于阴影中；</p>
<p>解决这个的方法是，为真实距离引入一个小小的偏移，使得这些相距很近的片段都能通过最近深度为它们的深度中某一个值的深度测试：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">// 偏移量一定程度上取决于法向和光线夹角</span>
<span class="token keyword keyword-float">float</span> bias <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0.05</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">-</span> <span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span> lightDir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.005</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-float">float</span> shadow <span class="token operator">=</span> currentDepth <span class="token operator">-</span> bias <span class="token operator">&gt;</span> closestDepth  <span class="token operator">?</span> <span class="token number">1.0</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
</code></pre><p>加入这个简单的处理后，原先的摩尔纹消失了：<br>
<img src="..\assets\images\learning opengl\image-31.png" alt="alt text"></p>
<h3 id="阴影悬浮">阴影悬浮 </h3>
<p><img src="..\assets\images\learning opengl\image-32.png" alt="alt text"><br>
阴影可能看起来悬浮在物体表面上，解决方法是在渲染深度贴图时使用正面剔除；</p>
<p>对于实心物体而言，实际上让它正面挡光还是背面挡光并没有区别；<br>
不过经验表明把物体的背面当作最近深度(深度贴图上存储的值)更好一些；<br>
意味着我们需要临时启用正面剔除：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token function">glCullFace</span><span class="token punctuation">(</span>GL_FRONT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">RenderSceneToDepthMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glCullFace</span><span class="token punctuation">(</span>GL_BACK<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="过采样">过采样 </h3>
<p>对于超出光源能照射到的范围的部分；<br>
也就是说深度贴图采样会超出范围，此时如果使用默认的循环边界设置，可能采样到错误的深度；<br>
因此我们可以让超出标准范围以外的贴图总是选择深度1，也就是说最大深度，意味着这部分无阴影；<br>
同时如果不幸导致在光源计算中超出了原平面，即z &gt; 1；<br>
我们强制让shadow = 0即可；</p>
<h3 id="pcf">PCF </h3>
<p><img src="..\assets\images\learning opengl\image-33.png" alt="alt text"><br>
渲染得到的阴影有较为严重的锯齿效果；<br>
结合之前的经验，抗锯齿的精髓在于模糊化；<br>
我们可以稍稍偏移深度贴图的采样位置，并进行平均：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-float">float</span> shadow <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
vec2 texelSize <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">/</span> <span class="token function">textureSize</span><span class="token punctuation">(</span>shadowMap<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-for">for</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> x <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> x <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token operator">++</span>x<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> y <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> y <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token operator">++</span>y<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-float">float</span> pcfDepth <span class="token operator">=</span> <span class="token function">texture</span><span class="token punctuation">(</span>shadowMap<span class="token punctuation">,</span> projCoords<span class="token punctuation">.</span>xy <span class="token operator">+</span> <span class="token function">vec2</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">*</span> texelSize<span class="token punctuation">)</span><span class="token punctuation">.</span>r<span class="token punctuation">;</span> 
        shadow <span class="token operator">+=</span> currentDepth <span class="token operator">-</span> bias <span class="token operator">&gt;</span> pcfDepth <span class="token operator">?</span> <span class="token number">1.0</span> <span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">;</span>        
    <span class="token punctuation">}</span>    
<span class="token punctuation">}</span>
shadow <span class="token operator">/=</span> <span class="token number">9.0</span><span class="token punctuation">;</span>
</code></pre><p>这就实现了简单的柔化阴影边缘；</p>
<p>完整的代码如下所示：</p>
<details>
<summary>main.cpp</summary>
</details>
<h2 id="点光源阴影">点光源阴影 </h2>
<h3 id="深度立方体贴图">深度立方体贴图 </h3>
<p>如果光源是点光源，深度信息无法记录在一个2D深度贴图上；<br>
可以使用立方体贴图来记录深度：<br>
<img src="..\assets\images\learning opengl\image-34.png" alt="alt text"></p>
<p>可以按照如下方式生成立方体贴图到帧缓冲上：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>GLuint depthCubemap<span class="token punctuation">;</span>
<span class="token function">glGenTextures</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>depthCubemap<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> GLuint SHADOW_WIDTH <span class="token operator">=</span> <span class="token number">1024</span><span class="token punctuation">,</span> SHADOW_HEIGHT <span class="token operator">=</span> <span class="token number">1024</span><span class="token punctuation">;</span>
<span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_CUBE_MAP<span class="token punctuation">,</span> depthCubemap<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>GLuint i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">6</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
        <span class="token function">glTexImage2D</span><span class="token punctuation">(</span>GL_TEXTURE_CUBE_MAP_POSITIVE_X <span class="token operator">+</span> i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GL_DEPTH_COMPONENT<span class="token punctuation">,</span> SHADOW_WIDTH<span class="token punctuation">,</span> SHADOW_HEIGHT<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GL_DEPTH_COMPONENT<span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_CUBE_MAP<span class="token punctuation">,</span> GL_TEXTURE_MAG_FILTER<span class="token punctuation">,</span> GL_NEAREST<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_CUBE_MAP<span class="token punctuation">,</span> GL_TEXTURE_MIN_FILTER<span class="token punctuation">,</span> GL_NEAREST<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_CUBE_MAP<span class="token punctuation">,</span> GL_TEXTURE_WRAP_S<span class="token punctuation">,</span> GL_CLAMP_TO_EDGE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_CUBE_MAP<span class="token punctuation">,</span> GL_TEXTURE_WRAP_T<span class="token punctuation">,</span> GL_CLAMP_TO_EDGE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_CUBE_MAP<span class="token punctuation">,</span> GL_TEXTURE_WRAP_R<span class="token punctuation">,</span> GL_CLAMP_TO_EDGE<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">glBindFramebuffer</span><span class="token punctuation">(</span>GL_FRAMEBUFFER<span class="token punctuation">,</span> depthMapFBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glFramebufferTexture</span><span class="token punctuation">(</span>GL_FRAMEBUFFER<span class="token punctuation">,</span> GL_DEPTH_ATTACHMENT<span class="token punctuation">,</span> depthCubemap<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glDrawBuffer</span><span class="token punctuation">(</span>GL_NONE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glReadBuffer</span><span class="token punctuation">(</span>GL_NONE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBindFramebuffer</span><span class="token punctuation">(</span>GL_FRAMEBUFFER<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="光空间变换">光空间变换 </h3>
<p>为了生成6个面的深度贴图，需要渲染6次，也就是需要6个不同的lightViewMatrices；</p>
<p>proj矩阵是相同的，且使用透视投影矩阵，因为现在是点光源；<br>
需要注意我们需要设置视野为90度，以保证贴满立方体每个面；</p>
<p>view矩阵需要设置lookat方向分别是右、左、上、下、近、远，注意需要匹配向上的方向：</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code>GLfloat aspect <span class="token operator">=</span> <span class="token punctuation">(</span>GLfloat<span class="token punctuation">)</span>SHADOW_WIDTH<span class="token operator">/</span><span class="token punctuation">(</span>GLfloat<span class="token punctuation">)</span>SHADOW_HEIGHT<span class="token punctuation">;</span>
GLfloat near <span class="token operator">=</span> <span class="token number">1.0f</span><span class="token punctuation">;</span>
GLfloat far <span class="token operator">=</span> <span class="token number">25.0f</span><span class="token punctuation">;</span>
glm<span class="token operator">::</span>mat4 shadowProj <span class="token operator">=</span> glm<span class="token operator">::</span><span class="token function">perspective</span><span class="token punctuation">(</span>glm<span class="token operator">::</span><span class="token function">radians</span><span class="token punctuation">(</span><span class="token number">90.0f</span><span class="token punctuation">)</span><span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">)</span><span class="token punctuation">;</span>

std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>glm<span class="token operator">::</span>mat4<span class="token operator">&gt;</span> shadowTransforms<span class="token punctuation">;</span>
shadowTransforms<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>shadowProj <span class="token operator">*</span> 
                 glm<span class="token operator">::</span><span class="token function">lookAt</span><span class="token punctuation">(</span>lightPos<span class="token punctuation">,</span> lightPos <span class="token operator">+</span> glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
shadowTransforms<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>shadowProj <span class="token operator">*</span> 
                 glm<span class="token operator">::</span><span class="token function">lookAt</span><span class="token punctuation">(</span>lightPos<span class="token punctuation">,</span> lightPos <span class="token operator">+</span> glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
shadowTransforms<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>shadowProj <span class="token operator">*</span> 
                 glm<span class="token operator">::</span><span class="token function">lookAt</span><span class="token punctuation">(</span>lightPos<span class="token punctuation">,</span> lightPos <span class="token operator">+</span> glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
shadowTransforms<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>shadowProj <span class="token operator">*</span> 
                 glm<span class="token operator">::</span><span class="token function">lookAt</span><span class="token punctuation">(</span>lightPos<span class="token punctuation">,</span> lightPos <span class="token operator">+</span> glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
shadowTransforms<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>shadowProj <span class="token operator">*</span> 
                 glm<span class="token operator">::</span><span class="token function">lookAt</span><span class="token punctuation">(</span>lightPos<span class="token punctuation">,</span> lightPos <span class="token operator">+</span> glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
shadowTransforms<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>shadowProj <span class="token operator">*</span> 
                 glm<span class="token operator">::</span><span class="token function">lookAt</span><span class="token punctuation">(</span>lightPos<span class="token punctuation">,</span> lightPos <span class="token operator">+</span> glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> glm<span class="token operator">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="着色器">着色器 </h3>
<p>为了避免真的渲染6次，我们使用几何着色器；<br>
几何着色器可以指定当前绘制的layer，也就对应于不同的面；<br>
这样我们就可以调用一次着色器程序，绘制全部的深度立方体贴图；</p>

      </div>
      
      
    
    
    
    
    
    
  
    </body></html>